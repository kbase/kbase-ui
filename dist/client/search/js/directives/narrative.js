var narrativeDirectives=angular.module("narrative-directives",[]);angular.module("narrative-directives").directive("narrativeCell",function(a){return{link:function(b,c,d){b.fields={},b.flip=function(a){$(a.target).parents(".panel").find(".narrative-cell").toggleClass("flipped")},b.minimize=function(a){$(a.target).parents(".panel").find(".panel-body").slideToggle("fast")},b.runCell=function(c,d){var e={name:d.title,fields:b.fields};a.newTask(e)}}}}).directive("showData",function(){return{link:function(a,b,c){}}}).directive("kbWidget",function(){return{link:function(a,b,c){}}}).directive("animateOnChange",function(a){return{link:function(a,b,c){a.$watch(c.animateOnChange,function(a,c){if(a!=c){var d=a>c?"change-up":"change";console.log("changing",d),b.addClass(d).removeClass(d,{duration:1e3})}})}}}).directive("ddSelector",function(){return{templateUrl:"views/partials/ws-dropdown.html",link:function(a,b,c){a.ddModel=c.ddModel,c.ddDefault&&(a.ddSelected=c.ddDefault),a.$watch(c.ddData,function(b){a.items=b}),a.selectedIndex=-1,a.ddSelect=function(b,c){a.selectedIndex=b,a.ddSelected=c.name},a.openDDSelector=function(){$(b).find(".input-group-btn").addClass("open"),$(b).find(".dd-selector").focus()}}}}).directive("kbUpload",function(a){return{link:function(a,b,c){console.log(USER_TOKEN),SHOCK.init({token:USER_TOKEN,url:a.shockURL});var d=SHOCK.get_all_nodes();$.when(d).done(function(b){a.$apply(function(){a.uploads=b}),console.log(b)})}}}).directive("recentnarratives",function(a){return{link:function(a,b,c){$(b).loading(),a.loadRecentNarratives=function(){var c=kb.ws.list_objects({type:kb.nar_type}).fail(function(a){$(b).rmLoading(),$(b).append('<div class="alert alert-danger">'+a.error.message+"</div>")});$.when(c).done(function(c){$(b).rmLoading();var d=[];if(c.length>0){for(var e in c){var f={};f.name=c[e][1],"auto"!=f.name.slice(0,4)&&(f.id=c[e][0],f.wsid=c[e][6],f.ws=c[e][7],f.owner=c[e][5],f.timestamp=kb.ui.getTimestamp(c[e][3]),f.nealtime=kb.ui.formateDate(f.timestamp)?kb.ui.formateDate(f.timestamp):c[e][3].replace("T"," ").split("+")[0],d.push(f))}a.$apply(function(){a.narratives=d})}else $(b).append("no narratives")})},a.loadRecentNarratives()}}}).directive("newsfeed",function(a,b){return{link:function(c,d,e){var f="http://yogi.lbl.gov/eprojectbuilder/misc/kbasefeed2.xml";a.fetch({q:f,num:50},{},function(a){var e=a.responseData.feed,f=$("<div></div>");for(entry in e.entries){var g=$("<div></div>");$(g).addClass("narr-featured-narrative"),$(g).append(e.entries[entry].content);var h=$("<a></a>");$(h).html("copy narrative"),$(h).attr("ng-click",'copyNarrativeForm("'+e.entries[entry].title+'")'),b(h)(c),$(g).append(h),$(f).append($(g))}$(d).html($(f))})}}}).directive("narrativemanager",function(a){return{link:function(a,b,c){var d=a.params;null!==typeof configJSON&&configJSON.setup&&configJSON[configJSON.setup]&&configJSON[configJSON.setup].workspace_url&&(d.ws_url=configJSON[configJSON.setup].workspace_url),$(b).kbaseNarrativeManager({params:d,loadingImage:"assets/img/ajax-loader.gif"})}}});