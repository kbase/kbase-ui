function getEditableDescription(a){var a=$('<form role="form">                   <div class="form-group">                    <textarea rows="4" class="form-control" placeholder="Description">'+a+"</textarea>                  </div>              </form>");return a}function parse_name(a){return-1!=a.indexOf(USER_ID+":")?a.split(":")[1]:a}function save_dt_view(a,b){localStorage.setItem("DataTables_"+window.location.pathname,JSON.stringify(b))}function load_dt_view(a){return JSON.parse(localStorage.getItem("DataTables_"+window.location.pathname))}function reset_dt_view(a){var b="DataTables_"+a[0].id+"_"+window.location.pathname;localStorage.removeItem(b)}function searchColumns(){$("thead input").keyup(function(){oTable.fnFilter(this.value,oTable.oApi._fnVisibleToColumnIndex(oTable.fnSettings(),$("thead input").index(this)))}),$("thead input").each(function(a){this.initVal=this.value}),$("thead input").focus(function(){"search_init"==this.className&&(this.className="",this.value="")}),$("thead input").blur(function(a){""==this.value&&(this.className="search_init",this.value=this.initVal)})}function getCols(a,b){var c=a.fnSettings().aoColumns;if(b){var d;for(var e in c)if(c[e].sTitle==b){d=e;break}return d}return c}angular.module("ws-directives",[]),angular.module("ws-directives").directive("wsselector",function(a,b,c,d,e){return{templateUrl:"views/ws/ws-selector.html",link:function(a,b,f){function g(){function d(){$(".select-box table tr").show(),$(".no-ws-alert").remove();for(var a=g.prop("checked"),b=j.prop("checked"),c=k.prop("checked"),d=l.prop("checked"),e=0;e<h.length;e++){var f=h[e],i=(f[1],f[2]),m=(f[4],f[5]),n=f[6],o=(f[10],e+1),p=!1;b&&"a"===m&&(p=!0),c&&"w"===m&&(p=!0),d&&"r"===m&&(p=!0),!p&&d&&"r"===n&&(p=!0),p&&a&&i!=USER_ID&&(p=!1),p||$(".select-box table tr:nth-child("+o+")").hide()}0==$(".select-box table tr:visible").length&&$(".select-box table").append('<tr class="no-ws-alert"><td>No Workspaces</td></tr>')}var f=$(".perm-filters"),g=f.find("#ws-filter-owner").change(d),j=f.find("#ws-filter-admin").change(d),k=f.find("#ws-filter-write").change(d),l=f.find("#ws-filter-read").change(d);$(".btn-new-ws").unbind("click"),$(".btn-new-ws").click(function(){e.createWS({submit_cb:function(){a.loadWSTable()}})}),$(".btn-show-fav").unbind("click"),$(".btn-show-fav").click(function(){$(this).hasClass("active")||($(".btn-new-ws").fadeOut(),$(".btn-filter-ws").fadeOut(function(){$(".fav-toolbar").show()}),$("#select-box").toggle("slide",{direction:"left",duration:"fast",complete:function(){$("#favorite-sidebar").toggle("slide",{direction:"right",duration:"fast"})}}),$(this).parent().children().removeClass("active"),$(this).addClass("active"))}),$(".btn-show-ws").unbind("click"),$(".btn-show-ws").click(function(){$(this).hasClass("active")||($(".fav-toolbar").hide(),$(".btn-new-ws").fadeIn(),$(".btn-filter-ws").fadeIn(),$("#favorite-sidebar").toggle("slide",{direction:"right",duration:"fast",complete:function(){$("#select-box").toggle("slide",{direction:"right",duration:"fast"})}}),$(this).parent().children().removeClass("active"),$(this).addClass("active"))}),$(".wb-search").unbind("click"),$(".wb-search").keyup(function(){$(".select-box").find("td").show();var a=$(this).val();$(".select-box").find("td").each(function(){return-1!=$(this).text().toLowerCase().indexOf(a.toLowerCase())?!0:void $(this).hide()})}),$(".show-filters").unbind("click"),$(".show-filters").click(function(){$(this).parent().find(".perm-filters").slideToggle(function(){"none"==$(".perm-filters").css("display")?$(".scroll-pane").css("height",$(window).height()-$(".ws-selector-header").height()-i):$(".scroll-pane").css("height",$(window).height()-$(".ws-selector-header").height()-i)})}),$(".select-ws").not(".btn-ws-settings").unbind("click"),$(".select-ws").not(".btn-ws-settings").click(function(){var b=$(this).data("ws");$(".select-ws").removeClass("selected-ws"),$(this).addClass("selected-ws"),c.transitionTo("ws.id",{ws:b}),a.$apply()}),$(".btn-ws-settings").unbind("click"),$(".btn-ws-settings").click(function(b){b.stopPropagation(),b.preventDefault();var c=$(this).parent("td").data("ws");e.manageWS({ws:c,copy_cb:function(){a.loadWSTable(),kb.ui.notify("Copied workspace: <i>"+c+"</i>")},delete_cb:function(){a.loadWSTable(),kb.ui.notify("Deleted workspace: <i>"+c+"</i>")}})}),$(window).resize(function(){$(b).is(":visible")&&setTimeout(function(){$(".scroll-pane").css("height",$(window).height()-$(".ws-selector-header").height()-i)},250)}),$(".btn-ws-settings").tooltip({title:"Workspace Settings",placement:"left",delay:{show:800}})}var h=[],i=80;a.loadWSTable=function(){$("#select-box .table").remove();var a=$('<table class="table table-bordered table-hover ws-selector-table">');$("#select-box").append(a),h=[];var b=kb.ws.list_workspace_info({});$(".select-box").loading(),$.when(b).done(function(a){function b(a,b){var c=kb.ui.getTimestamp(b[3]),d=kb.ui.getTimestamp(a[3]);return d>c?-1:c>d?1:0}$(".select-box").rmLoading();var c=[],e=[];for(var f in a){var j=a[f],k=j[2];"kbasesearch"!=k&&(k==USER_ID?e.push(j):c.push(j))}var e=e.sort(b),c=c.sort(b),a=e.concat(c);for(var f in a){var j=a[f],l=j[1],k=j[2],m=j[4],n=j[5],o=j[6],p=$('<tr data-perm="'+n+'" data-global="'+o+'" data-owner="'+k+'"><td class="select-ws table-ellipsis '+(d.ws==l?"selected-ws ":"")+'" data-ws="'+l+'"><span class="badge">'+m+"</span> <span> "+(k==USER_ID?"<b>"+l+"</b>":l)+"</span></td></tr>");p.find("td").append('<button type="button" class="btn                                             btn-default btn-xs btn-ws-settings hide" data-ws="'+l+'">                                            <div class="glyphicon glyphicon-cog"></div></button>'),p.hover(function(){$(this).find(".btn-ws-settings").removeClass("hide")},function(){$(this).find(".btn-ws-settings").addClass("hide")});$(".select-box table").append(p)}h=a,$(".scroll-pane").css("height",$(window).height()-$(".ws-selector-header").height()-i),g()})},a.loadWSTable()}}}).directive("objtable",function(a,b,c){return{link:function(a,d,e){function f(b,c,d){for(var e=a.checkedList,f=0;f<e.length;f++)e[f].name==b&&e[f].ws==c&&e[f].type==d&&(e.splice(f,1),a.$apply())}function g(b){var c=$('<div class="btn-table-settings dropdown pull-left"><a class="btn btn-default" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span> <span class="caret"></span></a></div>'),d=$('<ul class="dropdown-menu settings-dropdown" role="menu"></ul>');d.append("Columns:<br>"),c.append(d);var e=getCols(b);for(var f in e)-1==e[f].sTitle.indexOf("ncheck")&&d.append('<div class="btn-settings-opt"><label><input type="checkbox" data-col="'+e[f].sTitle+'" '+(0==e[f].bVisible?"":'checked="checked"')+"> "+e[f].sTitle+"</label>                               </div>");d.append('<hr class="hr">');var g=$('<button class="btn btn-default btn-settings-opt">Default Settings</button>');return d.append(g),d.find("input").change(function(){var a=$(this).data("col");k(b,a)}),g.click(function(){reset_dt_view(b),a.tab?a.loadNarTable(a.tab):a.loadObjTable()}),c}function h(a,b,c){var d=$('<select class="type-filter form-control">                                    <option selected="selected">All Types</option>                                 </select>');for(var e in b)d.append('<option data-type="'+e+'" '+(e==c?"selected":"")+">"+e+"  ("+b[e]+")</option>");return d.change(function(){var b=getCols(a,"Type");"All Types"==$(this).val()?a.fnFilter("",b):a.fnFilter($(this).find("option:selected").data("type")+"-.*",b,!0)}),d}function j(){var b=$('<a class="btn-trash pull-right hide">Trash                             <span class="badge trash-count">'+a.deleted_objs.length+"</span><a>");return b.tooltip({title:"View trash bin",placement:"bottom",delay:{show:700}}),b.unbind("click"),b.click(function(){r()}),b}function k(a,b){var c,d=a.fnSettings().aoColumns;for(i=0;i<d.length;i++)if(d[i].sTitle==b){c=d[i].bVisible;break}a.fnSetColumnVis(i,c?!1:!0)}function l(b,c,d){var e=[];for(var f in b){var g=b[f],h=g[0],i=g[1],j=g[2],k=j.split(".")[0],l=j.slice(j.indexOf(".")+1),m=l.split("-")[0],n=kb.ui.getTimestamp(g[3].split("+")[0]),o=kb.ui.formateDate(n),p=g[4],q=g[5],r=g[6],s=g[7],t=g[9],u=kb.ui.readableSize(t),v='<div class="ncheck obj-check-box check-option" data-wsid="'+r+'" data-ws="'+s+'" data-type="'+l+'" data-module="'+k+'" data-name="'+i+'" data-id="'+h+'"></div>',w=[v,i,s,o,q,n,u,t,k];d&&w.push(kb.ui.formatUsers(d[s],c));var x=!1;for(var f in a.favs)if(a.favs[f].ws==s&&a.favs[f].id==i){x=!0;break}var y="/narrative/ws."+r+".obj."+h,z="<a "+(USER_ID?'href="'+y+'"':"")+' target="_blank" class="obj-id nar-id" data-ws="'+s+'"  data-wsid="'+r+'" data-id="'+h+'" data-name="'+i+'" data-type="'+l+'" data-kind="'+m+'" data-module="'+k+'" ><b><i>'+i+'</i></b></a> (<a class="show-versions">'+p+"</a>)"+(x?' <span class="glyphicon glyphicon-star btn-fav"></span>':"")+'<a class="btn-show-info pull-right invisible" >More</a>';w[1]=z,y="ws.id({ws:'"+s+"'})",ws_link=$('<div><a data-ws="'+s+'" ui-sref="'+y+'">'+s+"</a></div>"),ws_link.append(' <button type="button" class="btn btn-default btn-xs btn-nar-ws-settings pull-right" data-ws="'+i+'"><div class="glyphicon glyphicon-cog"></div></button>'),w[2]=ws_link.html(),e.push(w)}return e}function m(b,c){var d=[],e={};for(var f in b){var g=b[f],h=g[0],i=g[1],j=g[2],k=j.split(".")[0],l=j.slice(j.indexOf(".")+1),m=l.split("-")[0],n=kb.ui.getTimestamp(g[3].split("+")[0]),o=kb.ui.formateDate(n),p=g[4],q=g[5],r=g[6],s=g[7],t=g[9],u=kb.ui.readableSize(t),v='<div class="ncheck obj-check-box check-option" data-wsid="'+r+'" data-ws="'+s+'" data-type="'+l+'" data-module="'+k+'" data-id="'+h+'" data-name="'+i+'"></div>',w=[v,i,l,o,q,n,u,t,k];if(m in e?e[m]=e[m]+1:e[m]=1,k in a.obj_mapping&&a.obj_mapping[k]&&a.obj_mapping[k][m])var x=a.obj_mapping[k][m];else var x=void 0;var y=x,z=kb.getRoute(m);z&&(y=z);var A=$('<a class="obj-id" data-ws="'+s+'" data-wsid="'+r+'" data-id="'+h+'" data-name="'+i+'" data-type="'+l+'" data-kind="'+m+'" data-module="'+k+'" data-sub="'+x+'">'+i+"</a>"),B=$('<a class="show-versions">'+p+"</a>"),C=$('<a class="btn-show-info pull-right invisible" >More</a>');if(y){var D=y+"({ws:'"+s+"', id:'"+i+"'})";A.attr("ui-sref",D);var E=$("<div>").append(A," (",B,")",C).html()}else if("Narrative"==m){var D="/narrative/ws."+r+".obj."+h;USER_ID&&(A.attr("href",D),A.attr("target","_blank"));var E=$("<div>").append(A," (",B,")",C).html()}else{var D="ws.json({ws:'"+s+"', id:'"+i+"'})";A.attr("ui-sref",D).attr("target","_blank");var E=$("<div>").append(A," (",B,")",C).html()}w[1]=E,d.push(w)}return[d,e]}function n(){b(y)(a),$(".nar-id").unbind("click"),$(".nar-id").click(function(a){if(a.stopPropagation(),!USER_ID){var b=$('<div class="must-login-modal">').kbasePrompt({title:"Please login",body:"<b>You must login to view narratives at this time.</b>",modalClass:"",controls:["closeButton"]});b.openPrompt()}}),$(".btn-fav").hover(function(){$(this).addClass("glyphicon-star-empty")},function(){$(this).removeClass("glyphicon-star-empty")}),$(".btn-fav").unbind("click"),$(".btn-fav").click(function(b){b.stopPropagation();var c=$(this).parent("td").find(".obj-id"),d=c.data("name"),e=c.data("ws"),f=c.data("type");$(".fav-loading").loading();var g=favoriteService.remove(e,d,f);$.when(g).done(function(){a.updateFavs()}),$(this).remove()}),$(".btn-show-info").unbind("click"),$(".btn-show-info").click(function(a){a.stopPropagation();var b=$(this).parent("td").find(".obj-id"),c=b.data("name"),d=b.data("ws");q(d,c)}),$(".show-versions").unbind("click"),$(".show-versions").click(function(a){a.stopPropagation();var b=$(this).parent("td").find(".obj-id"),c=b.data("ws"),d=b.data("name");p(c,d)}),$(".btn-select-all").unbind("click"),$(".btn-select-all").click(function(){$(this).hasClass("ncheck-checked")?($(".obj-check-box").removeClass("ncheck-checked"),$(this).removeClass("ncheck-checked"),a.checkedList=[],a.$apply()):($(".obj-check-box").addClass("ncheck-checked"),$(this).removeClass("ncheck-minus"),$(this).addClass("ncheck-checked"),a.checkedList=[],$(".obj-check-box").each(function(){var b=$(this).data("id"),c=$(this).data("name"),d=$(this).data("wsid"),e=$(this).data("ws"),f=$(this).data("type"),g=$(this).data("module");a.checkedList.push({id:b,name:c,wsid:d,ws:e,type:f,module:g}),a.$apply()}))}),$(".obj-table tbody tr").hover(function(){$(this).children("td").eq(0).find(".ncheck").addClass("ncheck-hover"),$(this).find(".btn-show-info").removeClass("invisible")},function(){$(this).children("td").eq(0).find(".ncheck").removeClass("ncheck-hover"),$(this).find(".btn-show-info").addClass("invisible")}),$(".obj-table tbody tr").unbind("click"),$(".obj-table tbody tr").click(function(b){if(!$(b.target).hasClass("obj-id")&&USER_ID){var c=$(this).children("td").eq(0).find(".ncheck"),d=c.data("id"),e=c.data("name"),g=c.data("wsid"),h=c.data("ws"),i=c.data("type"),j=c.data("module");c.hasClass("ncheck-checked")?f(e,h,i):(a.checkedList.push({id:d,name:e,wsid:g,ws:h,type:i,module:j}),a.$apply())}}),$(".btn-nar-ws-settings").unbind("click"),$(".btn-nar-ws-settings").click(function(b){b.stopPropagation(),b.preventDefault();var d=$(this).parent("td").find("a").data("ws");c.manageWS({ws:d,copy_cb:function(){a.loadNarTable(a.tab),kb.ui.notify("Copied workspace: <i>"+d+"</i>")},delete_cb:function(){a.loadNarTable(a.tab),kb.ui.notify("Deleted workspace: <i>"+d+"</i>")}})}),$(".show-versions").tooltip({title:"Show history",placement:"bottom",delay:{show:700}}),$(".nar-id").tooltip({title:"Open Narrative",placement:"bottom",delay:{show:700}}),$(".obj-id").tooltip({title:"View object",placement:"bottom",delay:{show:700}}),$(".btn-show-info").tooltip({title:"Meta data/spec, download, etc.",placement:"bottom",delay:{show:700}})}function o(){var b=$('<span class="object-options hide"></span>'),c=$('<button class="btn btn-danger btn-delete-obj">                    <span class="glyphicon glyphicon-trash"></span></button>');c.click(function(){s()});var d=$('<span class="dropdown"><button class="btn btn-default btn-mv-dd"                                     data-toggle="dropdown">                                <span class="glyphicon glyphicon-folder-open"></span>                                <span class="caret"></span></button>                                <ul class="dropdown-menu" role="menu">                                    <li><a class="btn-cp-obj">Copy</a></li>                                </ul></span>'),e=$('<button class="btn btn-default btn-rename-obj">                    <span class="glyphicon glyphicon-edit"></span></button>');$('<button class="btn btn-default">                    <span class="glyphicon glyphicon-star"></span>                    <span class="checked-count"></span></button>');a.tab?(b.append(c,e),d.find(".btn-cp-obj").on("click",v)):(b.append(c,d,e),d.find(".btn-cp-obj").on("click",u)),d.find(".btn-mv-obj-to-nar").on("click",w),e.on("click",t);$(".table-options").append(b);c.tooltip({title:"Delete selected objects",placement:"bottom",delay:{show:700}}),e.tooltip({title:"Rename (first) selected object",placement:"bottom",delay:{show:700}})}function p(a,b){function c(a){var b=$('<tr data-ver="'+a[4]+'">');return b.append("<td>"+a[3].split("+")[0].replace("T"," ")+"</td><td>"+a[4]+"</td><td>"+a[2]+"</td><td>"+a[5]+"</td><td>"+a[8]+"</td>"),b}var d=$('<div class="history-modal"></div>').kbasePrompt({title:"History of "+b,modalClass:"",controls:["cancelButton"]});d.openPrompt();var e=d.data("dialogModal").find(".modal-body").loading();d.data("dialogModal").find(".modal-dialog").css("width","800px");var f=kb.ws.get_object_history({workspace:a,name:b});$.when(f).done(function(f){e.rmLoading(),e.append('<span class="h5"><b>Name</b></span>: '+b+"<br>"),e.append('<span class="h5"><b>Database ID</b></span>: '+f[0][0]+"<br>");var g=$('<table class="table table-striped table-bordered table-condensed">'),h=$('<tr class="table-header"><th>Mod Date</th>                                        <th>Vers</th>                                        <th>Type</th>                                        <th>Owner</th>                                        <th>Checksum</th></tr>');g.append(h);for(var i=f.length-1;i>=0;i--){var j=f[i],k=c(j);g.append(k)}revert_btn=$('<a class="btn btn-primary btn-revert-object" disabled>Revert</a>'),e.append(g),g.find("tbody tr").not(".table-header").click(function(a){a.stopPropagation(),g.find("tbody tr").removeClass("selected"),$(this).addClass("selected"),revert_btn.removeAttr("disabled")});var l=d.data("dialogModal").find(".modal-content");l.click(function(a){g.find("tbody tr").removeClass("selected"),revert_btn.attr("disabled","")}),revert_btn.click(function(){var e=g.find(".selected").data("ver");d.addCover().getCover().loading();var f=kb.ws.revert_object({workspace:a,name:b,ver:e});$.when(f).done(function(a){var b=c(a);g.find(".table-header").after(b),d.addCover("Reverted to version "+e),d.getCover().delay(2e3).fadeOut(500)}).fail(function(a){d.addCover(a.error.message,"danger")})}),e.append(revert_btn)}).fail(function(a){e.append('<div class="alert alert-danger">'+a.error.message+"</div>")})}function q(a,b){var c=$("<div></div>").kbasePrompt({title:b,modalClass:"",controls:["closeButton"]});c.openPrompt(),c.data("dialogModal").find(".modal-dialog").css("width","500px");var d=c.data("dialogModal").find(".modal-body"),e=[{workspace:a,name:b}],f=kb.ws.get_object_info(e,1);d.loading(),$.when(f).done(function(e){d.rmLoading();var e=e[0];d.append("<h4>User Meta Data</h4>");var f=e[10];if($.isEmptyObject(f))d.append("none");else{var g=$('<div class="scroll-pane overflow-x">'),h=$('<table class="table table-striped table-bordered table-condensed">');for(var i in f)h.append("<tr><td><b>"+i+"</b></td><td>"+f[i]+"</td></tr>");g.append(h),d.append(g)}var j=["ID","Name","Type","Moddate","Instance","Owner","Workspace ID","Workspace","Checksum"];d.append("<h4>Object Info</h4>");var h=kb.ui.listTable({array:e,labels:j,bold:!0});h.append("<tr><td><b>Size</b></td><td>"+e[9]+" Bytes ("+kb.ui.readableSize(e[9])+")</td></tr>"),d.append(h);var k=$('<a class="btn btn-default pull-left">Download                                <span class="glyphicon glyphicon-download-alt"></span></a>');k.click(function(){var c=function(){var a=document.createElement("a");return document.body.appendChild(a),a.style="display: none",function(b,c){var d=JSON.stringify(b),e=new Blob([d],{type:"octet/stream"}),f=window.URL.createObjectURL(e);a.href=f,a.download=c,a.click(),window.URL.revokeObjectURL(f)}}(),d=kb.ws.get_objects([{workspace:a,name:b}]);$.when(d).done(function(a){var d=b+"."+e[4]+".json";c(a[0],d)})}),c.data("dialogModal").find(".modal-footer .text-left").append(k);var l=$('<a class="open-obj pull-left">View JSON</a>');l.click(function(){var c=b+"."+e[4]+".json",d=window.open(c,"_blank");d.document.write("loading...  This may take several seconds or minutes.");var f=kb.ws.get_objects([{workspace:a,name:b}]);$.when(f).done(function(a){d.document.body.innerHTML="",d.document.write(JSON.stringify(a[0]))})}),c.data("dialogModal").find(".modal-footer .text-left").append(l)}).fail(function(a){d.append('<div class="alert alert-danger">'+a.error.message+"</div>")})}function r(){var b={sPaginationType:"full_numbers",iDisplayLength:10,aaData:[],aaSorting:[[3,"desc"]],aoColumns:[{sTitle:"",bSortable:!1},{sTitle:"Name",sType:"html"},{sTitle:"Type",sWidth:"20%"},{sTitle:"Last Modified",iDataSort:5},{sTitle:"Modified by"},{sTitle:"Time Stamp",bVisible:!1,sType:"numeric"}],oLanguage:{sEmptyTable:"No objects in workspace",sSearch:"Search: "}},c="obj-table";if($("#"+c+"_wrapper").hide(),$(d).prepend('<h4 class="trash-header"><a class="btn btn-primary">                    <span class="glyphicon glyphicon-circle-arrow-left"></span> Back</a> '+z+'                     <span class="text-danger">Trash Bin</span> <small><span class="text-muted">(Undelete option coming soon)</span></small></h4>'),"undefined"==typeof A){$(d).append('<table id="'+c+'-trash"                         class="table table-bordered table-striped" style="width: 100%;"></table>');var e=m(a.deleted_objs,a.obj_mapping),f=e[0];e[1];b.aaData=f,A=$("#"+c+"-trash").dataTable(b),n()}else $("#"+c+"-trash_wrapper").show();$(".trash-header .btn").unbind("click"),$(".trash-header .btn").click(function(){A.find(".table-options").remove(),A.fnDestroy(),$("#"+c+"-trash").remove(),A=void 0,$(".trash-header").remove(),$("#"+c+"_wrapper").show()})}function s(){var b=[];for(var c in a.checkedList){var d={};d.workspace=a.checkedList[c].ws,d.name=a.checkedList[c].name,b.push(d)}var e=kb.ws.delete_objects(b);return $.when(e).done(function(c){kb.ui.notify("Moved "+b.length+" object(s) to trashbin"),a.tab?a.loadNarTable(a.tab):a.loadObjTable(),a.checkedList=[],a.$apply()}),e}function t(){var a=$(".ncheck-checked").eq(0).parents("tr").find("td").eq(1),b=a.find(".obj-id"),c=b.data("ws"),d=b.data("name"),e=$(".ncheck-checked").eq(0).parents("tr").find(".show-versions"),f=$(".ncheck-checked").eq(0).parents("tr").find(".btn-show-info"),g=$('<input type="text" class="form-control">'),h=$('<div class="col-sm-4 input-group input-group-sm"></div>');h.append(g),g.val(d),b.parents("td").html(g),g.keypress(function(a){13==a.which&&$(this).blur()}),g.focusout(function(){var h=$(this).val();if(h!=d){var i=$("<span>saving...</span>");g.parents("td").html(i);var j=kb.ws.rename_object({obj:{workspace:c,name:d},new_name:h});$.when(j).done(function(c){b.data("name",h),b.text(h),a.html(""),a.append(b," (",e,")",f),i.parents("td").html(a),n()}).fail(function(c){i.parents("td").html(a),a.append(' <span class="text-danger">'+c.error.message+"</span>"),a.find("span").delay(3e3).fadeOut(400,function(){a.html(""),a.append(b," (",e,")",f),n()})})}else a.html(""),a.append(b," (",e,")",f),n()}),$(".nar-selected .nar-link").parent().html(h),g.focus()}function u(){var a=$('<form class="form-horizontal" role="form">                                    <div class="form-group">                                    </div>                                 </div>').loading(),b=$("<div></div>").kbasePrompt({title:"Copy Objects",body:a,modalClass:"",controls:["cancelButton",{name:"Copy",type:"primary",callback:function(a,b){var c=$(".select-ws-input").val();x(c,b)}}]});b.openPrompt();var c=kb.getWorkspaceSelector();$.when(c).done(function(b){a.rmLoading(),a.find(".form-group").append(b)})}function v(){var b=$('<form class="form-horizontal" role="form">                                        <div class="form-group">                                          <label class="col-sm-5 control-label">Destination Workspace</label>                                        </div>                                     </div>').loading(),c=$("<div></div>").kbasePrompt({title:"Copy Objects",body:b,modalClass:"",controls:["cancelButton",{name:"Copy",type:"primary",callback:function(a,b){var c=$(".select-ws option:selected").val();x(c,b)}}]});c.openPrompt();var d=kb.getNarrativeDeps({ws:z,name:name});$.when(d).done(function(c){b.append("<h5>Objects to be copied:</h5>");var d=$('<table class="table table-striped table-nar-deps">');d.append("<tr><th>Name</th><th>Type</th></tr>"),d.append("<tr><td>"+a.checkedList[0].name+"</td><td>Narrative</td></tr>");for(var e in c){var f=c[e];d.append('<tr data-name="'+f.name+'" data-type="'+f.type+'"><td>'+f.name+"</td><td>"+f.type+"</td></tr>")}b.append(d)});var d=kb.ws.list_workspace_info({});$.when(d).done(function(a){b.rmLoading();var c=($('<form class="form-horizontal" role="form">                                        <div class="form-group">                                          <label class="col-sm-5 control-label">Destination Workspace</label>                                        </div>                                     </div>'),$('<select class="form-control select-ws"></select>'));for(var d in a)c.append("<option>"+a[d][1]+"</option>");c=$('<div class="col-sm-5">').append(c),b.find(".form-group").append(c)})}function w(){x(USER_ID+":home")}function x(b,c){var d='<div class="alert alert-danger"><strong>Warning</strong> Are you sure you want to copy these <b>'+a.checkedList.length+"</b> objects to <i>"+b+"</i>?",e=$("<div></div>").kbasePrompt({title:"Confirm",body:d,modalClass:"",controls:[{name:"No",type:"default",callback:function(a,b){b.closePrompt()}},{name:"Yes",type:"primary",callback:function(d,e){var f=[];for(var g in a.checkedList){var h=a.checkedList[g].name,i={from:{workspace:z,name:h},to:{workspace:b,name:h}},j=kb.ws.copy_object(i);f.push(j)}$.when.apply($,f).done(function(){a.loadWSTable(),kb.ui.notify("Copied objects to: <i>"+b+"</i>"),c.closePrompt(),e.closePrompt()}).fail(function(a){e.addCover("Could not copy some or all of the objects. "+a.error.message,"danger")})}}]});e.openPrompt()}var y,z=a.ws;a.favs,a.checkedList=[],a.updateFavStars=function(){$xml.find("td").each(function(a){oTable.fnUpdate([c1,c2,c3],a)})},a.$watch("checkedList",function(){$(".obj-check-box").each(function(){var b=a.checkedList,c=!1;for(var d in b)if(b[d].name==$(this).data("name")&&b[d].ws==$(this).data("ws")&&b[d].type==$(this).data("type")){$(this).addClass("ncheck-checked"),c=!0;break}c||$(this).removeClass("ncheck-checked")});var b=a.checkedList.length?a.checkedList.length:"";$(".checked-count").text(b),1==a.checkedList.length?$(".object-options, .btn-rename-obj").removeClass("hide"):a.checkedList.length>1?($(".object-options").removeClass("hide"),$(".btn-rename-obj").addClass("hide")):$(".object-options").addClass("hide")},!0),a.loadObjTable=function(){var c="obj-table",e='<div class="ncheck check-option btn-select-all"></div>',f=[USER_ID?{sTitle:e,bSortable:!1,sWidth:"1%"}:{bVisible:!1,sWidth:"1%"},{sTitle:"Name",sContentPadding:"xxxxxxxMore"},{sTitle:"Type"},{sTitle:"Last Modified",iDataSort:5},{sTitle:"Modified By",bVisible:!0},{sTitle:"Timestamp",bVisible:!1,sType:"numeric"},{sTitle:"Size",iDataSort:7},{sTitle:"Byte Size",bVisible:!1},{sTitle:"Module",bVisible:!1}],i={sPaginationType:"full_numbers",stateSave:USER_ID?!0:!1,stateSaveParams:function(a,b){b.search.search=""},oColReorder:{iFixedColumns:USER_ID?1:0},iDisplayLength:10,aaData:[],fnDrawCallback:n,aaSorting:[[3,"desc"]],aoColumns:f,oLanguage:{sEmptyTable:"No objects in workspace",sSearch:"Search: "}};$(d).html(""),$(d).loading("<br>loading<br>"+z+"...",!0);var k=kb.ws.list_objects({workspaces:[z]}),l=kb.ws.list_objects({workspaces:[z],showOnlyDeleted:1}),p=void 0,q=$.getJSON("landing_page_map.json");$.when(k,l,p,q).done(function(e,f,k,l){k&&(a.favs=1==k[0]?k[1]:[]),a.deleted_objs=f,a.obj_mapping=l[0],$(d).rmLoading();var p=$('<table id="'+c+'" class="table table-bordered table-striped" style="width: 100%;">');$(d).append(p);var q=m(e,l),r=q[0],s=q[1];i.aaData=r,y=p.dataTable(i),b(y)(a),y.fnFilter(a.type?a.type+"-.*":"",getCols(y,"Type"),!0);var t=j();$(".dataTables_filter").after(t);var u=g(y);if($(".table-options").append(u),$(".settings-dropdown").click(function(a){a.stopPropagation()}),USER_ID&&t.removeClass("hide"),e.length){var v=h(y,s,a.type);$(".table-options").append(v)}o(),n()}).fail(function(a){$(d).html('<div class="alert alert-danger">'+a.error.message+"</div>")})},a.loadNarTable=function(c){var e='<div class="ncheck check-option btn-select-all"></div>',f=[USER_ID?{sTitle:e,bSortable:!1,sWidth:"1%"}:{bVisible:!1,sWidth:"1%"},{sTitle:"Narrative",sType:"html",sContentPadding:"xxxxxxxMore"},{sTitle:"Workspace",sType:"html",sContentPadding:"btn"},{sTitle:"Last Modified",iDataSort:5},{sTitle:"Modified by",bVisible:!0},{sTitle:"Timestamp",bVisible:!1,sType:"numeric"},{sTitle:"Size",bVisible:!1,iDataSort:7},{sTitle:"Byte Size",bVisible:!1},{sTitle:"Module",bVisible:!1}];"public"!=c&&f.push({sTitle:"Shared With"});var h={sPaginationType:"full_numbers",stateSave:USER_ID?!0:!1,stateSaveParams:function(a,b){b.search.search=""},oColReorder:{iFixedColumns:USER_ID?1:0},iDisplayLength:10,aaData:[],fnDrawCallback:n,aaSorting:[[3,"desc"]],aoColumns:f,oLanguage:{sEmptyTable:"No narratives",sSearch:"Search: "}};$(d).html(""),$(d).loading("<br>Loading<br>Narratives...","big");var i=kb.getNarratives();$.when(i).done(function(e){if($(d).rmLoading(),"my-narratives"==c)var f=e.my_narratives,i=!0,j="my-nar-table";else if("shared"==c)var f=e.shared_narratives,j="shared-nar-table";else if("public"==c)var f=e.public_narratives,j="public-nar-table";var k=e.perms,m=$('<table id="'+j+'" class="table table-bordered table-striped" style="width: 100%;">');if($(d).append(m),"public"!=c)var p=l(f,i,k);else var p=l(f,i);h.aaData=p,y=m.dataTable(h),b(y)(a);var q=g(y,"nar");$(".table-options").append(q),$(".settings-dropdown").click(function(a){a.stopPropagation()}),o(),n()}).fail(function(a){$(d).html('<div class="alert alert-danger">'+a.error.message+"</div>")})},a.tab&&"featured"!=a.tab?a.loadNarTable(a.tab):a.loadObjTable();var A}}}).directive("newnarrativebtn",function(a,b){return{template:'<a class="btn-new-narrative" ng-click="createNewNarrative()"><b><span class="glyphicon glyphicon-plus"></span> New Narrative</b></a>',controller:"WB",link:function(c,d,e){c.createNewNarrative=function(){var d=$('<form class="form-horizontal" role="form">');d.loading();var e=$("<div>").kbasePrompt({title:"Create New Narrative",body:d,modalClass:"",controls:[{name:"Cancel",type:"default",callback:function(a,b){b.closePrompt()}},{name:"Create",type:"primary",callback:function(b,d){var e=$(".select-ws-input").val(),f=$(".new-nar-id").val(),g=($(".create-permission option:selected").val(),$(".nar-description option:selected").val()),h={narrative_id:f,project_id:e,description:g};if(""===f)return d.addAlert("must enter a narrative name"),void $(".new-nar-id").focus();var i=kb.nar.new_narrative(h);d.addCover(),d.getCover().loading(),$.when(i).done(function(){"my-narratives"==c.tab?(a.go("narratives.mynarratives",null,{reload:!0}),c.$apply()):(a.go("narratives.mynarratives"),c.$apply()),kb.ui.notify("Created new narrative: <i>"+f+"</i>"),d.closePrompt()}).fail(function(a){d.addCover(a.error.message,"danger")})}}]});e.openPrompt();var f=kb.getWorkspaceSelector();$.when(f).done(function(a){d.rmLoading();var f=$('<a class="btn btn-link">New WS</a>');f.click(function(){e.closePrompt(),b.createWS({cancel_cb:function(){c.createNewNarrative()},submit_cb:function(){c.createNewNarrative()}})}),a.find(".form-group").append(f),d.append(a),d.append('<div class="form-group"><label class="col-sm-5 control-label">Narrative Name</label><div class="col-sm-4"><input type="text" class="form-control new-nar-id"></div></div><div class="form-group"><label class="col-sm-5 control-label">Description</label><div class="col-sm-7"><textarea class="form-control nar-descript" rows="3"></textarea></div></div>')})}}}}).directive("showHideSidebar",function(a,b,c,d){return{template:'<button class="btn btn-default btn-xs btn-hide-sidebar"><span class="caret-left"></span> <span class="glyphicon glyphicon-th-list"></span></button>',link:function(a,b,c){$(b).click(function(){$(".sidebar").hasClass("col-sm-3")?$(b).parents(".sidebar").toggle("slide",{direction:"left",duration:"fast",complete:function(){$(".ws-selector").hide();var a=$(".sidebar");a.removeClass("col-sm-3 col-md-3"),a.addClass("sidebar-minimized"),a.show();var c=$(".main").addClass("main-fullsize");c.removeClass("col-sm-9 col-sm-offset-3 col-md-9 col-md-offset-3 main"),c.addClass("col-sm-12 col-md-12 main-fullsize");var d=$(b).find(".caret-left");d.remove(),$(b).find(".btn-hide-sidebar").append(' <span class="caret-right"></span>')}}):$(b).parents(".sidebar").toggle("slide",{direction:"right",duration:"fast",complete:function(){$(".ws-selector").show();var a=$(".sidebar");a.removeClass("sidebar-minimized"),a.addClass("col-sm-3 col-md-3"),a.show();var c=$(".main-fullsize");c.removeClass("col-sm-12 col-md-12"),c.addClass("col-sm-9 col-sm-offset-3 col-md-9 col-md-offset-3 main"),$(".main").removeClass("main-fullsize");var d=$(b).find(".caret-right");d.remove(),$(b).find(".btn-hide-sidebar").prepend('<span class="caret-left"></span> ')}})})}}}).directive("wsDescription",function(a,b,c){return{
link:function(a,b,c){var d=kb.ws.get_workspace_description({workspace:a.ws});$.when(d).done(function(c){if(c){a.$apply(function(){a.description=c});var d=$(b),e=$('<div class="ellipsis" data-toggle="popover">'+a.description+"</div>");d.append(e),$(b).append(d),e.popover({content:c,trigger:"hover",placement:"bottom",delay:{show:1500}})}}).fail(function(a){$(b).append('<div class="alert alert-danger">'+a.error.message+"</div>")})}}}).directive("wsmanage",function(a,b,c,d){return{link:function(a,c,d){$(c).append('<div class="h3 pull-left" style="margin-right: 30px;">Workspace Inspector</div>');var e={aaData:[],aaSorting:[[2,"desc"]],iDisplayLength:1e3,aoColumns:[{sTitle:"Workspace"},{sTitle:"ID"},{sTitle:"Owner"},{sTitle:"Last Modified",iDataSort:4},{sTitle:"Count"},{sTitle:"Time Stamp",bVisible:!1,sType:"numeric"}],sDom:"R<'row'<'col-xs-12 table-options'i>r>t<'row'<'col-xs-12'>>",oLanguage:{sEmptyTable:"No workspaces found",sSearch:"Search: ",sInfo:'_TOTAL_ workspaces, excluding "kbasesearch"',sInfoFiltered:""}};$(c).loading();var f=kb.ws.list_workspace_info({});$.when(f).done(function(d){$(c).rmLoading();var f=[],g=0;for(var h in d){var i=d[h],j=i[2];if("kbasesearch"!=j){var k=kb.ui.getTimestamp(d[h][3].split("+")[0]),l=kb.ui.formateDate(k),m=i[0],n=i[1],o=i[4];g+=o;var p="ws.id({ws:'"+n+"'})",q='<a ui-sref="'+p+'" >'+n+"</a>";f.push([q,m,j,l,o,k])}}e.aaData=f;var r=$('<table id="ws-manage" class="table table-bordered" style="width: 100%;"></table>');$(c).append(r);var s=$(r).dataTable(e);b(s)(a),$(".table-options").append('<span class="badge badge-primary pull-right">'+g+" Objects</span>"),$("#ws-manage thead th").each(function(){var a=$("#ws-manage thead th").eq($(this).index()).text();$(this).append(' <div><input type="text" class="select-filter" placeholder="Search '+a+'" ></input></div>')}),$("thead input").click(function(a){a.stopPropagation(),a.preventDefault(),$(this).focus()}),$("input").keyup(function(){s.fnFilter(this.value,s.oApi._fnVisibleToColumnIndex(s.fnSettings(),$("thead input").index(this)),!0)})})}}});