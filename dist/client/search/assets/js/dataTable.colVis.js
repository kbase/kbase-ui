!function(a){var b=function(c,d){return this.CLASS&&"ColVis"==this.CLASS||alert("Warning: ColVis must be initialised with the keyword 'new'"),"undefined"==typeof d&&(d={}),this.s={dt:null,oInit:d,hidden:!0,abOriginal:[]},this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],groupButtons:[],restore:null},b.aInstances.push(this),this.s.dt=a.fn.dataTable.Api?new a.fn.dataTable.Api(c).settings()[0]:c,console.log(this.s.dt),this._fnConstruct(d),this};b.prototype={button:function(){return this.dom.wrapper},fnRebuild:function(){this.rebuild()},rebuild:function(){for(var a=this.dom.buttons.length-1;a>=0;a--)this.dom.collection.removeChild(this.dom.buttons[a]);this.dom.buttons.splice(0,this.dom.buttons.length),this.dom.restore&&this.dom.restore.parentNode(this.dom.restore),this._fnAddGroups(),this._fnAddButtons(),this._fnDrawCallback()},_fnConstruct:function(b){this._fnApplyCustomisation(b);var c,d,e=this;if(this.dom.wrapper=document.createElement("div"),this.dom.wrapper.className="ColVis",this.dom.button=a("<button />",{"class":this.s.dt.bJUI?"ColVis_Button ColVis_MasterButton ui-button ui-state-default":"ColVis_Button ColVis_MasterButton"}).append("<span>"+this.s.buttonText+"</span>").bind("mouseover"==this.s.activate?"mouseover":"click",function(a){a.preventDefault(),e._fnCollectionShow()}).appendTo(this.dom.wrapper)[0],this.dom.catcher=this._fnDomCatcher(),this.dom.collection=this._fnDomCollection(),this._fnAddGroups(),this._fnAddButtons(),this.s.dt.aoColumns)for(c=0,d=this.s.dt.aoColumns.length;d>c;c++)this.s.abOriginal.push(this.s.dt.aoColumns[c].bVisible);this.s.dt.aoDrawCallback&&this.s.dt.aoDrawCallback.push({fn:function(){e._fnDrawCallback.call(e)},sName:"ColVis"}),a(this.s.dt.oInstance).bind("column-reorder",function(a,b,f){for(c=0,d=e.s.aiExclude.length;d>c;c++)e.s.aiExclude[c]=f.aiInvertMapping[e.s.aiExclude[c]];var g=e.s.abOriginal.splice(f.iFrom,1)[0];e.s.abOriginal.splice(f.iTo,0,g),e.fnRebuild()})},_fnApplyCustomisation:function(c){a.extend(!0,this.s,b.defaults,c),!this.s.showAll&&this.s.bShowAll&&(this.s.showAll=this.s.sShowAll),!this.s.restore&&this.s.bRestore&&(this.s.restore=this.s.sRestore)},_fnDrawCallback:function(){for(var b,c=this.s.dt.aoColumns,d=this.dom.buttons,e=this.s.aoGroups,f=0,g=d.length;g>f;f++)b=d[f],void 0!==b.__columnIdx&&a("input",b).prop("checked",c[b.__columnIdx].bVisible);for(var h=function(a){for(var b=0,d=a.length;d>b;b++)if(c[a[b]].bVisible===!1)return!1;return!0},i=function(a){for(var b=0,d=a.length;d>b;b++)if(c[a[b]].bVisible===!0)return!1;return!0},j=0,k=e.length;k>j;j++)h(e[j].aiColumns)?(a("input",this.dom.groupButtons[j]).prop("checked",!0),a("input",this.dom.groupButtons[j]).prop("indeterminate",!1)):i(e[j].aiColumns)?(a("input",this.dom.groupButtons[j]).prop("checked",!1),a("input",this.dom.groupButtons[j]).prop("indeterminate",!1)):a("input",this.dom.groupButtons[j]).prop("indeterminate",!0)},_fnAddGroups:function(){var a;if("undefined"!=typeof this.s.aoGroups)for(var b=0,c=this.s.aoGroups.length;c>b;b++)a=this._fnDomGroupButton(b),this.dom.groupButtons.push(a),this.dom.buttons.push(a),this.dom.collection.appendChild(a)},_fnAddButtons:function(){var b,c=this.s.dt.aoColumns;if(-1===a.inArray("all",this.s.aiExclude)&&c)for(var d=0,e=c.length;e>d;d++)-1===a.inArray(d,this.s.aiExclude)&&(b=this._fnDomColumnButton(d),b.__columnIdx=d,this.dom.buttons.push(b));"alpha"===this.s.order&&this.dom.buttons.sort(function(a,b){var d=c[a.__columnIdx].sTitle,e=c[b.__columnIdx].sTitle;return d===e?0:e>d?-1:1}),this.s.restore&&(b=this._fnDomRestoreButton(),b.className+=" ColVis_Restore",this.dom.buttons.push(b)),this.s.showAll&&(b=this._fnDomShowAllButton(),b.className+=" ColVis_ShowAll",this.dom.buttons.push(b)),a(this.dom.collection).append(this.dom.buttons)},_fnDomRestoreButton:function(){var b=this,c=this.s.dt;return a('<li class="ColVis_Special '+(c.bJUI?"ui-button ui-state-default":"")+'">'+this.s.restore+"</li>").click(function(a){for(var c=0,d=b.s.abOriginal.length;d>c;c++)b.s.dt.oInstance.fnSetColumnVis(c,b.s.abOriginal[c],!1);b._fnAdjustOpenRows(),b.s.dt.oInstance.fnAdjustColumnSizing(!1),b.s.dt.oInstance.fnDraw(!1)})[0]},_fnDomShowAllButton:function(){var b=this,c=this.s.dt;return a('<li class="ColVis_Special '+(c.bJUI?"ui-button ui-state-default":"")+'">'+this.s.showAll+"</li>").click(function(a){for(var c=0,d=b.s.abOriginal.length;d>c;c++)-1===b.s.aiExclude.indexOf(c)&&b.s.dt.oInstance.fnSetColumnVis(c,!0,!1);b._fnAdjustOpenRows(),b.s.dt.oInstance.fnAdjustColumnSizing(!1),b.s.dt.oInstance.fnDraw(!1)})[0]},_fnDomGroupButton:function(b){var c=this,d=this.s.dt,e=this.s.aoGroups[b];return a('<li class="ColVis_Special '+(d.bJUI?"ui-button ui-state-default":"")+'"><label><input type="checkbox" /><span>'+e.sTitle+"</span></label></li>").click(function(b){var d=!a("input",this).is(":checked");"li"!==b.target.nodeName.toLowerCase()&&(d=!d);for(var f=0;f<e.aiColumns.length;f++)c.s.dt.oInstance.fnSetColumnVis(e.aiColumns[f],d)})[0]},_fnDomColumnButton:function(b){var c=this,d=this.s.dt.aoColumns[b],e=this.s.dt,f=null===this.s.fnLabel?d.sTitle:this.s.fnLabel(b,d.sTitle,d.nTh);return a("<li "+(e.bJUI?'class="ui-button ui-state-default"':"")+'><label><input type="checkbox" /><span>'+f+"</span></label></li>").click(function(d){var f=!a("input",this).is(":checked");"li"!==d.target.nodeName.toLowerCase()&&(f=!f);var g=a.fn.dataTableExt.iApiIndex;a.fn.dataTableExt.iApiIndex=c._fnDataTablesApiIndex.call(c),e.oFeatures.bServerSide?(c.s.dt.oInstance.fnSetColumnVis(b,f,!1),c.s.dt.oInstance.fnAdjustColumnSizing(!1),(""!==e.oScroll.sX||""!==e.oScroll.sY)&&c.s.dt.oInstance.oApi._fnScrollDraw(c.s.dt),c._fnDrawCallback()):c.s.dt.oInstance.fnSetColumnVis(b,f),a.fn.dataTableExt.iApiIndex=g,null!==c.s.fnStateChange&&c.s.fnStateChange.call(c,b,f)})[0]},_fnDataTablesApiIndex:function(){for(var a=0,b=this.s.dt.oInstance.length;b>a;a++)if(this.s.dt.oInstance[a]==this.s.dt.nTable)return a;return 0},_fnDomCollection:function(){return a("<ul />",{"class":this.s.dt.bJUI?"ColVis_collection ui-buttonset ui-buttonset-multi":"ColVis_collection"}).css({display:"none",opacity:0,position:this.s.bCssPosition?"":"absolute"})[0]},_fnDomCatcher:function(){var b=this,c=document.createElement("div");return c.className="ColVis_catcher",a(c).click(function(){b._fnCollectionHide.call(b,null,null)}),c},_fnDomBackground:function(){var b=this,c=a("<div></div>").addClass("ColVis_collectionBackground").css("opacity",0).click(function(){b._fnCollectionHide.call(b,null,null)});return"mouseover"==this.s.activate&&c.mouseover(function(){b.s.overcollection=!1,b._fnCollectionHide.call(b,null,null)}),c[0]},_fnCollectionShow:function(){var b,c=this,d=a(this.dom.button).offset(),e=this.dom.collection,f=parseInt(d.left,10),g=parseInt(d.top+a(this.dom.button).outerHeight(),10);this.s.bCssPosition||(e.style.top=g+"px",e.style.left=f+"px"),a(e).css({display:"block",opacity:0});var h=this.dom.catcher.style;if(h.height=a(this.dom.button).outerHeight()+"px",h.width=a(this.dom.button).outerWidth()+"px",h.top=d.top+"px",h.left=f+"px",document.body.appendChild(e),document.body.appendChild(this.dom.catcher),a(e).animate({opacity:1},c.s.iOverlayFade),!this.s.bCssPosition){b="left"==this.s.sAlign?f:f-a(e).outerWidth()+a(this.dom.button).outerWidth(),e.style.left=b+"px";var i=a(e).outerWidth(),j=(a(e).outerHeight(),a(document).width());b+i>j&&(e.style.left=j-i+"px")}this.s.hidden=!1},_fnCollectionHide:function(){var b=this;this.s.hidden||null===this.dom.collection||(this.s.hidden=!0,a(this.dom.collection).animate({opacity:0},b.s.iOverlayFade,function(a){this.style.display="none"}),a(this.dom.background).animate({opacity:0},b.s.iOverlayFade,function(a){document.body.removeChild(b.dom.background),document.body.removeChild(b.dom.catcher)}))},_fnAdjustOpenRows:function(){for(var a=this.s.dt.aoOpenRows,b=this.s.dt.oApi._fnVisbleColumns(this.s.dt),c=0,d=a.length;d>c;c++)a[c].nTr.getElementsByTagName("td")[0].colSpan=b}},b.fnRebuild=function(a){var c=null;"undefined"!=typeof a&&(c=a.fnSettings().nTable);for(var d=0,e=b.aInstances.length;e>d;d++)("undefined"==typeof a||c==b.aInstances[d].s.dt.nTable)&&b.aInstances[d].fnRebuild()},b.defaults={active:"click",buttonText:"Show / hide columns",aiExclude:[],bRestore:!1,sRestore:"Restore original",bShowAll:!1,sShowAll:"Show All",sAlign:"left",fnStateChange:null,iOverlayFade:500,fnLabel:null,bCssPosition:!1,aoGroups:[],order:"column"},b.aInstances=[],b.prototype.CLASS="ColVis",b.VERSION="1.1.0-dev",b.prototype.VERSION=b.VERSION,"function"==typeof a.fn.dataTable&&"function"==typeof a.fn.dataTableExt.fnVersionCheck&&a.fn.dataTableExt.fnVersionCheck("1.7.0")?a.fn.dataTableExt.aoFeatures.push({fnInit:function(a){var c="undefined"==typeof a.oInit.oColVis?{}:a.oInit.oColVis,d=new b(a,c);return d.dom.wrapper},cFeature:"C",sFeature:"ColVis"}):alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download"),a.fn.dataTable.ColVis=b}(jQuery);