!function(a){"use strict";var b=Object.create({},{init:{value:function(a){return this.refreshSession(),this}},session:{value:null,writable:!0},sessionObject:{value:null,writable:!0},cookieName:{value:"kbase_session"},narrCookieName:{value:"kbase_narr_session"},getKBaseSession:{value:function(){return this.refreshSession()}},refreshSession:{value:function(){try{this.sessionObject=this.importSessionFromCookie()}catch(a){console.log("ERROR: kbaseSessionSync.refreshSession"),console.log("Error reading session cookie, resetting session."),this.removeAuth(),this.sessionObject=null}return this.sessionObject&&this.isExpired()&&(this.removeAuth(),this.sessionObject=null),this.sessionObject}},sessionChanged:{value:function(){var b=a.cookie(this.cookieName);return this.sessionCookie===b?!1:!0}},importSessionFromCookie:{value:function(){var b=a.cookie(this.cookieName);if(!b)return null;var c=this.decodeToken(b);return this.validateKBaseSessionObject(c)?(c.token=c.token.replace(/PIPESIGN/g,"|").replace(/EQUALSSIGN/g,"="),c.tokenObject=this.decodeToken(c.token),this.validateSessionObject(c)?c:(this.removeAuth(),null)):(this.removeAuth(),null)}},decodeToken:{value:function(a){for(var b=a.split("|"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0],g=e[1];c[f]=g}return c}},decodeSessionString:{value:function(a){if(!a||0===a.length)return null;var b=this.decodeToken(a);return b?b.kbase_sessionid&&b.un&&b.user_id&&b.token?(b.token=b.token.replace(/PIPESIGN/g,"|").replace(/EQUALSSIGN/g,"="),b.tokenObject=this.decodeToken(b.token),b):(this.removeAuth(),null):null}},validateKBaseSessionObject:{value:function(a){return a&&a.kbase_sessionid&&a.un&&a.user_id&&a.token?!0:!1}},validateSessionObject:{value:function(a){return a&&a.kbase_sessionid&&a.un&&a.user_id&&a.token&&a.tokenObject&&a.tokenObject.expiry&&/^\d+$/.test(a.tokenObject.expiry)?!0:!1}},isExpired:{value:function(){var a=this.sessionObject.tokenObject.expiry;if(!a)return!1;if(a=parseInt(a),isNaN(a))return!1;var b=new Date(1e3*a),c=b-new Date;return 0>=c?!0:!1}},removeAuth:{value:function(){a.removeCookie(this.cookieName,{path:"/"}),a.removeCookie(this.cookieName,{path:"/",domain:"kbase.us"}),a.removeCookie(this.narrCookieName,{path:"/"}),a.removeCookie(this.narrCookieName,{path:"/",domain:"kbase.us"}),localStorage.removeItem(this.cookieName)}},isLoggedIn:{value:function(){return this.getKBaseSession()?!0:!1}}});a.KBaseSessionSync=b.init()}(jQuery);