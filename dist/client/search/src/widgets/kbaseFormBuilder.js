!function(a,b){a.KBWidget({name:"kbaseFormBuilder",version:"1.0.0",options:{elements:[],dispatch:{text:"buildTextField",textarea:"buildTextArea",password:"buildSecureTextField",checkbox:"buildCheckbox",select:"buildSelectbox",multiselect:"buildSelectbox",radio:"buildRadioButton",string:"buildTextField",secure:"buildSecureTextField","enum":"buildSelectbox","boolean":"buildCheckbox"},canSubmit:!1},init:function(a){return this._super(a),this.$elem.append(this._buildForm(this.options.elements)),this},getFormValuesAsObject:function(){var b=this.getFormValuesAsArray(),c={};return a.each(b,function(a,b){c[b[0]]=b.slice(1),1==b.length&&(c[b[0]]=!0)}),c},getFormValuesAsArray:function(){var a=[],c=this.data("formValues"),d=this.data("form").get(0);for(key in c){var e=c[key],f=e.name,g=e.type,h=[];if("[object NodeList]"==d[f])for(var i=0;i<d[f].length;i++)h.push(d[f][i]);else h=[d[f]];if("checkbox"==g)d[f].checked&&a.push([key]);else if("multiselect"==g){var j=[key],k=j;e.asArray&&(k=[],j.push(k));for(var l=0,i=0;i<d[f].length;i++)d[f][i].selected&&(l=1,k.push(d[f][i].value));l&&a.push(j)}else if("radio"==g){for(var j=[key],l=0,i=0;i<d[f].length;i++)d[f][i].checked&&(l=1,j.push(d[f][i].value));l&&a.push(j)}else{for(var m=[],i=0;i<h.length;i++)if(e.json){var n=JSON.parse(h[i].value);e.asArray&&(n=[n]),m.push(n)}else m.push(this.carve(h[i].value,e.split,e.asArray));if(m.length>0){if(1==m.length&&(m=m[0],0==m.length))continue;a.push([key,m])}}}if(this.options.returnArrayStructure!=b){for(var o=[],p={},i=0;i<a.length;i++)p[a[i][0]]=a[i][1];for(var i=0;i<this.options.returnArrayStructure.length;i++)o.push(p[this.options.returnArrayStructure[i]]);a=o}return a},carve:function(c,d,e){d=d==b?[]:"string"==typeof d?[d]:d.slice(0);var f=d.shift();if(f==b)return e&&"string"==typeof c&&(c=[c]),c;var g=new RegExp(" *"+f+" *");return"string"==typeof c?this.carve(c.split(g),d,e):(d.push(f),jQuery.each(c,a.proxy(function(a,b){c[a]=this.carve(b,d,e)},this)),c)},escapeValue:function(a){return a=a.replace(/"/g,'\\"'),'"'+a+'"'},getFormValuesAsString:function(){var a=this.getFormValuesAsArray();if(this.options.returnArrayStructure!=b)return JSON.stringify(a);for(var c=[],d=0;d<a.length;d++){var e=a[d];if(1==e.length)c.push(e[0]);else for(var f=1;f<e.length;f++)this.data("formValues")[e[0]].valOnly?c.push(e[f]):"string"==typeof e[f]?c.push(e[0]+" "+this.escapeValue(e[f])):c.push(e[0]+" "+this.escapeValue(JSON.stringify(e[f])))}return c.join(" ")},_buildForm:function(c){var d=a.jqElem("form").addClass("form-horizontal");c.action&&form.attr("action",c.action),c.method&&form.attr("method",c.method),c.canSubmit||d.bind("submit",function(a){return!1}),this.data("form",d);var e=this.data("formValues",{}),f=b;return a.each(c,a.proxy(function(c,g){if(g.key==b&&(g.key=g.name),e[g.key]!=b){var h="FORM ERROR. KEY "+g.key+" IS DOUBLE DEFINED";return d=h,!1}e[g.key]=g,g.fieldset?(f==b||f.attr("name")!=g.fieldset)&&(f=a.jqElem("fieldset").attr("name",g.fieldset).append(a.jqElem("legend").append(g.fieldset)),d.append(f)):f=d;var i=g.label!=b?g.label:g.name,j=a.jqElem("label").addClass("control-label col-lg-2").append(a.jqElem("span").attr("title",i).append(i)).bind("click",function(b){a(this).next().children().first().focus()});this.options.values[g.key]!=b&&(g.value=g.checked=g.selected=this.options.values[g.key]);var k;g.type==b&&(g.type="text"),k=this.options.dispatch[g.type]?this[this.options.dispatch[g.type]](g):this.buildTextField(g);var l,m=a("<div></div>").addClass("col-lg-10");g.description&&(l=a.jqElem("span").addClass("help-block").append(g.description)),g.multi?m.append(a.jqElem("div").addClass("input-group").append(k).append(a.jqElem("span").addClass("input-group-btn").append(a("<button></button>").addClass("btn btn-default").attr("title","Add more").append(a("<i></i>").addClass("icon-plus")).bind("click",function(a){m.append(k.clone()),a.stopPropagation()})))).append(l):m.append(k).append(l),g.disabled&&k.prop("disabled",!0),d.append(a("<div></div>").addClass("form-group").append(j).append(m))},this)),d},buildTextField:function(b){return a.jqElem("input").attr("type","text").attr("value",b.value).attr("name",b.name).addClass("form-control")},buildTextArea:function(b){var c=a.jqElem("textarea").attr("name",b.name).addClass("form-control").append(b.value);return b.rows&&c.attr("rows",b.rows),c},buildSecureTextField:function(b){return a.jqElem("input").attr("type","password").attr("value",b.value).attr("name",b.name).addClass("form-control")},buildCheckbox:function(b){var c=a.jqElem("input").attr("type","checkbox").addClass("form-control").attr("name",b.name).attr("value",b.value);return b.checked&&c.prop("checked",!0),c},buildRadioButton:function(b){var c=a.jqElem("div");return a.each(b.values,a.proxy(function(d,e){var f=e,g=e;"string"!=typeof e&&(f=e.value,g=e.name);var h=a.jqElem("div").addClass("radio"),i=a.jqElem("input").attr("type","radio").attr("name",b.name).attr("value",f);b.checked==f&&i.prop("checked",!0);var j=a.jqElem("label").addClass("control-label").append(i).append(g);h.append(j),c.append(h)},this)),c},buildSelectbox:function(c){var d=a.jqElem("select").attr("name",c.name).addClass("form-control");return"multiselect"==c.type&&(d.prop("multiple",!0),c.size&&d.attr("size",c.size)),c.names==b&&(c.names=[]),a.each(c.values,function(b,e){var f=e,g=e;"string"!=typeof e&&(f=e.value,g=e.name);var h=a.jqElem("option").attr("value",f).append(g);"string"==typeof c.selected&&c.selected==f?h.prop("selected",!0):"object"==typeof c.selected&&a.each(c.selected,function(a,b){b==f&&h.prop("selected",!0)}),d.append(h)}),d}})}(jQuery);