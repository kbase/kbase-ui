define(["jquery","nunjucks","kb.session","kb.config"],function(a,b,c,d){"use strict";var e=Object.create({},{version:{value:"0.0.2",writable:!1},init:{value:function(c){return"string"==typeof c.container?this.container=a(c.container):this.container=c.container,this.widgetTitle="Navbar Widget",this.widgetName="Navbar",this.templates={},this.templates.env=new b.Environment(new b.WebLoader("/src/widgets/"+this.widgetName+"/templates"),{autoescape:!1}),this.templates.env.addFilter("kbmarkup",function(a){return a&&(a=a.replace(/\n/g,"<br>")),a}),this.templates.cache={},this.context={},this.context.env={widgetTitle:this.widgetTitle,widgetName:this.widgetName},this}},getVersion:{value:function(){return this.version}},loadCSS:{value:function(){return a("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","/src/widgets/"+this.widgetName+"/style.css"),this}},setTitle:{value:function(a){return this.container.find(".navbar-title").html(a),this}},clear:{value:function(){return this.clearMenu(),this.clearTitle(),this.clearButtons(),this}},clearTitle:{value:function(){return this.container.find(".navbar-title").empty(),this}},clearButtons:{value:function(){return this.container.find(".navbar-buttons").empty(),this}},addButton:{value:function(b){var c="",d="";b.label?d='<div class="kb-nav-btn-txt">'+b.label+"</div>":c+="font-size: 150%;";var e;if(b.url){b.external&&(b.target="_blank");var f;f=b.target?'target="'+b.target+'"':"",e=a('<a data-button="'+b.name+'" id="kb-'+b.name+'-btn" class="btn btn-'+(b.style||"default")+' navbar-btn kb-nav-btn" role="button" href="'+b.url+'" '+f+'>  <div class="fa fa-'+b.icon+'" style="'+c+'"></div>'+d+"</a>")}else e=a('<button data-button="'+b.name+'" id="kb-'+b.name+'-btn" class="btn btn-'+(b.style||"default")+' navbar-btn kb-nav-btn">  <div class="fa fa-'+b.icon+'" style="'+c+'"></div>'+d+"</button>").on("click",function(a){a.preventDefault(),b.callback()});return b.disabled&&e.prop("disabled",!0),"end"===b.place?this.container.find(".navbar-buttons").append(e):this.container.find(".navbar-buttons").prepend(e),this}},findButton:{value:function(a){return this.container.find('.navbar-buttons [data-button="'+a+'"]')}},addDropdown:{value:function(b){var c="",d="";b.label?d='<div class="kb-nav-btn-txt">'+b.label+' <span class="caret"></span></div>':(d=b.label+' <span class="caret"></span>',c+="font-size: 150%;");var e=a('<button  class="btn btn-'+(b.style||"default")+' navbar-btn kb-nav-btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false">  <div class="fa fa-'+b.icon+'" style="'+c+'"></div>'+d+"</button>");b.disabled&&e.prop("disabled",!0);var f=a('<ul class="dropdown-menu" role="menu"></ul>');if(b.items)for(var g=0;g<b.items.length;g++){var h=b.items[g];if("divider"===h.type)f.append('<li class="divider"></li>');else{var i=a("<li></li>");if(h.url)var j=a("<a></a>").attr("href",h.url).attr("data-menu-item",h.name);else if(h.callback)var j=a("<a></a>").attr("href","#").attr("data-menu-item",h.name).on("click",h.callback);h.external&&j.attr("target","_blank");var k=a('<div class="navbar-icon" style=""></div>');h.icon&&k.append(a('<span class="fa fa-'+h.icon+'"  class="navbar-icon"></span>')),f.append(i.append(j.append(k).append(h.label)))}}var l=a('<div class="dropdown" style="display: inline-block;"></div>').append(e).append(f);if("end"===b.place?this.container.find(".navbar-buttons").append(l):this.container.find(".navbar-buttons").prepend(l),b.widget){var m=b.widget,n=a("<div>");f.append(a("<li></li>").append(n));n[m]({dropdown:l,navbar:this,params:b.params})}return this}},addDefaultMenu:{value:function(a){a=a||{};var b=!1;return a.search!==!1&&(this.addMenuItem({name:"search",icon:"search",label:"Search Data",url:"/search/#/search/?q=*",place:"end"}),b=!0),a.narrative!==!1&&(this.addMenuItem({name:"narrative",label:"Narrative",icon:"file",url:"/#narrativemanager/start",external:!0,place:"end"}),b=!0),a.dashboard!==!1&&(this.addMenuItem({name:"dashboard",label:"Dashboard",icon:"dashboard",url:"/#dashboard",place:"end"}),b=!0),b&&this.addMenuItem({type:"divider",name:"help",place:"end"}),this.addHelpMenuItem({name:"contactus",label:"Contact Us",icon:"envelope-o",url:d.getConfig("docsite.baseUrl")+d.getConfig("docsite.paths.contact"),place:"end"}),this.addHelpMenuItem({name:"about",label:"About KBase",icon:"info-circle",url:d.getConfig("docsite.baseUrl")+d.getConfig("docsite.paths.about")}),this}},makeMenuItem:{value:function(b){if("divider"===b.type)var c=a('<li  role="presentation" class="divider"></li>').attr("data-menu-item",b.name);else{var c=a("<li></li>");if(b.url)var d=a("<a></a>").attr("href",b.url).attr("data-menu-item",b.name);else if(b.callback)var d=a("<a></a>").attr("href","#").attr("data-menu-item",b.name).on("click",b.callback);b.external&&d.attr("target","_blank");var e=a('<div class="navbar-icon" style=""></div>');b.icon&&e.append(a('<span class="fa fa-'+b.icon+'"  class="navbar-icon"></span>')),c.append(d.append(e).append(b.label))}return c}},addMenuItem:{value:function(a){var b=this.container.find(".navbar-menu .dropdown-menu");if(b){var c=this.makeMenuItem(a);c&&("end"===a.place?b.append(c):b.prepend(c))}return this}},removeMenuItem:{value:function(a){}},setAboutURL:{value:function(a){}},addHelpMenuItem:{value:function(a){var b=this.makeMenuItem(a);if(b){var c=this.container.find(".navbar-menu .dropdown-menu");if(c)if("end"===a.place)c.append(b);else{var d=c.find('[data-menu-item="help"]');1===d.length?d.after(b):c.prepend(b)}}return this}},removeHelpMenuItem:{value:function(a){}},clearMenu:{value:function(a){return this.container.find(".navbar-menu .dropdown-menu").empty(),this}},getTemplate:{value:function(a){return void 0===this.templates.cache[a]&&(this.templates.cache[a]=this.templates.env.getTemplate(a+".html")),this.templates.cache[a]}},createTemplateContext:{value:function(a){if(this.context.env.loggedIn=this.isLoggedIn(),this.isLoggedIn()?(this.context.env.loggedInUser=this.auth.username,this.context.env.loggedInUserRealName=this.auth.realname):(delete this.context.env.loggedInUser,delete this.context.env.loggedInUserRealName),this.context.env.isOwner=this.isOwner(),a){var b=this.merge({},this.context);return this.merge(b,a)}return this.context}},renderTemplate:{value:function(a,b){var c=this.getTemplate(a);if(!c)throw"Template "+a+" not found";var b=b?b:this.createTemplateContext();return c.render(b)}}}),f=Object.create(e).init({container:"#kbase-navbar"});return f});