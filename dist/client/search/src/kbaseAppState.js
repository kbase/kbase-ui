define(["kb.statemachine","kb.config","kb.session","postal"],function(a,b,c,d){var e=Object.create(a,{init:{value:function(a){return Object.getPrototypeOf(this).init.call(this,a),this.setItem("config",b),this.setItem("session",c),d.channel("session").subscribe("profile.loaded",function(a){this.setItem("userprofile",a.profile)}.bind(this)),d.channel("session").subscribe("profile.loadfailure",function(a){this.setError("userprofile",a.error)}.bind(this)),this}}});return e.init()});