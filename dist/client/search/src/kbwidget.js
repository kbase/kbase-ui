!function(a){function b(a,b){function c(){}c.prototype=b.prototype;var d=new c;d.constructor=a,a.prototype=d}var c,d=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},e=function(a){return"willChangeValueFor"+d(a)},f=function(a){return"didChangeValueFor"+d(a)},g=function(b){var c=a(b).prop("tagName").toLowerCase();return c.match(/^(input|select|textarea)$/)?"checkbox"==a(b).attr("type")?{setter:"checked",getter:"checked"}:{setter:"val",getter:"val"}:{setter:"text",getter:"text"}};makeBindingCallback=function(b,c,d,e,f){return a.proxy(function(c,d){c.preventDefault(),c.stopPropagation();var g=d.newValue;void 0!=e.transformedValue&&(g=e.transformedValue(g)),"checked"==f.setter?a(b).attr(f.setter,g):a(b)[f.setter](g)},a(b))},makeBindingBlurCallback=function(b,c,d,e,f){return a.proxy(function(g,h){if("keypress"!=g.type||13==g.which){g.preventDefault(),g.stopPropagation();var i;if(i="checked"==f.getter?this.is(":checked")?!0:!1:this[f.getter](),i!=this.data("kbase_bindingValue")){if(void 0!=e.validator){var j=e.validator(i);if(!j.success)return a(b).data("validationError.kbaseBinding",j.msg),this.popover({placement:"right",title:"Validation error",content:a.proxy(function(){return this.data("validationError.kbaseBinding")},a(b)),trigger:"manual",html:!0}),void this.popover("show");a(b).popover("hide"),j.newVal&&(i=j.newVal)}void 0!=e.reverseTransformedValue&&(i=e.reverseTransformedValue(i));var k=c.__attributes[d].setter;c[k](i)}}},a(b))},makeBindingFocusCallback=function(b,c,d){return a.proxy(function(a){a.preventDefault(),a.stopPropagation(),this.data("kbase_bindingValue",this[d.getter]())},a(b))},a.fn.kb_bind=function(b,c,d,e){if(this.length>1){var h=arguments;return a.each(this,function(b,c){a.fn.kb_bind.apply(a(c),h)}),this}void 0==e&&(e=g(this)),void 0==d&&(d={});var i=f(c);b.on(i,makeBindingCallback(this,b,c,d,e)),a(this).on("blur.kbaseBinding",makeBindingBlurCallback(this,b,c,d,e)),a(this).on("focus.kbaseBinding",makeBindingFocusCallback(this,d,e));var j=a(this).prop("tagName").toLowerCase();j.match(/^(input)$/)&&(a(this).on("keypress.kbaseBinding",makeBindingBlurCallback(this,b,c,d,e)),"checkbox"==a(this).attr("type")&&a(this).on("change.kbaseBinding",makeBindingBlurCallback(this,b,c,d,e)));var k=b.__attributes[c].getter,l=b[k]();return void 0!=d.transformedValue&&(l=d.transformedValue(l)),"checked"==e.setter?a(this).attr(e.setter,l):a(this)[e.setter](l),this},a.fn.kb_unbind=function(b,c,d,e,h){if(this.length>1){var i=arguments;return a.each(this,function(b,c){a.fn.kb_unbind.apply(a(c),i)}),this}void 0==h&&(h=g(this)),void 0==e&&(e={});var j=f(c);b.off(j,makeBindingCallback(this,b,c,e,h)),a(this).off("blur.kbaseBinding",makeBindingBlurCallback(this,b,c,e,h)),a(this).off("focus.kbaseBinding",makeBindingBlurCallback(this,e,h));var k=a(this).prop("tagName").toLowerCase();return k.match(/^(input)$/)&&(a(this).off("keypress.kbaseBinding",makeBindingEnterCallback(this,b,c,e,h)),"checkbox"==a(this).attr("type")&&a(this).off("change.kbaseBinding",makeBindingBlurCallback(this,b,c,e,h))),this};var h={};void 0===c&&(c=window.KBase={_functions:{getter:function(a){return function(){return this.valueForKey(a)}},setter:function(a){return function(b){return this.setValueForKey(a,b)}},getter_setter:function(a){return function(b){return 1==arguments.length?this.setValueForKey(a,b):this.valueForKey(a)}}}}),a.jqElem=function(b){var c="<"+b+">";return c.match(/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track)/)||(c+="</"+b+">"),a(c)},a.KBWidget=function(d){d=d||{};var e=d.name,f=d.parent;void 0==f&&(f="kbaseWidget");var g=d.asPlugin;void 0===g&&(g=!0);var i=function(b){return this.$elem=b,this.options=a.extend(!0,{},d.options,this.constructor.prototype.options),this};if(e){var j=e;j=j.replace(/^kbase/,""),j=j.charAt(0).toLowerCase()+j.slice(1),c[j]=function(b,c){var d=new i;return void 0==c&&(c=a.jqElem("div")),d.$elem=c,d.init(b),d._init=!0,d.trigger("initialized"),d},h[e]=i,void 0==d&&(d=f,f="kbaseWidget",void 0==d&&(d={}))}if(f){var k=h[f];if(void 0===k)throw new Error("Parent widget is not registered");b(i,k)}var l=a.extend(!0,{},d);i.prototype.__attributes={},void 0!=l._accessors&&(a.each(l._accessors,a.proxy(function(a,b){var d={name:b,setter:b,getter:b,type:"rw"};if("object"==typeof b){d.setter=b.name,d.getter=b.name;for(var e in b)d[e]=b[e]}i.prototype.__attributes[d.name]=d,d.setter==d.getter&&d.type.match(/rw/)?i.prototype[d.getter]=c._functions.getter_setter(d.name):(d.type.match(/w/)&&void 0!=d.setter&&(i.prototype[d.setter]=c._functions.setter(d.name)),d.type.match(/r/)&&void 0!=d.getter&&(i.prototype[d.getter]=c._functions.getter(d.name)))},this)),l._accessors=void 0);var m=a.extend(!0,{},i.prototype.__attributes,h[f].prototype.__attributes);i.prototype.__attributes=m;for(var n in l)a.isFunction(l[n])?i.prototype[n]=function(a,b){var c=function(){throw"No parent method defined! Play by the rules!"},d=function(){throw"No parent method defined! Play by the rules!"};if(f)var c=function(){return h[f].prototype[a].apply(this,arguments)},d=function(a){return h[f].prototype[a].apply(this,Array.prototype.slice.call(arguments,1))};return function(){var a=this._super,e=this._superMethod;this._super=c,this._superMethod=d;var f=b.apply(this,arguments);return this._super=a,this._superMethod=e,f}}(n,l[n]):i.prototype[n]=l[n];if(f&&(i.prototype.options=a.extend(!0,{},h[f].prototype.options,i.prototype.options)),g){var o=function(b,c){if(this.length>1){var d=arguments;return a.each(this,function(b,c){a.fn[e].apply(a(c),d)}),this}if(void 0==this.data(e)&&this.data(e,new i(this)),i.prototype[b])return i.prototype[b].apply(this.data(e),Array.prototype.slice.call(arguments,1));if("object"==typeof b||!b){arguments;return $w=this.data(e),void 0===$w._init&&($w=i.prototype.init.apply($w,arguments)),$w._init=!0,$w.trigger("initialized"),$w}return a.error("Method "+b+" does not exist on "+e),this};o.name=e,a.fn[e]=o,a[e]=a.fn[e]}return this.on=function(a,b){return this.$elem.bind(a,b),this},this.emit=function(a,b){return this.$elem.trigger(a,b),this},this.off=function(a){return this.$elem.unbind(a),this},void 0!==e?(i.prototype[e]=function(){return a.fn[e].apply(this.$elem,arguments)},a.fn[e]):this},a.KBWidget.registry=function(){var a={};for(var b in h)"kbaseWidget"!==b&&(a[b]=h[b]);return a},a.KBWidget.resetRegistry=function(){for(var a in h)"kbaseWidget"!==a&&delete h[a];return this},a.KBWidget({name:"kbaseWidget",dbg:function(a){window.console&&console.log(a)},callAfterInit:function(a){var b=this,c=function(){var c=arguments.callee;b._init?a():setTimeout(c,10)};return c(),c},init:function(b){this._attributes={};var c=a.extend(!0,{},this.options);this.options=a.extend(!0,{},c,b);for(attribute in this.__attributes)void 0!=this.options[attribute]&&this.setValueForKey(attribute,this.options[attribute]);return this},alert:function(a){return void 0==a&&(a=this.data("msg")),this.data("msg",a),this},valueForKey:function(a){return this._attributes[a]},setValueForKey:function(a,b){var c=void 0,d=this.valueForKey(a);if(b!=d){var g=e(a);if(c={oldValue:d,newValue:b},this.trigger(g,c),this._attributes[a]=c.newValue,c.newValue!=d){var h=f(a);this.trigger(h,c)}}return this.valueForKey(a)},data:function(a,b){return void 0==this.options._storage&&(this.options._storage={}),2==arguments.length&&(this.options._storage[a]=b),void 0!=a?this.options._storage[a]:this.options._storage},_rewireIds:function(b,c){return void 0==c&&(c=b),b.attr("id")&&(c.data(b.attr("id"),b),b.removeAttr("id")),a.each(b.find("[id]"),function(b){c.data(a(this).attr("id"),a(this)),a(this).removeAttr("id")}),b},sortCaseInsensitively:function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:0},sortByKey:function(a,b){return b?function(b,c){return b[a].toLowerCase()<c[a].toLowerCase()?-1:b[a].toLowerCase()>c[a].toLowerCase()?1:0}:function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0}},trigger:function(){this.$elem.trigger.apply(this.$elem,arguments)},on:function(){this.$elem.on.apply(this.$elem,arguments)},off:function(){this.$elem.off.apply(this.$elem,arguments)},makeObserverCallback:function(b,c,d){return a.proxy(function(a,c){a.preventDefault(),a.stopPropagation(),d.call(this,a,b,c)},this)},observe:function(a,b,c){a.on(b,a,this.makeObserverCallback(a,b,c))},unobserve:function(a,b,c){a.off(b,a,this.makeObserverCallback(a,b,c))},kb_bind:function(a,b,c){var d=f(b);this.observe(a,d,c)},kb_unbind:function(a,b,c){var d=f(b);this.unobserve(a,d,c)},uuid:function(){for(var a="",b=0;32>b;b++)a+=Math.floor(16*Math.random()).toString(16).toUpperCase();return a}})}(jQuery);