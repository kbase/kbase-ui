!function(){var a={};!function(){"use strict";function b(a,c,d){var e=function(){};e.prototype=a.prototype;var f=new e,g=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;d=d||{};for(var h in d){var i=d[h],j=f[h];"function"==typeof j&&"function"==typeof i&&g.test(i)?f[h]=function(a,b){return function(){var c=this.parent;this.parent=b;var d=a.apply(this,arguments);return this.parent=c,d}}(i,j):f[h]=i}f.typename=c;var k=function(){f.init&&f.init.apply(this,arguments)};return k.prototype=f,k.prototype.constructor=k,k.extend=function(a,c){return"object"==typeof a&&(c=a,a="anonymous"),b(k,a,c)},k}a.object=b(Object,"Object",{})}(),function(){"use strict";var b=Array.prototype,c=Object.prototype,d={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},e=/[&"'<>]/g,f=function(a){return d[a]},g=a.lib={};g.withPrettyErrors=function(a,b,c){try{return c()}catch(d){if(d.Update||(d=new g.TemplateError(d)),d.Update(a),!b){var e=d;d=new Error(e.message),d.name=e.name}throw d}},g.TemplateError=function(a,b,c){var d=this;return a instanceof Error?(d=a,a=a.name+": "+a.message):Error.captureStackTrace&&Error.captureStackTrace(d),d.name="Template render error",d.message=a,d.lineno=b,d.colno=c,d.firstUpdate=!0,d.Update=function(a){var b="("+(a||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?b+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(b+=" [Line "+this.lineno+"]")),b+="\n ",this.firstUpdate&&(b+=" "),this.message=b+(this.message||""),this.firstUpdate=!1,this},d},g.TemplateError.prototype=Error.prototype,g.escape=function(a){return a.replace(e,f)},g.isFunction=function(a){return"[object Function]"===c.toString.call(a)},g.isArray=Array.isArray||function(a){return"[object Array]"===c.toString.call(a)},g.isString=function(a){return"[object String]"===c.toString.call(a)},g.isObject=function(a){return"[object Object]"===c.toString.call(a)},g.groupBy=function(a,b){for(var c={},d=g.isFunction(b)?b:function(a){return a[b]},e=0;e<a.length;e++){var f=a[e],h=d(f,e);(c[h]||(c[h]=[])).push(f)}return c},g.toArray=function(a){return Array.prototype.slice.call(a)},g.without=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length,e=g.toArray(arguments).slice(1);++c<d;)-1===g.indexOf(e,a[c])&&b.push(a[c]);return b},g.extend=function(a,b){for(var c in b)a[c]=b[c];return a},g.repeat=function(a,b){for(var c="",d=0;b>d;d++)c+=a;return c},g.each=function(a,c,d){if(null!=a)if(b.each&&a.each===b.each)a.forEach(c,d);else if(a.length===+a.length)for(var e=0,f=a.length;f>e;e++)c.call(d,a[e],e,a)},g.map=function(a,c){var d=[];if(null==a)return d;if(b.map&&a.map===b.map)return a.map(c);for(var e=0;e<a.length;e++)d[d.length]=c(a[e],e);return a.length===+a.length&&(d.length=a.length),d},g.asyncIter=function(a,b,c){function d(){e++,e<a.length?b(a[e],e,d,c):c()}var e=-1;d()},g.asyncFor=function(a,b,c){function d(){h++;var g=e[h];f>h?b(g,a[g],h,f,d):c()}var e=g.keys(a),f=e.length,h=-1;d()},g.indexOf=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){var d=this.length>>>0;for(c=+c||0,Math.abs(c)===1/0&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),g.keys=function(a){if(Object.prototype.keys)return a.keys();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}}(),function(){"use strict";function b(a,b,c){a instanceof b&&c.push(a),a instanceof g&&a.findAll(b,c)}function c(a,b){function f(a,b,c){for(var e=a.split("\n"),f=0;f<e.length;f++){if(e[f]&&(c&&f>0||!c))for(var g=0;b>g;g++)d.print(" ");f===e.length-1?d.print(e[f]):d.puts(e[f])}}if(b=b||0,f(a.typename+": ",b),a instanceof i)f("\n"),e.each(a.children,function(a){c(a,b+2)});else if(a instanceof ca)f(a.extName+"."+a.prop),f("\n"),a.args&&c(a.args,b+2),a.contentArgs&&e.each(a.contentArgs,function(a){c(a,b+2)});else{var h=null,j=null;if(a.iterFields(function(a,b){a instanceof g?(h=h||{},h[b]=a):(j=j||{},j[b]=a)}),j?f(d.inspect(j,!0,null)+"\n",null,!0):f("\n"),h)for(var k in h)c(h[k],b+2)}}var d=a.util,e=a.lib,f=a.object,g=f.extend("Node",{init:function(a,b){this.lineno=a,this.colno=b;for(var c=this.fields,d=0,e=c.length;e>d;d++){var f=c[d],g=arguments[d+2];void 0===g&&(g=null),this[f]=g}},findAll:function(a,c){if(c=c||[],this instanceof i)for(var d=this.children,e=0,f=d.length;f>e;e++)b(d[e],a,c);else for(var g=this.fields,e=0,f=g.length;f>e;e++)b(this[g[e]],a,c);return c},iterFields:function(a){e.each(this.fields,function(b){a(this[b],b)},this)}}),h=g.extend("Value",{fields:["value"]}),i=g.extend("NodeList",{fields:["children"],init:function(a,b,c){this.parent(a,b,c||[])},addChild:function(a){this.children.push(a)}}),j=i.extend("Root"),k=h.extend("Literal"),l=h.extend("Symbol"),m=i.extend("Group"),n=i.extend("Array"),o=g.extend("Pair",{fields:["key","value"]}),p=i.extend("Dict"),q=g.extend("LookupVal",{fields:["target","val"]}),r=g.extend("If",{fields:["cond","body","else_"]}),s=r.extend("IfAsync"),t=g.extend("InlineIf",{fields:["cond","body","else_"]}),u=g.extend("For",{fields:["arr","name","body","else_"]}),v=u.extend("AsyncEach"),w=u.extend("AsyncAll"),x=g.extend("Macro",{fields:["name","args","body"]}),y=x.extend("Caller"),z=g.extend("Import",{fields:["template","target","withContext"]}),A=g.extend("FromImport",{fields:["template","names","withContext"],init:function(a,b,c,d,e){this.parent(a,b,c,d||new i,e)}}),B=g.extend("FunCall",{fields:["name","args"]}),C=B.extend("Filter"),D=C.extend("FilterAsync",{fields:["name","args","symbol"]}),E=p.extend("KeywordArgs"),F=g.extend("Block",{fields:["name","body"]}),G=g.extend("Super",{fields:["blockName","symbol"]}),H=g.extend("TemplateRef",{fields:["template"]}),I=H.extend("Extends"),J=H.extend("Include"),K=g.extend("Set",{fields:["targets","value"]}),L=i.extend("Output"),M=k.extend("TemplateData"),N=g.extend("UnaryOp",{fields:["target"]}),O=g.extend("BinOp",{fields:["left","right"]}),P=O.extend("In"),Q=O.extend("Or"),R=O.extend("And"),S=N.extend("Not"),T=O.extend("Add"),U=O.extend("Sub"),V=O.extend("Mul"),W=O.extend("Div"),X=O.extend("FloorDiv"),Y=O.extend("Mod"),Z=O.extend("Pow"),$=N.extend("Neg"),_=N.extend("Pos"),aa=g.extend("Compare",{fields:["expr","ops"]}),ba=g.extend("CompareOperand",{fields:["expr","type"]}),ca=(g.extend("CustomTag",{init:function(a,b,c){this.lineno=a,this.colno=b,this.name=c}}),g.extend("CallExtension",{fields:["extName","prop","args","contentArgs"],init:function(a,b,c,d){this.extName=a._name||a,this.prop=b,this.args=c||new i,this.contentArgs=d||[],this.autoescape=a.autoescape}})),da=ca.extend("CallExtensionAsync");a.nodes={Node:g,Root:j,NodeList:i,Value:h,Literal:k,Symbol:l,Group:m,Array:n,Pair:o,Dict:p,Output:L,TemplateData:M,If:r,IfAsync:s,InlineIf:t,For:u,AsyncEach:v,AsyncAll:w,Macro:x,Caller:y,Import:z,FromImport:A,FunCall:B,Filter:C,FilterAsync:D,KeywordArgs:E,Block:F,Super:G,Extends:I,Include:J,Set:K,LookupVal:q,BinOp:O,In:P,Or:Q,And:R,Not:S,Add:T,Sub:U,Mul:V,Div:W,FloorDiv:X,Mod:Y,Pow:Z,Neg:$,Pos:_,Compare:aa,CompareOperand:ba,CallExtension:ca,CallExtensionAsync:da,printNodes:c}}(),function(){"use strict";function b(a,b,c){return function(){var f,g=e(arguments),h=d(arguments);if(g>a.length){f=Array.prototype.slice.call(arguments,0,a.length);for(var i=Array.prototype.slice.call(arguments,f.length,g),j=0;j<i.length;j++)j<b.length&&(h[b[j]]=i[j]);f.push(h)}else if(g<a.length){f=Array.prototype.slice.call(arguments,0,g);for(var j=g;j<a.length;j++){var k=a[j];f.push(h[k]),delete h[k]}f.push(h)}else f=arguments;return c.apply(this,f)}}function c(a){return a.__keywords=!0,a}function d(a){var b=a.length;if(b){var c=a[b-1];if(c&&c.hasOwnProperty("__keywords"))return c}return{}}function e(a){var b=a.length;if(0===b)return 0;var c=a[b-1];return c&&c.hasOwnProperty("__keywords")?b-1:b}function f(a){return"string"!=typeof a?a:void(this.val=a)}function g(a,b){return a instanceof f?new f(b):b.toString()}function h(a){var b=typeof a;return"string"===b?new f(a):"function"!==b?a:function(){var b=a.apply(this,arguments);return"string"==typeof b?new f(b):b}}function i(a,b){return a=void 0!==a&&null!==a?a:"",b&&"string"==typeof a&&(a=p.escape(a)),a}function j(a,b){return a=a||{},"function"==typeof a[b]?function(){return a[b].apply(a,arguments)}:a[b]}function k(a,b,c){if(!a)throw new Error("Unable to call `"+b+"`, which is undefined or falsey");if("function"!=typeof a)throw new Error("Unable to call `"+b+"`, which is not a function");return a.apply(this,c)}function l(a,b,c){var d=b.lookup(c);return void 0!==d&&null!==d?d:a.lookup(c)}function m(a,b,c){return a.lineno?a:new p.TemplateError(a,b,c)}function n(a,b,c,d){if(p.isArray(a)){var e=a.length;p.asyncIter(a,function(a,d,f){switch(b){case 1:c(a,d,e,f);break;case 2:c(a[0],a[1],d,e,f);break;case 3:c(a[0],a[1],a[2],d,e,f);break;default:a.push(d,f),c.apply(this,a)}},d)}else p.asyncFor(a,function(a,b,d,e,f){c(a,b,d,e,f)},d)}function o(a,b,c,d){function e(a,b){h++,g[a]=b,h===f&&d(null,g.join(""))}var f,g,h=0;if(p.isArray(a))if(f=a.length,g=new Array(f),0===f)d(null,"");else for(var i=0;i<a.length;i++){var j=a[i];switch(b){case 1:c(j,i,f,e);break;case 2:c(j[0],j[1],i,f,e);break;case 3:c(j[0],j[1],j[2],i,f,e);break;default:j.push(i,e),c.apply(this,j)}}else{var k=p.keys(a);if(f=k.length,g=new Array(f),0===f)d(null,"");else for(var i=0;i<k.length;i++){var l=k[i];c(l,a[l],i,f,e)}}}var p=a.lib,q=a.object,r=q.extend({init:function(a){this.variables={},this.parent=a},set:function(a,b,c){var d=a.split("."),e=this.variables,f=this;if(c){if(f=this.resolve(d[0]))return void f.set(a,b);f=this}for(var g=0;g<d.length-1;g++){var h=d[g];e[h]||(e[h]={}),e=e[h]}e[d[d.length-1]]=b},get:function(a){var b=this.variables[a];return void 0!==b&&null!==b?b:null},lookup:function(a){var b=this.parent,c=this.variables[a];return void 0!==c&&null!==c?c:b&&b.lookup(a)},resolve:function(a){var b=this.parent,c=this.variables[a];return void 0!==c&&null!==c?this:b&&b.resolve(a)},push:function(){return new r(this)},pop:function(){return this.parent}});f.prototype=Object.create(String.prototype),f.prototype.valueOf=function(){return this.val},f.prototype.toString=function(){return this.val},a.runtime={Frame:r,makeMacro:b,makeKeywordArgs:c,numArgs:e,suppressValue:i,memberLookup:j,contextOrFrameLookup:l,callWrap:k,handleError:m,isArray:p.isArray,keys:p.keys,SafeString:f,copySafeness:g,markSafe:h,asyncEach:n,asyncAll:o}}(),function(){"use strict";function b(a,b,c,d){return{type:a,value:b,lineno:c,colno:d}}function c(a,b){this.str=a,this.index=0,this.len=a.length,this.lineno=0,this.colno=0,this.in_code=!1,b=b||{};var c=b.tags||{};this.tags={BLOCK_START:c.blockStart||h,BLOCK_END:c.blockEnd||i,VARIABLE_START:c.variableStart||j,VARIABLE_END:c.variableEnd||k,COMMENT_START:c.commentStart||l,COMMENT_END:c.commentEnd||m},this.trimBlocks=!!b.trimBlocks,this.lstripBlocks=!!b.lstripBlocks}var d=a.lib,e=" \n	\r ",f="()[]{}%*-+/#,:|.<>=!",g="0123456789",h="{%",i="%}",j="{{",k="}}",l="{#",m="#}",n="string",o="whitespace",p="data",q="block-start",r="block-end",s="variable-start",t="variable-end",u="comment",v="left-paren",w="right-paren",x="left-bracket",y="right-bracket",z="left-curly",A="right-curly",B="operator",C="comma",D="colon",E="pipe",F="int",G="float",H="boolean",I="symbol",J="special",K="regex";c.prototype.nextToken=function(){var a,c=this.lineno,h=this.colno;if(this.in_code){var i=this.current();if(this.is_finished())return null;if('"'===i||"'"===i)return b(n,this.parseString(i),c,h);if(a=this._extract(e))return b(o,a,c,h);if((a=this._extractString(this.tags.BLOCK_END))||(a=this._extractString("-"+this.tags.BLOCK_END)))return this.in_code=!1,this.trimBlocks&&(i=this.current(),"\n"===i&&this.forward()),b(r,a,c,h);if(a=this._extractString(this.tags.VARIABLE_END))return this.in_code=!1,b(t,a,c,h);if("r"===i&&"/"===this.str.charAt(this.index+1)){this.forwardN(2);for(var j="";!this.is_finished();){if("/"===this.current()&&"\\"!==this.previous()){this.forward();break}j+=this.current(),this.forward()}for(var k=["g","i","m","y"],l="";!this.is_finished();){var m=-1!==k.indexOf(this.current());if(!m)break;l+=this.current(),this.forward()}return b(K,{body:j,flags:l},c,h)}if(-1!==f.indexOf(i)){this.forward();var J,L=["==","!=","<=",">=","//","**"],M=i+this.current();switch(-1!==d.indexOf(L,M)&&(this.forward(),i=M),i){case"(":J=v;break;case")":J=w;break;case"[":J=x;break;case"]":J=y;break;case"{":J=z;break;case"}":J=A;break;case",":J=C;break;case":":J=D;break;case"|":J=E;break;default:J=B}return b(J,i,c,h)}if(a=this._extractUntil(e+f),a.match(/^[-+]?[0-9]+$/)){if("."===this.current()){this.forward();var N=this._extract(g);return b(G,a+"."+N,c,h)}return b(F,a,c,h)}if(a.match(/^(true|false)$/))return b(H,a,c,h);if(a)return b(I,a,c,h);throw new Error("Unexpected value while parsing: "+a)}var O=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);if(this.is_finished())return null;if((a=this._extractString(this.tags.BLOCK_START+"-"))||(a=this._extractString(this.tags.BLOCK_START)))return this.in_code=!0,b(q,a,c,h);if(a=this._extractString(this.tags.VARIABLE_START))return this.in_code=!0,b(s,a,c,h);a="";var P,Q=!1;for(this._matches(this.tags.COMMENT_START)&&(Q=!0,a=this._extractString(this.tags.COMMENT_START));null!==(P=this._extractUntil(O));){if(a+=P,(this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!Q){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&this.colno>0&&this.colno<=a.length){var R=a.slice(-this.colno);if(/^\s+$/.test(R)&&(a=a.slice(0,-this.colno),!a.length))return this.nextToken()}break}if(this._matches(this.tags.COMMENT_END)){if(!Q)throw new Error("unexpected end of comment");a+=this._extractString(this.tags.COMMENT_END);break}a+=this.current(),this.forward()}if(null===P&&Q)throw new Error("expected end of comment, got end of file");return b(Q?u:p,a,c,h)},c.prototype.parseString=function(a){this.forward();for(var b=(this.lineno,this.colno,"");!this.is_finished()&&this.current()!==a;){var c=this.current();if("\\"===c){switch(this.forward(),this.current()){case"n":b+="\n";break;case"t":b+="	";break;case"r":b+="\r";break;default:b+=this.current()}this.forward()}else b+=c,this.forward()}return this.forward(),b},c.prototype._matches=function(a){if(this.index+a.length>this.len)return null;var b=this.str.slice(this.index,this.index+a.length);return b===a},c.prototype._extractString=function(a){return this._matches(a)?(this.index+=a.length,a):null},c.prototype._extractUntil=function(a){return this._extractMatching(!0,a||"")},c.prototype._extract=function(a){return this._extractMatching(!1,a)},c.prototype._extractMatching=function(a,b){if(this.is_finished())return null;var c=b.indexOf(this.current());if(a&&-1===c||!a&&-1!==c){var d=this.current();this.forward();for(var e=b.indexOf(this.current());(a&&-1===e||!a&&-1!==e)&&!this.is_finished();)d+=this.current(),this.forward(),e=b.indexOf(this.current());return d}return""},c.prototype.is_finished=function(){return this.index>=this.len},c.prototype.forwardN=function(a){for(var b=0;a>b;b++)this.forward()},c.prototype.forward=function(){this.index++,"\n"===this.previous()?(this.lineno++,this.colno=0):this.colno++},c.prototype.back=function(){if(this.index--,"\n"===this.current()){this.lineno--;var a=this.src.lastIndexOf("\n",this.index-1);-1===a?this.colno=this.index:this.colno=this.index-a}else this.colno--},c.prototype.current=function(){return this.is_finished()?"":this.str.charAt(this.index)},c.prototype.previous=function(){return this.str.charAt(this.index-1)},a.lexer={lex:function(a,b){return new c(a,b)},TOKEN_STRING:n,TOKEN_WHITESPACE:o,TOKEN_DATA:p,TOKEN_BLOCK_START:q,TOKEN_BLOCK_END:r,TOKEN_VARIABLE_START:s,TOKEN_VARIABLE_END:t,TOKEN_COMMENT:u,TOKEN_LEFT_PAREN:v,TOKEN_RIGHT_PAREN:w,TOKEN_LEFT_BRACKET:x,TOKEN_RIGHT_BRACKET:y,TOKEN_LEFT_CURLY:z,TOKEN_RIGHT_CURLY:A,TOKEN_OPERATOR:B,TOKEN_COMMA:C,TOKEN_COLON:D,TOKEN_PIPE:E,TOKEN_INT:F,TOKEN_FLOAT:G,TOKEN_BOOLEAN:H,TOKEN_SYMBOL:I,TOKEN_SPECIAL:J,TOKEN_REGEX:K}}(),function(){"use strict";var b=a.lexer,c=a.nodes,d=a.object,e=a.lib,f=d.extend({init:function(a){this.tokens=a,this.peeked=null,this.breakOnBlocks=null,this.dropLeadingWhitespace=!1,this.extensions=[]},nextToken:function(a){var c;if(this.peeked){if(a||this.peeked.type!==b.TOKEN_WHITESPACE)return c=this.peeked,this.peeked=null,c;this.peeked=null}if(c=this.tokens.nextToken(),!a)for(;c&&c.type===b.TOKEN_WHITESPACE;)c=this.tokens.nextToken();return c},peekToken:function(){return this.peeked=this.peeked||this.nextToken(),this.peeked},pushToken:function(a){if(this.peeked)throw new Error("pushToken: can only push one token on between reads");this.peeked=a},fail:function(a,b,c){if((void 0===b||void 0===c)&&this.peekToken()){var d=this.peekToken();b=d.lineno,c=d.colno}throw void 0!==b&&(b+=1),void 0!==c&&(c+=1),new e.TemplateError(a,b,c)},skip:function(a){var b=this.nextToken();return b&&b.type===a?!0:(this.pushToken(b),!1)},expect:function(a){var b=this.nextToken();return b.type!==a&&this.fail("expected "+a+", got "+b.type,b.lineno,b.colno),b},skipValue:function(a,b){var c=this.nextToken();return c&&c.type===a&&c.value===b?!0:(this.pushToken(c),!1)},skipWhitespace:function(){return this.skip(b.TOKEN_WHITESPACE)},skipSymbol:function(a){return this.skipValue(b.TOKEN_SYMBOL,a)},advanceAfterBlockEnd:function(a){if(!a){var c=this.peekToken();c||this.fail("unexpected end of file"),c.type!==b.TOKEN_SYMBOL&&this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),a=this.nextToken().value}var c=this.nextToken();c&&c.type===b.TOKEN_BLOCK_END?"-"===c.value.charAt(0)&&(this.dropLeadingWhitespace=!0):this.fail("expected block end in "+a+" statement")},advanceAfterVariableEnd:function(){this.skip(b.TOKEN_VARIABLE_END)||this.fail("expected variable end")},parseFor:function(){var a,d,e=this.peekToken();this.skipSymbol("for")?(a=new c.For(e.lineno,e.colno),d="endfor"):this.skipSymbol("asyncEach")?(a=new c.AsyncEach(e.lineno,e.colno),d="endeach"):this.skipSymbol("asyncAll")?(a=new c.AsyncAll(e.lineno,e.colno),d="endall"):this.fail("parseFor: expected for{Async}",e.lineno,e.colno),a.name=this.parsePrimary(),a.name instanceof c.Symbol||this.fail("parseFor: variable name expected for loop");var f=this.peekToken().type;if(f===b.TOKEN_COMMA){var g=a.name;for(a.name=new c.Array(g.lineno,g.colno),a.name.addChild(g);this.skip(b.TOKEN_COMMA);){var h=this.parsePrimary();a.name.addChild(h)}}return this.skipSymbol("in")||this.fail('parseFor: expected "in" keyword for loop',e.lineno,e.colno),a.arr=this.parseExpression(),this.advanceAfterBlockEnd(e.value),a.body=this.parseUntilBlocks(d,"else"),this.skipSymbol("else")&&(this.advanceAfterBlockEnd("else"),a.else_=this.parseUntilBlocks(d)),this.advanceAfterBlockEnd(),a},parseMacro:function(){var a=this.peekToken();this.skipSymbol("macro")||this.fail("expected macro");var b=this.parsePrimary(!0),d=this.parseSignature(),e=new c.Macro(a.lineno,a.colno,b,d);return this.advanceAfterBlockEnd(a.value),e.body=this.parseUntilBlocks("endmacro"),this.advanceAfterBlockEnd(),e},parseCall:function(){var a=this.peekToken();this.skipSymbol("call")||this.fail("expected call");var b=this.parseSignature(!0)||new c.NodeList,d=this.parsePrimary();this.advanceAfterBlockEnd(a.value);var e=this.parseUntilBlocks("endcall");this.advanceAfterBlockEnd();var f=new c.Symbol(a.lineno,a.colno,"caller"),g=new c.Caller(a.lineno,a.colno,f,b,e),h=d.args.children;h[h.length-1]instanceof c.KeywordArgs||h.push(new c.KeywordArgs);var i=h[h.length-1];return i.addChild(new c.Pair(a.lineno,a.colno,f,g)),new c.Output(a.lineno,a.colno,[d])},parseWithContext:function(){var a=this.peekToken(),b=null;return this.skipSymbol("with")?b=!0:this.skipSymbol("without")&&(b=!1),null!==b&&(this.skipSymbol("context")||this.fail("parseFrom: expected context after with/without",a.lineno,a.colno)),b},parseImport:function(){var a=this.peekToken();this.skipSymbol("import")||this.fail("parseImport: expected import",a.lineno,a.colno);var b=this.parseExpression();this.skipSymbol("as")||this.fail('parseImport: expected "as" keyword',a.lineno,a.colno);var d=this.parsePrimary(),e=this.parseWithContext(),f=new c.Import(a.lineno,a.colno,b,d,e);return this.advanceAfterBlockEnd(a.value),f},parseFrom:function(){var a=this.peekToken();this.skipSymbol("from")||this.fail("parseFrom: expected from");var d=this.parsePrimary();this.skipSymbol("import")||this.fail("parseFrom: expected import",a.lineno,a.colno);for(var e,f=new c.NodeList;;){var g=this.peekToken();if(g.type===b.TOKEN_BLOCK_END){f.children.length||this.fail("parseFrom: Expected at least one import name",a.lineno,a.colno),"-"===g.value.charAt(0)&&(this.dropLeadingWhitespace=!0),this.nextToken();break}f.children.length>0&&!this.skip(b.TOKEN_COMMA)&&this.fail("parseFrom: expected comma",a.lineno,a.colno);var h=this.parsePrimary();if("_"===h.value.charAt(0)&&this.fail("parseFrom: names starting with an underscore cannot be imported",h.lineno,h.colno),this.skipSymbol("as")){var i=this.parsePrimary();f.addChild(new c.Pair(h.lineno,h.colno,h,i))}else f.addChild(h);e=this.parseWithContext()}return new c.FromImport(a.lineno,a.colno,d,f,e)},parseBlock:function(){var a=this.peekToken();this.skipSymbol("block")||this.fail("parseBlock: expected block",a.lineno,a.colno);var b=new c.Block(a.lineno,a.colno);return b.name=this.parsePrimary(),b.name instanceof c.Symbol||this.fail("parseBlock: variable name expected",a.lineno,a.colno),this.advanceAfterBlockEnd(a.value),b.body=this.parseUntilBlocks("endblock"),this.peekToken()||this.fail("parseBlock: expected endblock, got end of file"),this.advanceAfterBlockEnd(),b},parseTemplateRef:function(a,b){var c=this.peekToken();this.skipSymbol(a)||this.fail("parseTemplateRef: expected "+a);var d=new b(c.lineno,c.colno);return d.template=this.parseExpression(),this.advanceAfterBlockEnd(c.value),d},parseExtends:function(){return this.parseTemplateRef("extends",c.Extends)},parseInclude:function(){return this.parseTemplateRef("include",c.Include)},parseIf:function(){var a,b=this.peekToken();this.skipSymbol("if")||this.skipSymbol("elif")?a=new c.If(b.lineno,b.colno):this.skipSymbol("ifAsync")?a=new c.IfAsync(b.lineno,b.colno):this.fail("parseIf: expected if or elif",b.lineno,b.colno),a.cond=this.parseExpression(),this.advanceAfterBlockEnd(b.value),a.body=this.parseUntilBlocks("elif","else","endif");var d=this.peekToken();switch(d&&d.value){case"elif":a.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd(),a.else_=this.parseUntilBlocks("endif"),this.advanceAfterBlockEnd();break;case"endif":a.else_=null,this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected endif, else, or endif, got end of file")}return a},parseSet:function(){var a=this.peekToken();this.skipSymbol("set")||this.fail("parseSet: expected set",a.lineno,a.colno);for(var d,e=new c.Set(a.lineno,a.colno,[]);(d=this.parsePrimary())&&(e.targets.push(d),this.skip(b.TOKEN_COMMA)););return this.skipValue(b.TOKEN_OPERATOR,"=")||this.fail("parseSet: expected = in set tag",a.lineno,a.colno),e.value=this.parseExpression(),this.advanceAfterBlockEnd(a.value),e},parseStatement:function(){var a,d=this.peekToken();if(d.type!==b.TOKEN_SYMBOL&&this.fail("tag name expected",d.lineno,d.colno),this.breakOnBlocks&&-1!==e.indexOf(this.breakOnBlocks,d.value))return null;switch(d.value){case"raw":return this.parseRaw();case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();default:if(this.extensions.length)for(var f=0;f<this.extensions.length;f++){var g=this.extensions[f];if(-1!==e.indexOf(g.tags||[],d.value))return g.parse(this,c,b)}this.fail("unknown block tag: "+d.value,d.lineno,d.colno)}return a},parseRaw:function(){this.advanceAfterBlockEnd();for(var a="",d=this.peekToken();;){var e=this.nextToken(!0);if(e||this.fail("expected endraw, got end of file"),e.type===b.TOKEN_BLOCK_START){var f=null,g=this.nextToken(!0);if(g.type===b.TOKEN_WHITESPACE&&(f=g,g=this.nextToken()),g.type===b.TOKEN_SYMBOL&&"endraw"===g.value){this.advanceAfterBlockEnd(g.value);break}a+=e.value,f&&(a+=f.value),a+=g.value}else a+=e.type===b.TOKEN_STRING?'"'+e.value+'"':e.value}var h=new c.Output(d.lineno,d.colno,[new c.TemplateData(d.lineno,d.colno,a)]);return h},parsePostfix:function(a){for(var d=this.peekToken();d;){if(d.type===b.TOKEN_LEFT_PAREN)a=new c.FunCall(d.lineno,d.colno,a,this.parseSignature());else if(d.type===b.TOKEN_LEFT_BRACKET){var e=this.parseAggregate();e.children.length>1&&this.fail("invalid index"),a=new c.LookupVal(d.lineno,d.colno,a,e.children[0])}else{if(d.type!==b.TOKEN_OPERATOR||"."!==d.value)break;this.nextToken();var f=this.nextToken();f.type!==b.TOKEN_SYMBOL&&this.fail("expected name as lookup value, got "+f.value,f.lineno,f.colno);var e=new c.Literal(f.lineno,f.colno,f.value);a=new c.LookupVal(d.lineno,d.colno,a,e)}d=this.peekToken()}return a},parseExpression:function(){var a=this.parseInlineIf();return a},parseInlineIf:function(){var a=this.parseOr();if(this.skipSymbol("if")){var b=this.parseOr(),d=a;a=new c.InlineIf(a.lineno,a.colno),a.body=d,a.cond=b,this.skipSymbol("else")?a.else_=this.parseOr():a.else_=null}return a},parseOr:function(){for(var a=this.parseAnd();this.skipSymbol("or");){var b=this.parseAnd();a=new c.Or(a.lineno,a.colno,a,b)}return a},parseAnd:function(){for(var a=this.parseNot();this.skipSymbol("and");){var b=this.parseNot();a=new c.And(a.lineno,a.colno,a,b)}return a},parseNot:function(){var a=this.peekToken();return this.skipSymbol("not")?new c.Not(a.lineno,a.colno,this.parseNot()):this.parseIn()},parseIn:function(){for(var a=this.parseCompare();;){var d=this.nextToken();if(!d)break;var e=d.type===b.TOKEN_SYMBOL&&"not"===d.value;if(e||this.pushToken(d),!this.skipSymbol("in")){e&&this.pushToken(d);break}var f=this.parseCompare();a=new c.In(a.lineno,a.colno,a,f),e&&(a=new c.Not(a.lineno,a.colno,a))}return a},parseCompare:function(){for(var a=["==","!=","<",">","<=",">="],b=this.parseAdd(),d=[];;){var f=this.nextToken();if(!f)break;if(-1===e.indexOf(a,f.value)){this.pushToken(f);break}d.push(new c.CompareOperand(f.lineno,f.colno,this.parseAdd(),f.value))}return d.length?new c.Compare(d[0].lineno,d[0].colno,b,d):b},parseAdd:function(){for(var a=this.parseSub();this.skipValue(b.TOKEN_OPERATOR,"+");){var d=this.parseSub();a=new c.Add(a.lineno,a.colno,a,d)}return a},parseSub:function(){for(var a=this.parseMul();this.skipValue(b.TOKEN_OPERATOR,"-");){var d=this.parseMul();a=new c.Sub(a.lineno,a.colno,a,d)}return a},parseMul:function(){for(var a=this.parseDiv();this.skipValue(b.TOKEN_OPERATOR,"*");){var d=this.parseDiv();a=new c.Mul(a.lineno,a.colno,a,d)}return a},parseDiv:function(){for(var a=this.parseFloorDiv();this.skipValue(b.TOKEN_OPERATOR,"/");){var d=this.parseFloorDiv();a=new c.Div(a.lineno,a.colno,a,d)}return a},parseFloorDiv:function(){for(var a=this.parseMod();this.skipValue(b.TOKEN_OPERATOR,"//");){var d=this.parseMod();a=new c.FloorDiv(a.lineno,a.colno,a,d)}return a},parseMod:function(){for(var a=this.parsePow();this.skipValue(b.TOKEN_OPERATOR,"%");){var d=this.parsePow();a=new c.Mod(a.lineno,a.colno,a,d)}return a},parsePow:function(){for(var a=this.parseUnary();this.skipValue(b.TOKEN_OPERATOR,"**");){var d=this.parseUnary();a=new c.Pow(a.lineno,a.colno,a,d)}return a},parseUnary:function(a){var d,e=this.peekToken();return d=this.skipValue(b.TOKEN_OPERATOR,"-")?new c.Neg(e.lineno,e.colno,this.parseUnary(!0)):this.skipValue(b.TOKEN_OPERATOR,"+")?new c.Pos(e.lineno,e.colno,this.parseUnary(!0)):this.parsePrimary(),a||(d=this.parseFilter(d)),d},parsePrimary:function(a){var d=this.nextToken(),e=null,f=null;return d?d.type===b.TOKEN_STRING?e=d.value:d.type===b.TOKEN_INT?e=parseInt(d.value,10):d.type===b.TOKEN_FLOAT?e=parseFloat(d.value):d.type===b.TOKEN_BOOLEAN?"true"===d.value?e=!0:"false"===d.value?e=!1:this.fail("invalid boolean: "+d.value,d.lineno,d.colno):d.type===b.TOKEN_REGEX&&(e=new RegExp(d.value.body,d.value.flags)):this.fail("expected expression, got end of file"),null!==e?f=new c.Literal(d.lineno,d.colno,e):d.type===b.TOKEN_SYMBOL?(f=new c.Symbol(d.lineno,d.colno,d.value),a||(f=this.parsePostfix(f))):(this.pushToken(d),f=this.parseAggregate()),f?f:void this.fail("unexpected token: "+d.value,d.lineno,d.colno)},parseFilter:function(a){for(;this.skip(b.TOKEN_PIPE);){for(var d=this.expect(b.TOKEN_SYMBOL),e=d.value;this.skipValue(b.TOKEN_OPERATOR,".");)e+="."+this.expect(b.TOKEN_SYMBOL).value;if(a=new c.Filter(d.lineno,d.colno,new c.Symbol(d.lineno,d.colno,e),new c.NodeList(d.lineno,d.colno,[a])),this.peekToken().type===b.TOKEN_LEFT_PAREN){var f=this.parsePostfix(a);a.args.children=a.args.children.concat(f.args.children)}}return a},parseAggregate:function(){var a,d=this.nextToken();switch(d.type){case b.TOKEN_LEFT_PAREN:a=new c.Group(d.lineno,d.colno);break;case b.TOKEN_LEFT_BRACKET:a=new c.Array(d.lineno,d.colno);break;case b.TOKEN_LEFT_CURLY:a=new c.Dict(d.lineno,d.colno);break;default:return null}for(;;){var e=this.peekToken().type;if(e===b.TOKEN_RIGHT_PAREN||e===b.TOKEN_RIGHT_BRACKET||e===b.TOKEN_RIGHT_CURLY){this.nextToken();break}if(a.children.length>0&&(this.skip(b.TOKEN_COMMA)||this.fail("parseAggregate: expected comma after expression",d.lineno,d.colno)),a instanceof c.Dict){var f=this.parsePrimary();this.skip(b.TOKEN_COLON)||this.fail("parseAggregate: expected colon after dict key",d.lineno,d.colno);var g=this.parseExpression();a.addChild(new c.Pair(f.lineno,f.colno,f,g))}else{var h=this.parseExpression();a.addChild(h)}}return a},parseSignature:function(a,d){var e=this.peekToken();if(!d&&e.type!==b.TOKEN_LEFT_PAREN){if(a)return null;this.fail("expected arguments",e.lineno,e.colno)}e.type===b.TOKEN_LEFT_PAREN&&(e=this.nextToken());for(var f=new c.NodeList(e.lineno,e.colno),g=new c.KeywordArgs(e.lineno,e.colno),h=!1;;){if(e=this.peekToken(),!d&&e.type===b.TOKEN_RIGHT_PAREN){this.nextToken();break}if(d&&e.type===b.TOKEN_BLOCK_END)break;if(h&&!this.skip(b.TOKEN_COMMA))this.fail("parseSignature: expected comma after expression",e.lineno,e.colno);else{var i=this.parseExpression();this.skipValue(b.TOKEN_OPERATOR,"=")?g.addChild(new c.Pair(i.lineno,i.colno,i,this.parseExpression())):f.addChild(i)}h=!0}return g.children.length&&f.addChild(g),f},parseUntilBlocks:function(){var a=this.breakOnBlocks;this.breakOnBlocks=e.toArray(arguments);var b=this.parse();return this.breakOnBlocks=a,b},parseNodes:function(){for(var a,d=[];a=this.nextToken();)if(a.type===b.TOKEN_DATA){var e=a.value,f=this.peekToken(),g=f&&f.value;this.dropLeadingWhitespace&&(e=e.replace(/^\s*/,""),this.dropLeadingWhitespace=!1),f&&f.type===b.TOKEN_BLOCK_START&&"-"===g.charAt(g.length-1)&&(e=e.replace(/\s*$/,"")),d.push(new c.Output(a.lineno,a.colno,[new c.TemplateData(a.lineno,a.colno,e)]))}else if(a.type===b.TOKEN_BLOCK_START){var h=this.parseStatement();if(!h)break;d.push(h)}else if(a.type===b.TOKEN_VARIABLE_START){var i=this.parseExpression();this.advanceAfterVariableEnd(),d.push(new c.Output(a.lineno,a.colno,[i]))}else a.type!==b.TOKEN_COMMENT&&this.fail("Unexpected token at top-level: "+a.type,a.lineno,a.colno);return d},parse:function(){return new c.NodeList(0,0,this.parseNodes())},parseAsRoot:function(){return new c.Root(0,0,this.parseNodes())}});a.parser={parse:function(a,c,d){var e=new f(b.lex(a,d));return void 0!==c&&(e.extensions=c),e.parseAsRoot()}}}(),function(){"use strict";function b(){return"hole_"+n++}function c(a,b){for(var c=null,d=0;d<a.length;d++){var e=b(a[d]);e!==a[d]&&(c||(c=a.slice()),c[d]=e)}return c||a}function d(a,b,e){if(!(a instanceof l.Node))return a;if(!e){var f=b(a);if(f&&f!==a)return f}if(a instanceof l.NodeList){
var g=c(a.children,function(a){return d(a,b,e)});g!==a.children&&(a=new l[a.typename](a.lineno,a.colno,g))}else if(a instanceof l.CallExtension){var h=d(a.args,b,e),i=c(a.contentArgs,function(a){return d(a,b,e)});(h!==a.args||i!==a.contentArgs)&&(a=new l[a.typename](a.extName,a.prop,h,i))}else{var j=a.fields.map(function(b){return a[b]}),k=c(j,function(a){return d(a,b,e)});k!==j&&(a=new l[a.typename](a.lineno,a.colno),k.forEach(function(b,c){a[a.fields[c]]=b}))}return e?b(a)||a:a}function e(a,b){return d(a,b,!0)}function f(a,c,d){var f=[],g=e(d?a[d]:a,function(a){if(a instanceof l.Block)return a;if(a instanceof l.Filter&&-1!==m.indexOf(c,a.name.value)||a instanceof l.CallExtensionAsync){var d=new l.Symbol(a.lineno,a.colno,b());return f.push(new l.FilterAsync(a.lineno,a.colno,a.name,a.args,d)),d}});return d?a[d]=g:a=g,f.length?(f.push(a),new l.NodeList(a.lineno,a.colno,f)):a}function g(a,b){return e(a,function(a){return a instanceof l.Output?f(a,b):a instanceof l.For?f(a,b,"arr"):a instanceof l.If?f(a,b,"cond"):a instanceof l.CallExtension?f(a,b,"args"):void 0})}function h(a){return d(a,function(a){if(a instanceof l.Block){var c=!1,e=b();a.body=d(a.body,function(a){return a instanceof l.FunCall&&"super"===a.name.value?(c=!0,new l.Symbol(a.lineno,a.colno,e)):void 0}),c&&a.body.children.unshift(new l.Super(0,0,a.name,new l.Symbol(0,0,e)))}})}function i(a){return e(a,function(a){if(a instanceof l.If||a instanceof l.For){var b=!1;if(d(a,function(a){return a instanceof l.FilterAsync||a instanceof l.IfAsync||a instanceof l.AsyncEach||a instanceof l.AsyncAll||a instanceof l.CallExtensionAsync?(b=!0,a):void 0}),b){if(a instanceof l.If)return new l.IfAsync(a.lineno,a.colno,a.cond,a.body,a.else_);if(a instanceof l.For)return new l.AsyncEach(a.lineno,a.colno,a.arr,a.name,a.body,a.else_)}}})}function j(a,b){return i(h(g(a,b)))}function k(a,b,c){return j(a,b||[])}var l=a.nodes,m=a.lib,n=0;a.transformer={transform:k}}(),function(){"use strict";function b(a){return function(b,c){this.compile(b.left,c),this.emit(a),this.compile(b.right,c)}}var c=a.lib,d=a.parser,e=a.transformer,f=a.nodes,g=a.object,h=a.runtime.Frame,i={"==":"==","!=":"!=","<":"<",">":">","<=":"<=",">=":">="},j=g.extend({init:function(a){this.templateName=a,this.codebuf=[],this.lastId=0,this.buffer=null,this.bufferStack=[],this.isChild=!1,this.scopeClosers=""},fail:function(a,b,d){throw void 0!==b&&(b+=1),void 0!==d&&(d+=1),new c.TemplateError(a,b,d)},pushBufferId:function(a){this.bufferStack.push(this.buffer),this.buffer=a,this.emit("var "+this.buffer+' = "";')},popBufferId:function(){this.buffer=this.bufferStack.pop()},emit:function(a){this.codebuf.push(a)},emitLine:function(a){this.emit(a+"\n")},emitLines:function(){c.each(c.toArray(arguments),function(a){this.emitLine(a)},this)},emitFuncBegin:function(a){this.buffer="output",this.scopeClosers="",this.emitLine("function "+a+"(env, context, frame, runtime, cb) {"),this.emitLine("var lineno = null;"),this.emitLine("var colno = null;"),this.emitLine("var "+this.buffer+' = "";'),this.emitLine("try {")},emitFuncEnd:function(a){a||this.emitLine("cb(null, "+this.buffer+");"),this.closeScopeLevels(),this.emitLine("} catch (e) {"),this.emitLine("  cb(runtime.handleError(e, lineno, colno));"),this.emitLine("}"),this.emitLine("}"),this.buffer=null},addScopeLevel:function(){this.scopeClosers+="})"},closeScopeLevels:function(){this.emitLine(this.scopeClosers+";"),this.scopeClosers=""},withScopedSyntax:function(a){var b=this.scopeClosers;this.scopeClosers="",a.call(this),this.closeScopeLevels(),this.scopeClosers=b},makeCallback:function(a){var b=this.tmpid();return"function("+b+(a?","+a:"")+") {\nif("+b+") { cb("+b+"); return; }"},tmpid:function(){return this.lastId++,"t_"+this.lastId},_templateName:function(){return null==this.templateName?"undefined":JSON.stringify(this.templateName)},_bufferAppend:function(a){this.emit(this.buffer+" += runtime.suppressValue("),a.call(this),this.emit(", env.opts.autoescape);\n")},_compileChildren:function(a,b){for(var c=a.children,d=0,e=c.length;e>d;d++)this.compile(c[d],b)},_compileAggregate:function(a,b,c,d){c&&this.emit(c);for(var e=0;e<a.children.length;e++)e>0&&this.emit(","),this.compile(a.children[e],b);d&&this.emit(d)},_compileExpression:function(a,b){this.assertType(a,f.Literal,f.Symbol,f.Group,f.Array,f.Dict,f.FunCall,f.Caller,f.Filter,f.LookupVal,f.Compare,f.InlineIf,f.In,f.And,f.Or,f.Not,f.Add,f.Sub,f.Mul,f.Div,f.FloorDiv,f.Mod,f.Pow,f.Neg,f.Pos,f.Compare,f.NodeList),this.compile(a,b)},assertType:function(a){for(var b=c.toArray(arguments).slice(1),d=!1,e=0;e<b.length;e++)a instanceof b[e]&&(d=!0);d||this.fail("assertType: invalid type: "+a.typename,a.lineno,a.colno)},compileCallExtension:function(a,b,d){var e=(a.extName,a.args),g=a.contentArgs,h="boolean"==typeof a.autoescape?a.autoescape:!0;if(d||this.emit(this.buffer+" += runtime.suppressValue("),this.emit('env.getExtension("'+a.extName+'")["'+a.prop+'"]('),this.emit("context"),(e||g)&&this.emit(","),e&&(e instanceof f.NodeList||this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),c.each(e.children,function(a,c){this._compileExpression(a,b),(c!==e.children.length-1||g.length)&&this.emit(",")},this)),g.length&&c.each(g,function(a,c){if(c>0&&this.emit(","),a){var d=this.tmpid();this.emitLine("function(cb) {"),this.emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}"),this.pushBufferId(d),this.withScopedSyntax(function(){this.compile(a,b),this.emitLine("cb(null, "+d+");")}),this.popBufferId(),this.emitLine("return "+d+";"),this.emitLine("}")}else this.emit("null")},this),d){var i=this.tmpid();this.emitLine(", "+this.makeCallback(i)),this.emitLine(this.buffer+" += runtime.suppressValue("+i+", "+h+" && env.opts.autoescape);"),this.addScopeLevel()}else this.emit(")"),this.emit(", "+h+" && env.opts.autoescape);\n")},compileCallExtensionAsync:function(a,b){this.compileCallExtension(a,b,!0)},compileNodeList:function(a,b){this._compileChildren(a,b)},compileLiteral:function(a,b){if("string"==typeof a.value){var c=a.value.replace(/\\/g,"\\\\");c=c.replace(/"/g,'\\"'),c=c.replace(/\n/g,"\\n"),c=c.replace(/\r/g,"\\r"),c=c.replace(/\t/g,"\\t"),this.emit('"'+c+'"')}else this.emit(a.value.toString())},compileSymbol:function(a,b){var c,d=a.value;(c=b.lookup(d))?this.emit(c):this.emit('runtime.contextOrFrameLookup(context, frame, "'+d+'")')},compileGroup:function(a,b){this._compileAggregate(a,b,"(",")")},compileArray:function(a,b){this._compileAggregate(a,b,"[","]")},compileDict:function(a,b){this._compileAggregate(a,b,"{","}")},compilePair:function(a,b){var c=a.key,d=a.value;c instanceof f.Symbol?c=new f.Literal(c.lineno,c.colno,c.value):c instanceof f.Literal&&"string"==typeof c.value||this.fail("compilePair: Dict keys must be strings or names",c.lineno,c.colno),this.compile(c,b),this.emit(": "),this._compileExpression(d,b)},compileInlineIf:function(a,b){this.emit("("),this.compile(a.cond,b),this.emit("?"),this.compile(a.body,b),this.emit(":"),null!==a.else_?this.compile(a.else_,b):this.emit('""'),this.emit(")")},compileIn:function(a,b){this.emit("("),this.compile(a.right,b),this.emit(".indexOf("),this.compile(a.left,b),this.emit(") !== -1)")},compileOr:b(" || "),compileAnd:b(" && "),compileAdd:b(" + "),compileSub:b(" - "),compileMul:b(" * "),compileDiv:b(" / "),compileMod:b(" % "),compileNot:function(a,b){this.emit("!"),this.compile(a.target,b)},compileFloorDiv:function(a,b){this.emit("Math.floor("),this.compile(a.left,b),this.emit(" / "),this.compile(a.right,b),this.emit(")")},compilePow:function(a,b){this.emit("Math.pow("),this.compile(a.left,b),this.emit(", "),this.compile(a.right,b),this.emit(")")},compileNeg:function(a,b){this.emit("-"),this.compile(a.target,b)},compilePos:function(a,b){this.emit("+"),this.compile(a.target,b)},compileCompare:function(a,b){this.compile(a.expr,b);for(var c=0;c<a.ops.length;c++){var d=a.ops[c];this.emit(" "+i[d.type]+" "),this.compile(d.expr,b)}},compileLookupVal:function(a,b){this.emit("runtime.memberLookup(("),this._compileExpression(a.target,b),this.emit("),"),this._compileExpression(a.val,b),this.emit(", env.opts.autoescape)")},_getNodeName:function(a){switch(a.typename){case"Symbol":return a.value;case"FunCall":return"the return value of ("+this._getNodeName(a.name)+")";case"LookupVal":return this._getNodeName(a.target)+'["'+this._getNodeName(a.val)+'"]';case"Literal":return a.value.toString().substr(0,10);default:return"--expression--"}},compileFunCall:function(a,b){this.emit("(lineno = "+a.lineno+", colno = "+a.colno+", "),this.emit("runtime.callWrap("),this._compileExpression(a.name,b),this.emit(', "'+this._getNodeName(a.name).replace(/"/g,'\\"')+'", '),this._compileAggregate(a.args,b,"[","])"),this.emit(")")},compileFilter:function(a,b){var c=a.name;this.assertType(c,f.Symbol),this.emit('env.getFilter("'+c.value+'").call(context, '),this._compileAggregate(a.args,b),this.emit(")")},compileFilterAsync:function(a,b){var c=a.name;this.assertType(c,f.Symbol);var d=a.symbol.value;b.set(d,d),this.emit('env.getFilter("'+c.value+'").call(context, '),this._compileAggregate(a.args,b),this.emitLine(", "+this.makeCallback(d)),this.addScopeLevel()},compileKeywordArgs:function(a,b){var d=[];c.each(a.children,function(a){d.push(a.key.value)}),this.emit("runtime.makeKeywordArgs("),this.compileDict(a,b),this.emit(")")},compileSet:function(a,b){var d=[];c.each(a.targets,function(a){var c=a.value,e=b.lookup(c);(null===e||void 0===e)&&(e=this.tmpid(),this.emitLine("var "+e+";")),d.push(e)},this),this.emit(d.join(" = ")+" = "),this._compileExpression(a.value,b),this.emitLine(";"),c.each(a.targets,function(a,b){var c=d[b],e=a.value;this.emitLine('frame.set("'+e+'", '+c+", true);"),this.emitLine("if(!frame.parent) {"),this.emitLine('context.setVariable("'+e+'", '+c+");"),"_"!==e.charAt(0)&&this.emitLine('context.addExport("'+e+'");'),this.emitLine("}")},this)},compileIf:function(a,b,c){this.emit("if("),this._compileExpression(a.cond,b),this.emitLine(") {"),this.withScopedSyntax(function(){this.compile(a.body,b),c&&this.emit("cb()")}),a.else_?(this.emitLine("}\nelse {"),this.withScopedSyntax(function(){this.compile(a.else_,b),c&&this.emit("cb()")})):c&&(this.emitLine("}\nelse {"),this.emit("cb()")),this.emitLine("}")},compileIfAsync:function(a,b){this.emit("(function(cb) {"),this.compileIf(a,b,!0),this.emit("})(function() {"),this.addScopeLevel()},emitLoopBindings:function(a,b,c,d){var e={index:c+" + 1",index0:c,revindex:d+" - "+c,revindex0:d+" - "+c+" - 1",first:c+" === 0",last:c+" === "+d+" - 1",length:d};for(var f in e)this.emitLine('frame.set("loop.'+f+'", '+e[f]+");")},compileFor:function(a,b){var c=this.tmpid(),d=this.tmpid(),e=this.tmpid();if(b=b.push(),this.emitLine("frame = frame.push();"),this.emit("var "+e+" = "),this._compileExpression(a.arr,b),this.emitLine(";"),this.emit("if("+e+") {"),a.name instanceof f.Array){this.emitLine("var "+c+";"),this.emitLine("if(runtime.isArray("+e+")) {"),this.emitLine("var "+d+" = "+e+".length;"),this.emitLine("for("+c+"=0; "+c+" < "+e+".length; "+c+"++) {");for(var g=0;g<a.name.children.length;g++){var h=this.tmpid();this.emitLine("var "+h+" = "+e+"["+c+"]["+g+"]"),this.emitLine('frame.set("'+a.name.children[g].value+'", '+e+"["+c+"]["+g+"]);"),b.set(a.name.children[g].value,h)}this.emitLoopBindings(a,e,c,d),this.withScopedSyntax(function(){this.compile(a.body,b)}),this.emitLine("}"),this.emitLine("} else {");var i=a.name.children[0],j=a.name.children[1],k=this.tmpid(),l=this.tmpid();b.set(i.value,k),b.set(j.value,l),this.emitLine(c+" = -1;"),this.emitLine("var "+d+" = runtime.keys("+e+").length;"),this.emitLine("for(var "+k+" in "+e+") {"),this.emitLine(c+"++;"),this.emitLine("var "+l+" = "+e+"["+k+"];"),this.emitLine('frame.set("'+i.value+'", '+k+");"),this.emitLine('frame.set("'+j.value+'", '+l+");"),this.emitLoopBindings(a,e,c,d),this.withScopedSyntax(function(){this.compile(a.body,b)}),this.emitLine("}"),this.emitLine("}")}else{var l=this.tmpid();b.set(a.name.value,l),this.emitLine("var "+d+" = "+e+".length;"),this.emitLine("for(var "+c+"=0; "+c+" < "+e+".length; "+c+"++) {"),this.emitLine("var "+l+" = "+e+"["+c+"];"),this.emitLine('frame.set("'+a.name.value+'", '+l+");"),this.emitLoopBindings(a,e,c,d),this.withScopedSyntax(function(){this.compile(a.body,b)}),this.emitLine("}")}this.emitLine("}"),a.else_&&(this.emitLine("if (!"+d+") {"),this.compile(a.else_,b),this.emitLine("}")),this.emitLine("frame = frame.pop();")},_compileAsyncLoop:function(a,b,d){var e=this.tmpid(),g=this.tmpid(),h=this.tmpid(),i=d?"asyncAll":"asyncEach";if(b=b.push(),this.emitLine("frame = frame.push();"),this.emit("var "+h+" = "),this._compileExpression(a.arr,b),this.emitLine(";"),a.name instanceof f.Array)this.emit("runtime."+i+"("+h+", "+a.name.children.length+", function("),c.each(a.name.children,function(a){this.emit(a.value+",")},this),this.emit(e+","+g+",next) {"),c.each(a.name.children,function(a){var c=a.value;b.set(c,c),this.emitLine('frame.set("'+c+'", '+c+");")},this);else{var j=a.name.value;this.emitLine("runtime."+i+"("+h+", 1, function("+j+", "+e+", "+g+",next) {"),this.emitLine('frame.set("'+j+'", '+j+");"),b.set(j,j)}this.emitLoopBindings(a,h,e,g),this.withScopedSyntax(function(){var c;d&&(c=this.tmpid(),this.pushBufferId(c)),this.compile(a.body,b),this.emitLine("next("+e+(c?","+c:"")+");"),d&&this.popBufferId()});var k=this.tmpid();this.emitLine("}, "+this.makeCallback(k)),this.addScopeLevel(),d&&this.emitLine(this.buffer+" += "+k+";"),a.else_&&(this.emitLine("if (!"+h+".length) {"),this.compile(a.else_,b),this.emitLine("}")),this.emitLine("frame = frame.pop();")},compileAsyncEach:function(a,b){this._compileAsyncLoop(a,b)},compileAsyncAll:function(a,b){this._compileAsyncLoop(a,b,!0)},_compileMacro:function(a,b){var d=[],e=null,g="macro_"+this.tmpid();c.each(a.args.children,function(b,c){c===a.args.children.length-1&&b instanceof f.Dict?e=b:(this.assertType(b,f.Symbol),d.push(b))},this);var h=c.map(d,function(a){return"l_"+a.value});h.push("kwargs");var i=c.map(d,function(a){return'"'+a.value+'"'}),j=c.map(e&&e.children||[],function(a){return'"'+a.key.value+'"'});b=b.push(),this.emitLines("var "+g+" = runtime.makeMacro(","["+i.join(", ")+"], ","["+j.join(", ")+"], ","function ("+h.join(", ")+") {","frame = frame.push();","kwargs = kwargs || {};",'if (kwargs.hasOwnProperty("caller")) {','frame.set("caller", kwargs.caller); }'),c.each(d,function(a){this.emitLine('frame.set("'+a.value+'", l_'+a.value+");"),b.set(a.value,"l_"+a.value)},this),e&&c.each(e.children,function(a){var c=a.key.value;this.emit('frame.set("'+c+'", kwargs.hasOwnProperty("'+c+'") ? kwargs["'+c+'"] : '),this._compileExpression(a.value,b),this.emitLine(");")},this);var k=this.tmpid();return this.pushBufferId(k),this.withScopedSyntax(function(){this.compile(a.body,b)}),b=b.pop(),this.emitLine("frame = frame.pop();"),this.emitLine("return new runtime.SafeString("+k+");"),this.emitLine("});"),this.popBufferId(),g},compileMacro:function(a,b){var c=this._compileMacro(a,b),d=a.name.value;b.set(d,c),b.parent?this.emitLine('frame.set("'+d+'", '+c+");"):("_"!==a.name.value.charAt(0)&&this.emitLine('context.addExport("'+d+'");'),this.emitLine('context.setVariable("'+d+'", '+c+");"))},compileCaller:function(a,b){this.emit("(function (){");var c=this._compileMacro(a,b);this.emit("return "+c+";})()")},compileImport:function(a,b){var c=this.tmpid(),d=a.target.value;this.emit("env.getTemplate("),this._compileExpression(a.template,b),this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(c)),this.addScopeLevel(),this.emitLine(c+".getExported("+(a.withContext?"context.getVariables(), frame.push(), ":"")+this.makeCallback(c)),this.addScopeLevel(),b.set(d,c),b.parent?this.emitLine('frame.set("'+d+'", '+c+");"):this.emitLine('context.setVariable("'+d+'", '+c+");")},compileFromImport:function(a,b){var d=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(a.template,b),this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(d)),this.addScopeLevel(),this.emitLine(d+".getExported("+(a.withContext?"context.getVariables(), frame.push(), ":"")+this.makeCallback(d)),this.addScopeLevel(),c.each(a.names.children,function(a){var c,e,g=this.tmpid();a instanceof f.Pair?(c=a.key.value,e=a.value.value):(c=a.value,e=c),this.emitLine("if("+d+'.hasOwnProperty("'+c+'")) {'),this.emitLine("var "+g+" = "+d+"."+c+";"),this.emitLine("} else {"),this.emitLine("cb(new Error(\"cannot import '"+c+"'\")); return;"),this.emitLine("}"),b.set(e,g),b.parent?this.emitLine('frame.set("'+e+'", '+g+");"):this.emitLine('context.setVariable("'+e+'", '+g+");")},this)},compileBlock:function(a,b){if(!this.isChild){var c=this.tmpid();this.emitLine('context.getBlock("'+a.name.value+'")(env, context, frame, runtime, '+this.makeCallback(c)),this.emitLine(this.buffer+" += "+c+";"),this.addScopeLevel()}},compileSuper:function(a,b){var c=a.blockName.value,d=a.symbol.value;this.emitLine('context.getSuper(env, "'+c+'", b_'+c+", frame, runtime, "+this.makeCallback(d)),this.emitLine(d+" = runtime.markSafe("+d+");"),this.addScopeLevel(),b.set(d,d)},compileExtends:function(a,b){this.isChild&&this.fail("compileExtends: cannot extend multiple times",a.template.lineno,a.template.colno);var c=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(a.template,b),this.emitLine(", true, "+this._templateName()+", "+this.makeCallback("parentTemplate")),this.emitLine("for(var "+c+" in parentTemplate.blocks) {"),this.emitLine("context.addBlock("+c+", parentTemplate.blocks["+c+"]);"),this.emitLine("}"),this.addScopeLevel(),this.isChild=!0},compileInclude:function(a,b){var c=this.tmpid(),d=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(a.template,b),this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(c)),this.addScopeLevel(),this.emitLine(c+".render(context.getVariables(), frame.push(), "+this.makeCallback(d)),this.emitLine(this.buffer+" += "+d),this.addScopeLevel()},compileTemplateData:function(a,b){this.compileLiteral(a,b)},compileOutput:function(a,b){for(var c=a.children,d=0,e=c.length;e>d;d++)c[d]instanceof f.TemplateData?c[d].value&&(this.emit(this.buffer+" += "),this.compileLiteral(c[d],b),this.emitLine(";")):(this.emit(this.buffer+" += runtime.suppressValue("),this.compile(c[d],b),this.emit(", env.opts.autoescape);\n"))},compileRoot:function(a,b){b&&this.fail("compileRoot: root node can't have frame"),b=new h,this.emitFuncBegin("root"),this._compileChildren(a,b),this.isChild&&this.emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),this.emitFuncEnd(this.isChild),this.isChild=!1;for(var c=a.findAll(f.Block),d=0;d<c.length;d++){var e=c[d],g=e.name.value;this.emitFuncBegin("b_"+g);var i=new h;this.compile(e.body,i),this.emitFuncEnd()}this.emitLine("return {");for(var d=0;d<c.length;d++){var e=c[d],g="b_"+e.name.value;this.emitLine(g+": "+g+",")}this.emitLine("root: root\n};")},compile:function(a,b){var c=this["compile"+a.typename];c?c.call(this,a,b):this.fail("compile: Cannot compile node: "+a.typename,a.lineno,a.colno)},getCode:function(){return this.codebuf.join("")}});a.compiler={compile:function(a,b,c,f,g){var h=new j(f);if(c&&c.length)for(var i=0;i<c.length;i++)"preprocess"in c[i]&&(a=c[i].preprocess(a,f));return h.compile(e.transform(d.parse(a,c,g),b,f)),h.getCode()},Compiler:j}}(),function(){"use strict";var b=a.lib,c=a.runtime,d={abs:function(a){return Math.abs(a)},batch:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)f%b===0&&e.length&&(d.push(e),e=[]),e.push(a[f]);if(e.length){if(c)for(var f=e.length;b>f;f++)e.push(c);d.push(e)}return d},capitalize:function(a){var b=a.toLowerCase();return c.copySafeness(a,b.charAt(0).toUpperCase()+b.slice(1))},center:function(a,d){if(d=d||80,a.length>=d)return a;var e=d-a.length,f=b.repeat(" ",e/2-e%2),g=b.repeat(" ",e/2);return c.copySafeness(a,f+a+g)},"default":function(a,b){return a?a:b},dictsort:function(a,c,d){if(!b.isObject(a))throw new b.TemplateError("dictsort filter: val must be an object");var e=[];for(var f in a)e.push([f,a[f]]);var g;if(void 0===d||"key"===d)g=0;else{if("value"!==d)throw new b.TemplateError("dictsort filter: You can only sort by either key or value");g=1}return e.sort(function(a,d){var e=a[g],f=d[g];return c||(b.isString(e)&&(e=e.toUpperCase()),b.isString(f)&&(f=f.toUpperCase())),e>f?1:e===f?0:-1}),e},escape:function(a){return"string"==typeof a||a instanceof c.SafeString?b.escape(a):a},safe:function(a){return c.markSafe(a)},first:function(a){return a[0]},groupby:function(a,c){return b.groupBy(a,c)},indent:function(a,d,e){d=d||4;for(var f="",g=a.split("\n"),h=b.repeat(" ",d),i=0;i<g.length;i++)f+=0!==i||e?h+g[i]+"\n":g[i]+"\n";return c.copySafeness(a,f)},join:function(a,c,d){return c=c||"",d&&(a=b.map(a,function(a){return a[d]})),a.join(c)},last:function(a){return a[a.length-1]},length:function(a){return void 0!==a?a.length:0},list:function(a){if(b.isString(a))return a.split("");if(b.isObject(a)){var c=[];if(Object.keys)c=Object.keys(a);else for(var d in a)c.push(d);return b.map(c,function(b){return{key:b,value:a[b]}})}if(b.isArray(a))return a;throw new b.TemplateError("list filter: type not iterable")},lower:function(a){return a.toLowerCase()},random:function(a){return a[Math.floor(Math.random()*a.length)]},rejectattr:function(a,b){return a.filter(function(a){return!a[b]})},selectattr:function(a,b){return a.filter(function(a){return!!a[b]})},replace:function(a,b,d,e){if(b instanceof RegExp)return a.replace(b,d);var f=a,g=f,h=1;for(f=f.replace(b,d);g!==f&&!(h>=e);)g=f,f=f.replace(b,d),h++;return c.copySafeness(a,f)},reverse:function(a){var e;return e=b.isString(a)?d.list(a):b.map(a,function(a){return a}),e.reverse(),b.isString(a)?c.copySafeness(a,e.join("")):e},round:function(a,b,c){b=b||0;var d,e=Math.pow(10,b);return d="ceil"===c?Math.ceil:"floor"===c?Math.floor:Math.round,d(a*e)/e},slice:function(a,b,c){for(var d=Math.floor(a.length/b),e=a.length%b,f=0,g=[],h=0;b>h;h++){var i=f+h*d;e>h&&f++;var j=f+(h+1)*d,k=a.slice(i,j);c&&h>=e&&k.push(c),g.push(k)}return g},sort:function(a,c,d,e){return a=b.map(a,function(a){return a}),a.sort(function(a,f){var g,h;return e?(g=a[e],h=f[e]):(g=a,h=f),!d&&b.isString(g)&&b.isString(h)&&(g=g.toLowerCase(),h=h.toLowerCase()),h>g?c?1:-1:g>h?c?-1:1:0}),a},string:function(a){return c.copySafeness(a,a)},title:function(a){for(var b=a.split(" "),e=0;e<b.length;e++)b[e]=d.capitalize(b[e]);return c.copySafeness(a,b.join(" "))},trim:function(a){return c.copySafeness(a,a.replace(/^\s*|\s*$/g,""))},truncate:function(a,b,d,e){var f=a;if(b=b||255,a.length<=b)return a;if(d)a=a.substring(0,b);else{var g=a.lastIndexOf(" ",b);-1===g&&(g=b),a=a.substring(0,g)}return a+=void 0!==e&&null!==e?e:"...",c.copySafeness(f,a)},upper:function(a){return a.toUpperCase()},urlencode:function(a){var c=encodeURIComponent;if(b.isString(a))return c(a);var d;if(b.isArray(a))d=a.map(function(a){return c(a[0])+"="+c(a[1])});else{d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(c(e)+"="+c(a[e]))}return d.join("&")},urlize:function(a,b,c){isNaN(b)&&(b=1/0);var d=c===!0?' rel="nofollow"':"",e=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,f=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,g=/^https?:\/\/.*$/,h=/^www\./,i=/\.(?:org|net|com)(?:\:|\/|$)/,j=a.split(/\s+/).filter(function(a){return a&&a.length}).map(function(a){var c=a.match(e),j=c&&c[1]||a;return g.test(j)?'<a href="'+j+'"'+d+">"+j.substr(0,b)+"</a>":h.test(j)?'<a href="http://'+j+'"'+d+">"+j.substr(0,b)+"</a>":f.test(j)?'<a href="mailto:'+j+'">'+j+"</a>":i.test(j)?'<a href="http://'+j+'"'+d+">"+j.substr(0,b)+"</a>":a});return j.join(" ")},wordcount:function(a){var b=a?a.match(/\w+/g):null;return b?b.length:null},"float":function(a,b){var c=parseFloat(a);return isNaN(c)?b:c},"int":function(a,b){var c=parseInt(a,10);return isNaN(c)?b:c}};d.d=d["default"],d.e=d.escape,a.filters=d}(),function(){"use strict";function b(a){var b=-1;return{current:null,reset:function(){b=-1,this.current=null},next:function(){return b++,b>=a.length&&(b=0),this.current=a[b],this.current}}}function c(a){a=a||",";var b=!0;return function(){var c=b?"":a;return b=!1,c}}var d={range:function(a,b,c){b?c||(c=1):(b=a,a=0,c=1);for(var d=[],e=a;b>e;e+=c)d.push(e);return d},cycler:function(){return b(Array.prototype.slice.call(arguments))},joiner:function(a){return c(a)}};a.globals=d}(),function(){"use strict";var b=a.path,c=a.object,d=a.lib,e=c.extend({on:function(a,b){this.listeners=this.listeners||{},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(b)},emit:function(a){var b=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[a]&&d.each(this.listeners[a],function(a){a.apply(null,b)})},resolve:function(a,c){return b.resolve(b.dirname(a),c)},isRelative:function(a){return 0===a.indexOf("./")||0===a.indexOf("../")}});a.loader=e}(),function(){"use strict";var b=a.loader,c=b.extend({init:function(a,b){this.precompiled=window.nunjucksPrecompiled||{},this.baseURL=a||"",this.neverUpdate=b},getSource:function(a){if(this.precompiled[a])return{src:{type:"code",obj:this.precompiled[a]},path:a};var b=this.fetch(this.baseURL+"/"+a);return b?{src:b,path:a,noCache:!this.neverUpdate}:null},fetch:function(a,b){var c,d,e=!0;return window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP")),c.onreadystatechange=function(){4!==c.readyState||0!==c.status&&200!==c.status||!e||(e=!1,d=c.responseText)},a+=(-1===a.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),c.open("GET",a,!1),c.send(),d}});a["web-loaders"]={WebLoader:c}}(),function(){"undefined"==typeof window||window!==this?a.loaders=a["node-loaders"]:a.loaders=a["web-loaders"]}(),function(){"use strict";var b=a.path,c=a.lib,d=a.object,e=(a.lexer,a.compiler),f=a.filters,g=a.loaders,h=a.runtime,i=a.globals,j=h.Frame,k=d.extend({init:function(a,b){var b=this.opts=b||{};this.opts.dev=!!b.dev,this.opts.autoescape=!!b.autoescape,this.opts.trimBlocks=!!b.trimBlocks,this.opts.lstripBlocks=!!b.lstripBlocks,a?this.loaders=c.isArray(a)?a:[a]:g.FileSystemLoader?this.loaders=[new g.FileSystemLoader("views")]:this.loaders=[new g.WebLoader("/views")],this.initCache(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var d in f)this.addFilter(d,f[d])},initCache:function(){c.each(this.loaders,function(a){a.cache={},"function"==typeof a.on&&a.on("update",function(b){a.cache[b]=null})})},addExtension:function(a,b){b._name=a,this.extensions[a]=b,this.extensionsList.push(b)},getExtension:function(a){return this.extensions[a]},addGlobal:function(a,b){i[a]=b},addFilter:function(a,b,c){var d=b;c&&this.asyncFilters.push(a),this.filters[a]=d},getFilter:function(a){if(!this.filters[a])throw new Error("filter not found: "+a);return this.filters[a]},resolveTemplate:function(a,b,c){var d=a.isRelative&&b?a.isRelative(c):!1;return d&&a.resolve?a.resolve(b,c):c},getTemplate:function(a,b,d,e){var f=this,g=null;if(a&&a.raw&&(a=a.raw),c.isFunction(d)&&(e=d,d=null,b=b||!1),c.isFunction(b)&&(e=b,b=!1),"string"!=typeof a)throw new Error("template names must be a string: "+a);for(var h=0;h<this.loaders.length;h++){var i=this.resolveTemplate(this.loaders[h],d,a);if(g=this.loaders[h].cache[i])break}if(!g){var j;return c.asyncIter(this.loaders,function(b,c,e,g){function h(a){a?(a.loader=b,g(a)):e()}a=f.resolveTemplate(b,d,a),b.async?b.getSource(a,function(a,b){if(a)throw a;h(b)}):h(b.getSource(a))},function(c){if(c){var d=new m(c.src,this,c.path,b);c.noCache||(c.loader.cache[a]=d),e?e(null,d):j=d}else{var f=new Error("template not found: "+a);if(!e)throw f;e(f)}}.bind(this)),j}return b&&g.compile(),e?void e(null,g):g},express:function(a){function c(a,c){if(this.name=a,this.path=a,this.defaultEngine=c.defaultEngine,this.ext=b.extname(a),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var d=this;c.prototype.render=function(a,b){d.render(this.name,a,b)},a.set("view",c)},render:function(a,b,d){c.isFunction(b)&&(d=b,b=null);var e=null;return this.getTemplate(a,function(a,c){if(a&&d)d(a);else{if(a)throw a;c.render(b,d||function(a,b){if(a)throw a;e=b})}}),e},renderString:function(a,b,d,e){c.isFunction(d)&&(e=d,d={}),d=d||{};var f=new m(a,this,d.path);return f.render(b,e)}}),l=d.extend({init:function(a,b){this.ctx=a,this.blocks={},this.exported=[];for(var c in b)this.addBlock(c,b[c])},lookup:function(a){return a in i&&!(a in this.ctx)?i[a]:this.ctx[a]},setVariable:function(a,b){this.ctx[a]=b},getVariables:function(){return this.ctx},addBlock:function(a,b){this.blocks[a]=this.blocks[a]||[],this.blocks[a].push(b)},getBlock:function(a){if(!this.blocks[a])throw new Error('unknown block "'+a+'"');return this.blocks[a][0]},getSuper:function(a,b,d,e,f,g){var h=c.indexOf(this.blocks[b]||[],d),i=this.blocks[b][h+1],j=this;if(-1===h||!i)throw new Error('no super block available for "'+b+'"');i(a,j,e,f,g)},addExport:function(a){this.exported.push(a)},getExported:function(){for(var a={},b=0;b<this.exported.length;b++){var c=this.exported[b];a[c]=this.ctx[c]}return a}}),m=d.extend({init:function(a,b,d,e){if(this.env=b||new k,c.isObject(a))switch(a.type){case"code":this.tmplProps=a.obj;break;case"string":this.tmplStr=a.obj}else{if(!c.isString(a))throw new Error("src must be a string or an object describing the source");this.tmplStr=a}this.path=d,e?c.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this)):this.compiled=!1},render:function(a,b,d){return"function"==typeof a?(d=a,a={}):"function"==typeof b&&(d=b,b=null),c.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(c){if(d)return d(c);throw c}var e=new l(a||{},this.blocks),f=null;return this.rootRenderFunc(this.env,e,b||new j,h,d||function(a,b){if(a)throw a;f=b}),f}.bind(this))},getExported:function(a,b,c){"function"==typeof a&&(c=a,a={}),"function"==typeof b&&(c=b,b=null);try{this.compile()}catch(d){if(c)return c(d);throw d}var e=new l(a||{},this.blocks);this.rootRenderFunc(this.env,e,b||new j,h,function(){c(null,e.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var a;if(this.tmplProps)a=this.tmplProps;else{var b=e.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts),c=new Function(b);a=c()}this.blocks=this._getBlocks(a),this.rootRenderFunc=a.root,this.compiled=!0},_getBlocks:function(a){var b={};for(var c in a)"b_"===c.slice(0,2)&&(b[c.slice(2)]=a[c]);return b}});a.environment={Environment:k,Template:m}}();var b,c=a.lib,d=a.environment,e=a.compiler,f=a.parser,g=a.lexer,h=a.runtime,i=a.loader,j=a.loaders,k=a.precompile;b={},b.Environment=d.Environment,b.Template=d.Template,b.Loader=i,b.FileSystemLoader=j.FileSystemLoader,b.WebLoader=j.WebLoader,b.compiler=e,b.parser=f,b.lexer=g,b.runtime=h;var l;b.configure=function(a,b){b=b||{},c.isObject(a)&&(b=a,a=null);var e="watch"in b?!b.watch:!1,f=j.FileSystemLoader||j.WebLoader;return l=new d.Environment(new f(a,e),b),b&&b.express&&l.express(b.express),l},b.compile=function(a,c,d,e){return l||b.configure(),new b.Template(a,c,d,e)},b.render=function(a,c,d){return l||b.configure(),l.render(a,c,d)},b.renderString=function(a,c,d){return l||b.configure(),l.renderString(a,c,d)},k&&(b.precompile=k.precompile,b.precompileString=k.precompileString),b.require=function(b){return a[b]},"function"==typeof define&&define.amd?define(function(){return b}):(window.nunjucks=b,"undefined"!=typeof module&&(module.exports=b))}();