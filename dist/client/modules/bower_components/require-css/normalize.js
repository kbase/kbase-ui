define(function(){function a(a,d,h){if(a.match(g)||a.match(f))return a;a=e(a);var i=h.match(f),j=d.match(f);return!j||i&&i[1]==j[1]&&i[2]==j[2]?c(b(a,d),h):b(a,d)}function b(a,b){if("./"==a.substr(0,2)&&(a=a.substr(2)),a.match(g)||a.match(f))return a;var c=b.split("/"),d=a.split("/");for(c.pop();curPart=d.shift();)".."==curPart?c.pop():c.push(curPart);return c.join("/")}function c(a,b){var c=b.split("/");for(c.pop(),b=c.join("/")+"/",i=0;b.substr(i,1)==a.substr(i,1);)i++;for(;"/"!=b.substr(i,1);)i--;b=b.substr(i+1),a=a.substr(i+1),c=b.split("/");var d=a.split("/");for(out="";c.shift();)out+="../";for(;curPart=d.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var d=/([^:])\/+/g,e=function(a){return a.replace(d,"$1/")},f=/[^\:\/]*:\/\/([^\/])*/,g=/^(\/|data:)/,h=function(b,c,d){c=e(c),d=e(d);for(var f,g,b,h=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;f=h.exec(b);){g=f[3]||f[2]||f[5]||f[6]||f[4];var i;i=a(g,c,d);var j=f[5]||f[6]?1:0;b=b.substr(0,h.lastIndex-g.length-j-1)+i+b.substr(h.lastIndex-j-1),h.lastIndex=h.lastIndex+(i.length-g.length)}return b};return h.convertURIBase=a,h.absoluteURI=b,h.relativeURI=c,h});