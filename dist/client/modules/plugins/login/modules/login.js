define(["kb/common/html","jquery","bluebird"],function(a,b,c){"use strict";function d(){function b(b,c,d){var f=a.genId();return e.push({type:b,selector:"#"+f,handler:c,data:d}),f}function c(a){e.forEach(function(b){a.on(b.type,b.selector,b.data,b.handler)})}function d(a){e.forEach(function(b){b.listener&&a.off(b.type,b.selector)}),e=[]}var e=[];return{add:b,attach:c,reset:d}}function e(e){function g(a){var c=b(q).find(' form [name="'+a+'"]');return c?c.val():void 0}function h(a){return b(q).find(a)}function i(a){return h('[data-element="'+a+'"]')}function j(a){a.preventDefault();var b=g("username"),c=g("password");return b?c?(i("error").hide(),i("sign-in").hide(),i("signing-in").show(),t.send("ui","setTitle","Signing in ..."),void t.getService("session").login({username:b,password:c}).then(function(){t.send("ui","setTitle","Successful Sign In!"),t.send("app","loggedin"),s?t.send("app","navigate",s):t.send("app","navigate","")})["catch"](function(a){t.send("ui","setTitle","Sign In Error"),i("running").hide(),"LoginFailure: Authentication failed."===a&&(a="Login Failed: your username/password is incorrect."),i("error").html(a).show(),i("sign-in").show(),i("signing-in").hide()}).done()):void i("error").html("The password is required").show():void i("error").html("The username is required").show()}function k(){var b=a.tag("form"),c=a.tag("input"),d=a.tag("button"),e=a.tag("div"),g=a.tag("p"),h=a.tag("h1"),i=a.tag("legend"),k=a.tag("i"),l=a.tag("a"),m="next path",n="next url";return u.reset(),e({"class":"container",style:"margin-top: 4em",id:f},[e({},[e({style:"position:absolute; background-image: url(assets/images/doodle.png); background-repeat:no-repeat; background-size:35%; top:0; left:0; bottom: 0; right: 0; opacity: 0.1"})]),e({"class":"row"},[e({"class":"col-sm-7 col-sm-offset-1"},[h({style:"font-size:1.6em"},["Welcome to the KBase Search and Narrative Interface"]),g({},"After signing in you can upload your own experimental data or find data integrated from external resources or shared by other users. You can then perform, organize, and share sophisticated comparative genomics and systems biology analyses by creating Narratives."),g({},"Narratives are user-created interactive, dynamic, and shareable documents that are KBase’s way of making systems biology research transparent, reproducible, and reusable."),g({},"The Narrative Interface lets you customize and execute a set of ordered KBase analyses to create your own Narratives that include your analysis steps, commentary, visualizations, and custom scripts."),g({},'Want to learn more? We have an extensive and growing <a href="http://kbase.us/tutorials">library of tutorials</a> that show you how to use KBase’s new apps to analyze your data.'),g({},'To become familiar with the user interface, try the <a href="http://kbase.us/narrative-guide">Narrative Interface User Guide</a> or the <a href="https://youtu.be/6ql7HAUzU7U">Narrative Interface video tutorial</a>.')]),e({"class":"col-sm-3"},[e({"class":"well well-kbase"},[b({"class":"form login-form",id:u.add("submit",j)},[c({type:"hidden",value:m}),c({type:"hidden",value:n}),i({style:"text-align: center"},"KBase Sign In"),e({"class":"form-group"},[c({name:"username",type:"text",placeholder:"username",id:"kbase_username","class":"form-control form-control-kbase",tabindex:"1"})]),e({"class":"form-group"},[c({name:"password",type:"password",placeholder:"password",id:"kbase_password","class":"form-control form-control-kbase",tabindex:"2"})]),e({"class":"form-group"},[d({id:"signinbtn",type:"submit","class":"btn btn-primary btn-block btn-kbase",tabindex:"3","data-element":"sign-in"},[k({"class":"fa fa-sign-in",style:"margin-right: 1em;"}),"Sign In"]),d({id:"signinbtn",type:"submit","class":"btn btn-primary btn-block btn-kbase",style:"display:none;",tabindex:"3","data-element":"signing-in"},[k({"class":"fa fa-spinner fa-spin",style:"margin-right: 1em;"}),"Signing In..."]),e({"data-element":"error","class":"alert alert-danger alert-kbase",style:"display:none; margin-top: 1em"})]),e({"class":"form-group",style:"margin-top: 3em; margin-bottom: 0;"},[l({target:"_blank",href:"https://gologin.kbase.us/Signup","class":"btn btn-block btn-link"},"New to KBase? Sign Up"),l({target:"_blank",href:"https://gologin.kbase.us/ResetPassword","class":"btn btn-block btn-link"},"Forgot your password?"),l({target:"_blank",href:"http://kbase.us/login-help","class":"btn btn-block btn-link"},"Help")])])])])])])}function l(a){return c["try"](function(){p=a,q=document.createElement("div"),r=b(q),p.appendChild(q)})}function m(a){return c["try"](function(){t.send("ui","setTitle","Sign in to KBase"),t.send("ui","render",{node:q,content:k()}),u.attach(r),a.nextrequest&&(s=JSON.parse(a.nextrequest)),console.log("next request is"),console.log(a)})}function n(){return c["try"](function(){u.reset(r)})}function o(){return c["try"](function(){p.removeChild(q)})}var p,q,r,s,t=e.runtime,u=d();return{attach:l,detach:o,start:m,stop:n}}var f=a.genId();return{make:function(a){return e(a)}}});