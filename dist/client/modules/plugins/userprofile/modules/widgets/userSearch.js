define(["jquery","bluebird","kb_userProfile_widget_base","kb/service/client/UserProfile"],function(a,b,c,d){"use strict";var e=Object.create(c,{init:{value:function(a){return a.name="UserSearch",a.title="Find Other Users",this.SocialWidget_init(a),this}},go:{value:function(){return this.start(),this}},setup:{value:function(){if(this.runtime.service("session").isLoggedIn()){if(!this.runtime.hasConfig("services.user_profile.url"))throw"The user profile client url is not defined";this.userProfileClient=new d(this.runtime.getConfig("user_profile_url"),{token:this.runtime.service("session").getAuthToken()})}}},renderLayout:{value:function(){if(this.container.html(this.renderTemplate("layout")),this.places={title:this.container.find('[data-placeholder="title"]'),alert:this.container.find('[data-placeholder="alert"]'),content:this.container.find('[data-placeholder="content"]')},this.runtime.service("session").isLoggedIn()){var c=this;this.container.find('[data-field="search_text"] input').on("keyup",function(d){return void 0===d.key&&27===d.keyCode||"Esc"===d.key||"Escape"===d.key?(a(this).val(""),void c.setState("searchResults",[])):(c.params.searchText=a(this).val(),void(c.params.searchText&&c.params.searchText.length<3?c.refresh().done():b.resolve(c.userProfileClient.filter_users({filter:c.params.searchText})).then(function(a){a.sort(function(a,b){var c=a.realname.toLowerCase(),d=b.realname.toLowerCase();return d>c?-1:c>d?1:0}),c.setState("searchResults",a)})["catch"](function(a){c.renderErrorView(a)})))})}}}});return e});