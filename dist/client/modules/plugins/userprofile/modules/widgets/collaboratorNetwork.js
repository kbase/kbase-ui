define(["bluebird","kb_userProfile_widget_base","kb/service/serviceApi","kb/service/client/UserProfile"],function(a,b,c,d){"use strict";var e=Object.create(b,{init:{value:function(a){return a.name="CommonCollaboratorNetwork",a.title="Common Collaborator Network",this.SocialWidget_init(a),this}},go:{value:function(){return this.start(),this}},setup:{value:function(){if(this.clientMethods=c.make({runtime:this.runtime}),this.runtime.service("session").isLoggedIn()){if(!this.runtime.hasConfig("services.user_profile.url"))throw"The user profile client url is not defined";this.userProfileClient=new d(this.runtime.getConfig("user_profile_url"),{token:this.runtime.service("session").getAuthToken()})}else this.userProfileClient=null}},setInitialState:{value:function(b){return a["try"](function(){return this.runtime.service("session").isLoggedIn()?a.resolve(this.userProfileClient.get_user_profile([this.params.userId])).then(function(a){if(a&&a[0])return this.setState("currentUserProfile",a[0],!1),this.clientMethods.getCollaborators({users:[this.getParam("userId")]});throw new Error("User not found")}.bind(this)).then(function(a){return this.setState("collaborators",a),null}.bind(this)):void 0}.bind(this))}},render:{value:function(){return this.error?this.renderError():this.runtime.service("session").isLoggedIn()?(this.places.title.html(this.renderTemplate("authorized_title")),this.places.content.html(this.renderTemplate("authorized"))):(this.places.title.html(this.widgetTitle),this.places.content.html(this.renderTemplate("unauthorized"))),this}}});return e});