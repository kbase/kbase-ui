define(["jquery","d3","kb_vis_piechart"],function(a,b){"use strict";a.KBWidget({name:"kbaseCircularHeatmap",parent:"kbasePiechart",version:"1.0.0",options:{labels:!1,draggable:!1,gradient:!1,pieColor:"black",gbgColor:"#00FF00",gmidColor:"black",gfgColor:"#FF0000",highlightColor:"cyan",colorScale:function(a,c,d){if(void 0===d.colorScale){var e=[0,1],f=[d.options.gbgColor||d.options.pieColor,d.options.gfgColor];d.options.gmidColor&&(f.splice(1,0,d.options.gmidColor),e.splice(1,0,.5)),d.colorScale=b.scale.linear().domain(e).range(f)}return d.colorScale(c.val)}},_accessors:[{name:"datasets",setter:"setDatasets"}],init:function(a){return this._super(a),this.options.parent&&(void 0===this.options.gbgColor&&(this.options.gbgColor=this.options.pieColor),delete this.options.pieColor),this},setDatasets:function(a){var b=this,c=b._super,d=function(){for(var d=a.length?a[0]:0,e=0;e<a.length;e++){if(a[e].length!==d.length)throw"Cannot set datasets! Non-standard lengths of circles!";for(var f=0;f<a[e].length;f++)a[e][f].value=1/a[e].length}return void 0===b.originalInnerRadius&&(b.originalInnerRadius=b.innerRadius()),b.options.innerRadius=0-(b.outerRadius()-b.originalInnerRadius)/a.length,c.call(b,a)};b.callAfterInit(d)},sliceAction:function(a){a.outerRadius();return function(){return this.on("mouseover",function(c){if(!c.data.gap){var d=a.options.highlightColor;b.select(this).attr("fill",d);var e=[0,0];e=b.mouse(this);e[0],e[1];a.options.tooltips&&a.showToolTip({label:c.data.tooltip||c.data.label+" : "+c.data.value,event:{pageX:a.options.cornerToolTip?a.$elem.prop("offsetLeft")+5:b.event.pageX,pageY:a.options.cornerToolTip?a.$elem.prop("offsetTop")+20:b.event.pageY}})}}).on("mouseout",function(c){c.data.gap||(a.options.tooltips&&a.hideToolTip(),b.select(this).attr("fill",function(b,d){return c.data.color||a.options.colorScale(d,c.data,a)}))}).on("dblclick",function(b){b.data.gap||a.options.draggable&&(a.options.startAngle=a.options.startAngle-b.startAngle,a.renderChart())}),this}}})});