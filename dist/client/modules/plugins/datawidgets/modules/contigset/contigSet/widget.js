define(["bluebird","kb/common/html","plugins/datawidgets/modules/objectIdentity","./data","./view","./error"],function(a,b,c,d,e,f){"use strict";function g(g){function h(a){m=a,n=m.appendChild(document.createElement("div")),r.setup(n)}function i(a){q.start(a),r.start(a)}function j(d){var e=c.makeObjectRef(d.workspaceId,d.objectId,d.objectVersion);q.fetch({config:{services:{workspace:{url:p.getConfig("services.workspace.url")}}},authorization:{token:p.service("session").getAuthToken()},objectRef:e}).then(function(a){return r.update(a)})["catch"](function(c){o=f.make(g),console.log("ERROR widget"),console.log(o),n.innerHTML="",a["try"](function(){return o.setup(n)}).then(function(){return o.start({})}).then(function(){return o.update({title:"Error Rendering Widget",message:"There was a problem with this widget.",error:c})})["catch"](function(a){n.innerHTML=b.makePanel({title:"Error",content:"Error rendering the error widget"}),console.log("ERROR!"),console.log("Error rendering the error widget"),console.log(a),console.log(c)})})}function k(){r.stop(),o&&o.stop(),q.stop()}function l(){r.teardown(),o&&o.teardown(),m.removeChild(n)}var m,n,o,p=g.runtime,q=d.make(g),r=e.make(g);return{attach:h,start:i,run:j,stop:k,detach:l}}return{make:function(a){return g(a)}}});