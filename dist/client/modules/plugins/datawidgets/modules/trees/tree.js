define(["bluebird","uuid","kb/common/html","kb/service/client/workspace","kb/service/client/UserAndJobState","./lib/easyTree","kb/service/utils","kb/widget/bases/dataWidget"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return g.makeWorkspaceObjectRef(a.workspaceId,a.objectId,a.objectVersion)}function j(a){var b=600;return h.make({runtime:a.runtime,title:"Tree Data View",on:{fetch:function(){var a=new d(this.runtime.getConfig("services.workspace.url"),{token:this.runtime.service("session").getAuthToken()}),b=(new e(this.runtime.getConfig("services.ujs.url"),{token:this.runtime.service("session").getAuthToken()}),i(this.get("params"))),f=[],h={};return this.setTitle(c.loading("Loading Tree Data ...")),a.get_objects([{ref:b}]).then(function(a){if(1===a.length)return a[0].data;throw new Error("Invalid results")}).then(function(b){return b.ws_refs&&(f=Object.keys(b.ws_refs).map(function(a){return{ref:b.ws_refs[a].g[0]}})),[b,a.get_object_info_new({objects:f})]}).spread(function(a,b){var c;for(c=0;c<b.length;c+=1)h[f[c].ref]=g.object_info_to_object(b[c]);this.set("data",{tree:a,refToInfoMap:h})}.bind(this))},layout:function(d){var e=c.genId(),f=c.genId(),g=c.tag("div"),h=c.tag("canvas"),i=g({id:e},[h({id:f,style:{maxHeight:(a.height||b)-85,overflow:"scroll"}})]);return{content:i,places:{canvas:{id:f}}}},render:function(){var a=this.get("data"),b=this.getPlace("canvas");a&&(this.setTitle("Tree Data View"),new f(b.id,a.tree.tree,a.tree.default_node_labels,function(b){if(!a.tree.ws_refs||!a.tree.ws_refs[b.id]){var c,d=a.tree.default_node_labels[b.id];return void(d.indexOf("/")>0&&(c="#genes/"+this.get("params").workspaceId+"/"+d,console.log("URL1"),console.log(c)))}var e=a.tree.ws_refs[b.id].g[0],f=a.refToInfoMap[e];f&&(c="#dataview/"+f.ws+"/"+f.name,window.open(c,"_blank"))},function(a){return a.id&&0===a.id.indexOf("user")?"#0000ff":null}))}}})}return{make:function(a){return j(a)}}});