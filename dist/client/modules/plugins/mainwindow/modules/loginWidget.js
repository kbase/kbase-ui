define(["kb/widget/bases/simpleWidget","kb/common/html","kb_plugin_mainWindow","bootstrap"],function(a,b,c){"use strict";function d(d){function e(a){a.preventDefault(),h.service("session").logout().then(function(){})["catch"](function(a){console.log("ERROR"),console.log(a),alert("Error signing out (check console for details)")})}function f(a){var b=a.get("userProfile");return q(b?{src:b.getAvatarURL(),style:"width: 40px;","class":"login-button-avatar","data-element":"avatar"}:{src:c.plugin.path+"/images/nouserpic.png",style:"width: 40px;","class":"login-button-avatar","data-element":"avatar"})}function g(a){if(h.service("session").isLoggedIn()){var b,c=a.get("userProfile");if(!c)return;return b=c?c.getProp("user.realname"):"?",j({"class":"dropdown",style:"display:inline-block"},[i({type:"button","class":"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false"},[f(a),l({"class":"caret",style:"margin-left: 5px;"})]),m({"class":"dropdown-menu",role:"menu"},[n({},[k({href:"#people/"+h.service("session").getUsername(),"data-menu-item":"userlabel"},[j({style:"display:inline-block; width: 34px; vertical-align: top;"},[l({"class":"fa fa-user",style:"font-size: 150%; margin-right: 10px;"})]),j({style:"display: inline-block","data-element":"user-label"},[b,o(),p({},h.service("session").getUsername())])])]),n({"class":"divider"}),n({},[k({href:"#","data-menu-item":"logout",id:a.addDomEvent("click",e)},[j({style:"display: inline-block; width: 34px;"},[l({"class":"fa fa-sign-out",style:"font-size: 150%; margin-right: 10px;"})]),"Sign Out"])])])])}return k({type:"button","class":"btn btn-primary navbar-btn kb-nav-btn","data-button":"signin",href:"#login"},[j({"class":"fa fa-sign-in  fa-inverse",style:"margin-right: 5px;"}),j({"class":"kb-nav-btn-txt"},["Sign In"])])}var h=d.runtime;if(!h)throw{name:"RuntimeMissing",message:"The runtime argument is required but is missing",suggestion:"This is an application error, and no fault of yours."};var i=b.tag("button"),j=b.tag("div"),k=b.tag("a"),l=b.tag("span"),m=b.tag("ul"),n=b.tag("li"),o=b.tag("br",{close:!1}),p=b.tag("i"),q=b.tag("img");return a.make({runtime:h,on:{start:function(a){this.set("loggedin",h.service("session").isLoggedIn()),h.service("userprofile").onChange(function(a){this.set("userProfile",a)}.bind(this))},render:function(){return{content:j({"class":"kb-widget-login"},[l({id:"signin-button",dataElement:"signin-button"},[g(this)])])}}}})}return{make:function(a){return d(a)}}});