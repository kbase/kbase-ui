define(["bluebird","kb/common/html","kb_plugin_mainWindow","kb/widget/widgetMount"],function(a,b,c,d){"use strict";function e(b){function c(c){return a["try"](function(){g=d.make({runtime:b.runtime,node:c})})}function e(a){b.runtime.recv("app","route-widget",function(a){a.routeHandler.route.widget?g.unmount().then(function(){return h.sendp("ui","clearButtons")}).then(function(){return g.mount(a.routeHandler.route.widget,a.routeHandler.params)})["catch"](function(a){console.log("ERROR mounting widget"),console.log(a),g.unmount().then(function(){return g.mountWidget("error",{title:"ERROR",error:a})})["catch"](function(b){console.log("ERROR mounting error widget!"),console.log(b),console.log(a)})}):console.warn("No widget in route")})}function f(){}var g,h=b.runtime;return{attach:c,start:e,detach:f}}return{make:function(a){return e(a)}}});