define(["jquery","kb/common/html","kb/service/client/workspace","kb/widget/legacy/widget","kb_dataview_genomes_lineage"],function(a,b,c){"use strict";a.KBWidget({name:"KBaseGenomeWideTaxonomy",parent:"kbaseWidget",version:"1.0.0",options:{genomeID:null,workspaceID:null,genomeInfo:null},init:function(a){return this._super(a),this.render(),this},render:function(){var b=this,c=a('<div class="row">');b.$elem.append(c);var d=a('<div class="col-md-5">');c.append(d);var e=a('<div class="col-md-7">');c.append(e),d.KBaseGenomeLineage({genomeID:b.options.genomeID,workspaceID:b.options.workspaceID,genomeInfo:b.options.genomeInfo,runtime:b.runtime}),this.prepareTree({ws:b.options.workspaceID,id:b.options.genomeID},e)},prepareTree:function(b,d){var e={ref:b.ws+"/"+b.id},f=new c(this.runtime.getConfig("services.workspace.url"),{token:this.runtime.service("session").getAuthToken()});f.list_referencing_objects([e],function(c){var e,f=null,g=null;for(e in c[0]){var h=c[0][e],i=(h[7],h[6]),j=h[1],k=h[2].split("-")[0];if("KBaseTrees.Tree"===k){f=j,g=i;break}}var l=a("<button>").addClass("kb-primary-btn").append("Build Another Tree in a New Narrative"),m=a("<div>").append(a('<a href="#/narrativemanager/new?copydata='+b.ws+"/"+b.id+"&app=build_species_tree&appparam=1,param0,"+b.id+'" target="_blank">').append(l));if(f){var n=a("<div>");d.append(a("<table>").append(a("<tr>").append(a("<td>").append('<h4>Showing Phylogenetic Tree: <a href="#/dataview/'+g+"/"+f+'" target="_blank">'+f+"</a></h4>")).append(a("<td>").append(m)))),n.kbaseTree({treeID:f,workspaceID:g,genomeInfo:self.options.genomeInfo}),d.append(n)}else l.html("Launch a new Tree Building Narrative"),d.append("<b>There are no species trees created for this genome, but you can use the Narrative to build a new species tree of closely related genomes.</b>"),d.append("<br><br>"),d.append(m),d.append("<br><br>")},function(a){var b="<b>Sorry!</b>  Error retreiveing species trees info";"string"==typeof a?b+=": "+a:a.error&&a.error.message&&(b+=": "+a.error.message),d.append(b)})},getData:function(){return{type:"Genome Taxonomy",id:this.options.genomeID,workspace:this.options.workspaceID,title:"Taxonomy"}}})});