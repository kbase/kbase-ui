define(["jquery","kb/common/html","kb/service/client/workspace","datatables_bootstrap","kb/widget/legacy/authenticatedWidget"],function(a,b,c){"use strict";a.KBWidget({name:"KBaseGenomeGeneTable",parent:"kbaseAuthenticatedWidget",version:"1.0.0",genome_id:null,ws_name:null,kbCache:null,width:1150,options:{genome_id:null,ws_name:null,ver:null,genomeInfo:null},init:function(a){return this._super(a),this.ws_name=this.options.ws_name,this.genome_id=this.options.genome_id,this.render(),this},render:function(){var d=this,e=this.uuid(),f=this.$elem;f.append(b.loading("loading genes data..."));var g=String(this.options.ws_name)+"/"+String(this.options.genome_id),h=function(b,c){function d(){f.empty(),f.append(a("<div />").css("overflow","auto").append('<table cellpadding="0" cellspacing="0" border="0" id="'+e+'genes-table" class="table table-bordered table-striped" style="width: 100%; margin-left: 0px; margin-right: 0px;"/>'));var c=[],d={},h={};if(b.contig_ids&&b.contig_lengths&&b.contig_ids.length===b.contig_lengths.length)for(var i in b.contig_ids){var j=b.contig_ids[i],k=b.contig_lengths[i];h[j]={name:j,length:k,genes:[]}}for(var l in b.features){var m=b.features[l],n=m.id,o=null,p=null,q=null,r=null;m.location&&m.location.length>0&&(o=m.location[0][0],p=m.location[0][1],q=m.location[0][2],r=m.location[0][3]);var s=m.type,t=m["function"];t||(t="-"),c.push({id:'<a href="#dataview/'+g+"?sub=Feature&subid="+n+'" target="_blank">'+n+"</a>",contig:o,start:p,dir:q,len:r,type:s,func:t}),d[n]=m;var u=h[o];if(null===o||u||(u={name:o,length:0,genes:[]},h[o]=u),u){var v=Number(p);"+"===q&&(v+=Number(r)),u.length<v&&(u.length=v),u.genes.push(m)}}var w={sPaginationType:"full_numbers",iDisplayLength:10,aaSorting:[[1,"asc"],[2,"asc"]],sDom:"t<fip>",aoColumns:[{sTitle:"Gene ID",mData:"id"},{sTitle:"Contig",mData:"contig"},{sTitle:"Start",mData:"start",sWidth:"7%"},{sTitle:"Strand",mData:"dir",sWidth:"7%"},{sTitle:"Length",mData:"len",sWidth:"7%"},{sTitle:"Type",mData:"type",sWidth:"10%"},{sTitle:"Function",mData:"func",sWidth:"45%"}],aaData:c,oLanguage:{sSearch:"&nbsp&nbspSearch genes:",sEmptyTable:"No genes found."}};a("#"+e+"genes-table").dataTable(w)}if(b.features.length>35e3){f.empty();var h="btn_show_genes"+e;f.append("There are many features in this genome, so displaying the full, sortable gene list may cause your web browser to run out of memory and become temporarily unresponsive.  Click below to attempt to show the gene list anyway.<br><button id='"+h+"' class='btn btn-primary'>Show Gene List</button>"),a("#"+h).click(function(a){d()})}else d()};if(d.options.genomeInfo)h(d.options.genomeInfo.data);else{var i={ref:g},j=new c(d.runtime.getConfig("services.workspace.url",{token:d.runtime.service("session").getAuthToken()}));j.get_objects([i]).then(function(a){h(a[0])})["catch"](function(a){f.empty(),f.append("<p>[Error] "+a.error.message+"</p>")})}return this},getData:function(){return{type:"KBaseGenomeGeneTable",id:this.options.ws_name+"."+this.options.genome_id,workspace:this.options.ws_name,title:"Gene list"}},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}})});