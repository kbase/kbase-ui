define(["jquery","kb/common/html","kb/service/client/workspace","kb/service/client/fba","kb/service/workspaceClient","kb/widget/legacy/widget","kb/widget/legacy/tabs","datatables_bootstrap"],function(a,b,c,d,e){"use strict";a.KBWidget({name:"kbasePhenotypeSet",parent:"kbaseWidget",version:"1.0.0",options:{color:"black"},init:function(f){function g(c,e){function f(){j.find(".btn-show-media-tab").unbind("click"),j.find(".btn-show-media-tab").click(function(){var b=a(this).data("ref"),c=a("<div>").loading();k.addTab({name:b,content:c,removable:!0}),g(c,b.split("/")[0],b.split("/")[1])})}function g(b,c,e){var f=new d(h.runtime.getConfig("services.fba.url"));f.get_media({medias:[e],workspaces:[c]}).then(function(d){a(b).rmLoading(),a(b).kbaseMediaEditor({ids:[e],workspaces:[c],data:d})})["catch"](function(c){a(b).rmLoading(),a(b).append('<div class="alert alert-danger">'+c.error.message+"</div>")})}var h=this,i=a('<table class="table table-bordered table-striped" style="width: 100%;">'),k=j.kbTabs({tabs:[{name:"Overview",active:!0},{name:"Phenotypes",content:i}]}),l=[{key:"wsid",label:"Name"},{key:"ws",label:"Workspace"},{key:"kbid",label:"KBID"},{key:"source",label:"Source"},{key:"genome",label:"Genome"},{key:"type",label:"Type"},{key:"errors",label:"Errors"},{key:"owner",label:"Owner"},{key:"date",label:"Creation Date"}],m=[{wsid:c[0].info[1],ws:c[0].info[7],kbid:c[0].data.id,source:c[0].data.source,genome:e[c[0].data.genome_ref].link,type:c[0].data.type,errors:c[0].data.importErrors,owner:c[0].creator,date:c[0].created}],n=b.makeRotatedTable(m,l);k.tabContent("Overview").append(n);var o=c[0].data,p={sPaginationType:"full_numbers",iDisplayLength:10,aaData:o.phenotypes,aaSorting:[[3,"desc"]],aoColumns:[{sTitle:"Name",mData:"name"},{sTitle:"Media",mData:function(a){return'<a data-ref="'+e[a.media_ref].label+'" class="btn-show-media-tab">'+e[a.media_ref].label+"</a>"}},{sTitle:"Gene KO",mData:function(a){return a.geneko_refs.join("<br>")}},{sTitle:"Additional compounds",mData:function(a){return a.additionalcompound_refs.join("<br>")}},{sTitle:"Growth",mData:"normalizedGrowth"}],oLanguage:{sEmptyTable:"No objects in workspace",sSearch:"Search: "},fnDrawCallback:f};i.dataTable(p)}this._super(f);var h=f.ws,i=f.name,j=this.$elem,k=this;j.loading();var l=new c(this.runtime.getConfig("services.workspace.url"),{token:this.runtime.service("session").getAuthToken()});return l.get_objects({workspace:h,name:i}).then(function(a){var b=a[0].refs;b.push(a[0].data.genome_ref);var c=Object.create(e).init({url:k.runtime.config("services.workspace.url"),authToken:k.runtime.service("session").getAuthToken()});c.translateRefs(b).then(function(b){j.rmLoading(),g(a,b)})["catch"](function(a){j.rmLoading(),j.append('<div class="alert alert-danger">'+a.error.message+"</div>")})})["catch"](function(a){j.rmLoading(),j.append('<div class="alert alert-danger">'+a.error.message+"</div>")}),this}})});