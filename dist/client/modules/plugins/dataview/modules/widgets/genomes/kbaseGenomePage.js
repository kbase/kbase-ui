define(["jquery","kb/common/html","kb/service/client/workspace","kb/widget/legacy/widget","kb_dataview_genomes_wideOverview","kb_dataview_genomes_literature","kb_dataview_genomes_wideTaxonomy","kb_dataview_genomes_wideAssemblyAnnotation"],function(a,b,c){"use strict";a.KBWidget({name:"KBaseGenomePage",parent:"kbaseWidget",version:"1.0.0",options:{genomeID:null,workspaceID:null,ver:null},init:function(a){return this._super(a),"CDS"===this.options.workspaceID&&(this.options.workspaceID="KBasePublicGenomesV4"),this.render(),this},render:function(){var b=this,d={ws:this.options.workspaceID,id:this.options.genomeID,ver:this.options.ver},e=new c(this.runtime.getConfig("services.workspace.url"),{token:this.runtime.service("session").getAuthToken()}),f=a('<div panel panel-default">');b.$elem.append(f);var g=b.makePleaseWaitPanel();b.makeDecoration(f,"Overview",g);var h=a('<div panel panel-default">');b.$elem.append(h);var i=b.makePleaseWaitPanel();b.makeDecoration(h,"Publications",i);var j=a('<div panel panel-default">');b.$elem.append(j);var k=(b.makePleaseWaitPanel(),a('<div panel panel-default">'));b.$elem.append(k);var l=b.makePleaseWaitPanel();b.makeDecoration(k,"Taxonomy",l);var m=a('<div panel panel-default">');b.$elem.append(m);var n=b.makePleaseWaitPanel();b.makeDecoration(m,"Assembly and Annotation",n);var o=d.ws+"/"+d.id;b.options.ver&&(o+="/"+b.options.ver);var p=["/complete","/contig_ids","/contig_lengths","contigset_ref","/dna_size","/domain","/gc_content","/genetic_code","/id","/md5","num_contigs","/scientific_name","/source","/source_id","/tax_id","/taxonomy"],q=function(a){g.empty();try{g.KBaseGenomeWideOverview({genomeID:d.id,workspaceID:d.ws,genomeInfo:a,runtime:b.runtime})}catch(c){console.error(c),b.showError(g,c.message)}var f="";a&&a.data.scientific_name&&(f=a.data.scientific_name),i.empty();try{i.KBaseLitWidget({literature:f,genomeInfo:a,runtime:b.runtime})}catch(c){console.error(c),b.showError(i,c.message)}l.empty();try{l.KBaseGenomeWideTaxonomy({genomeID:d.id,workspaceID:d.ws,genomeInfo:a,runtime:b.runtime})}catch(c){console.error(c),b.showError(l,c.message)}if(a&&"Eukaryota"===a.data.domain||a&&"Plant"===a.data.domain)m.empty();else{var h=p.concat(["/features/[*]/aliases","/features/[*]/annotations","/features/[*]/function","/features/[*]/id","/features/[*]/location","/features/[*]/protein_translation_length","/features/[*]/type"]);e.get_object_subset([{ref:o,included:h}],function(a){var c=a[0],f=function(){n.empty();try{n.KBaseGenomeWideAssemAnnot({genomeID:d.id,workspaceID:d.ws,ver:d.ver,genomeInfo:c,runtime:b.runtime})}catch(a){console.error(a),b.showError(n,a.message)}},g=c.data;if(g.contig_ids&&g.contig_lengths&&g.contig_ids.length===g.contig_lengths.length)f();else{var h=g.contigset_ref;e.get_object_subset([{ref:h,included:["contigs/[*]/id","contigs/[*]/length"]}],function(a){var b=a[0].data;g.contig_ids=[],g.contig_lengths=[];for(var c in b.contigs){var d=b.contigs[c].id;g.contig_ids.push(d);var e=b.contigs[c].length;g.contig_lengths.push(e)}f()},function(a){console.error("Error loading contigset subdata"),console.error(a),n.empty(),b.showError(n,a)})}},function(a){console.error("Error loading genome subdata"),console.error(a),n.empty(),b.showError(n,a)})}};e.get_object_subset([{ref:o,included:p}],function(a){var b=a[0];q(b)},function(a){console.error("Error loading genome subdata"),console.error(a),console.log(b.runtime.service("session").getAuthToken()),g.empty(),b.showError(g,a),h.empty(),j.empty(),k.empty(),m.empty()})},makePleaseWaitPanel:function(){return a("<div>").html(b.loading("loading..."))},makeDecoration:function(b,c,d){var e=this.genUUID();b.append(a('<div class="panel-group" id="accordion_'+e+'" role="tablist" aria-multiselectable="true">').append(a('<div class="panel panel-default kb-widget">').append('<div class="panel-heading" role="tab" id="heading_'+e+'"><h4 class="panel-title"><span data-toggle="collapse" data-parent="#accordion_'+e+'" data-target="#collapse_'+e+'" aria-expanded="false" aria-controls="collapse_'+e+'" style="cursor:pointer;"> '+c+"</span></h4></div>").append(a('<div id="collapse_'+e+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading_'+e+'" area-expanded="true">').append(a('<div class="panel-body">').append(d)))))},getData:function(){return{type:"Genome Page",id:this.options.genomeID,workspace:this.options.workspaceID,title:"Genome Page"}},showError:function(a,b){a.empty(),a.append("Error: "+JSON.stringify(b))},genUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}})});