define(["jquery","kb/common/html","kb/service/client/workspace","kb/widget/legacy/widget","kb_dataview_genomes_geneInstanceInfo","kb_dataview_genomes_geneBiochemistry","kb_dataview_genomes_geneSequence"],function(a,b,c){"use strict";a.KBWidget({name:"KBaseGenePage",parent:"kbaseWidget",version:"1.0.0",options:{featureID:null,genomeID:null,workspaceID:null},init:function(a){return this._super(a),"CDS"===this.options.workspaceID&&(this.options.workspaceID="KBasePublicGenomesV4"),this.workspace=new c(this.runtime.getConfig("services.workspace.url"),{token:this.runtime.service("session").getAuthToken()}),this.render(),this},render:function(){var b=this,c={ws:this.options.workspaceID,gid:this.options.genomeID,fid:this.options.featureID},d=a('<div panel panel-default">');b.$elem.append(d);var e=b.makePleaseWaitPanel();b.makeDecoration(d,"Feature Overview",e);var f=a('<div panel panel-default">');b.$elem.append(f);var g=b.makePleaseWaitPanel();b.makeDecoration(f,"Biochemistry",g);var h=a('<div panel panel-default">');b.$elem.append(h);var i=b.makePleaseWaitPanel();b.makeDecoration(h,"Sequence",i);var j=c.ws+"/"+c.gid,k=["/complete","/contig_ids","/contig_lengths","contigset_ref","/dna_size","/domain","/gc_content","/genetic_code","/id","/md5","num_contigs","/scientific_name","/source","/source_id","/tax_id","/taxonomy","/features/[*]/id"],l=function(a){e.empty();try{e.KBaseGeneInstanceInfo({featureID:c.fid,genomeID:c.gid,workspaceID:c.ws,hideButtons:!0,genomeInfo:a,runtime:b.runtime})}catch(d){console.error(d),b.showError(e,d.message)}var f="";a&&a.data.scientific_name&&(f=a.data.scientific_name),g.empty();try{g.KBaseGeneBiochemistry({featureID:c.fid,genomeID:c.gid,workspaceID:c.ws,genomeInfo:a,runtime:b.runtime})}catch(d){console.error(d),b.showError(g,d.message)}i.empty(),i.KBaseGeneSequence({featureID:c.fid,genomeID:c.gid,workspaceID:c.ws,genomeInfo:a,runtime:b.runtime})};b.workspace.get_object_subset([{ref:j,included:k}],function(a){var d=a[0],g=null;for(var i in d.data.features){var k=d.data.features[i].id;if(k&&k===c.fid){g=i;break}}g?b.workspace.get_object_subset([{ref:j,included:["/features/"+g]}],function(a){var b=a[0].data;d.data.features[g]=b.features[0],l(d)},function(a){console.error("Error loading genome subdata"),console.error(a),e.empty(),b.showError(e,a),f.empty(),h.empty()}):(e.empty(),b.showError(e,"Feature "+c.fid+" is not found in genome"),f.empty(),h.empty())},function(a){console.error("Error loading genome subdata"),console.error(a),e.empty(),b.showError(e,a),f.empty(),h.empty()})},makePleaseWaitPanel:function(){return a("<div>").html(b.loading("loading..."))},makeDecoration:function(b,c,d){var e=this.genUUID();b.append(a('<div class="panel-group" id="accordion_'+e+'" role="tablist" aria-multiselectable="true">').append(a('<div class="panel panel-default kb-widget">').append('<div class="panel-heading" role="tab" id="heading_'+e+'"><h4 class="panel-title"><span data-toggle="collapse" data-parent="#accordion_'+e+'" data-target="#collapse_'+e+'" aria-expanded="false" aria-controls="collapse_'+e+'" style="cursor:pointer;"> '+c+"</span></h4></div>").append(a('<div id="collapse_'+e+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading_'+e+'" area-expanded="true">').append(a('<div class="panel-body">').append(d)))))},getData:function(){return{type:"Gene Page",id:this.options.genomeID+"/"+this.options.featureID,workspace:this.options.workspaceID,title:"Gene Page"}},showError:function(a,b){a.empty(),a.append("Error: "+JSON.stringify(b))},genUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}})});