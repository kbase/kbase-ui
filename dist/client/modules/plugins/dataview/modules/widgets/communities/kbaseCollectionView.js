define(["jquery","kb/service/client/workspace","kb/common/html","datatables_bootstrap","kb/widget/legacy/authenticatedWidget"],function(a,b,c){"use strict";a.KBWidget({name:"CollectionView",parent:"kbaseAuthenticatedWidget",version:"1.0.0",options:{id:null,ws:null},init:function(b){var d=c.tag("div"),e=c.genId(),f=c.genId();return this._super(b),this.$elem.html(c.makePanel({title:d({id:e}),content:d({id:f})})),this.$title=a("#"+e),this.$body=a("#"+f),this},showError:function(a){var b;try{b="string"==typeof a?a:a.error?a.error.message:a.message?a.message:"Unknown error: "+a}catch(c){b="Unknown error processing another error: "+c}this.$title.html("Error"),this.$body.html(b)},render:function(){var d=this;if(!this.runtime.service("session").getAuthToken())return void this.showError("You are not logged in");this.$title.html("Metagenome Collection"),this.$body.html(c.loading("loading data..."));var e,f=new b(this.runtime.config("services.workspace.url"),{token:this.token});return f.get_objects([{ref:d.options.ws+"/"+d.options.id}]).then(function(a){if(0===a.length)throw new Error("Object "+d.options.id+" does not exist in workspace "+d.options.ws);var b=a[0].data,c=b.members.map(function(a){if(a.URL.match(/^http/))throw console.log("ERROR"),console.log(a),new Error("Invalid Collection Object");return{ref:a.URL}});if(e=b.name,c.length>0)return f.get_objects(c);throw new Error("Collection is empty")}).then(function(b){var f=b.map(function(a){return[a.data.id,a.data.name,a.data.mixs.project_name,a.data.mixs.PI_lastname,a.data.mixs.biome,a.data.mixs.sequence_type,a.data.mixs.seq_method,a.data.statistics.sequence_stats.bp_count_raw,a.data.created]}),g={columns:["ID","Name","Project","PI","Biome","Sequence Type","Sequencing Method","bp Count","Created"],rows:f,classes:["table","table-striped"]},h=c.makeTable(g);d.$title.html("Metagenome Collection "+e),d.$body.html(h),a("#"+g.generated.id).dataTable()})["catch"](function(a){d.showError(a)}),d},loggedInCallback:function(a,b){return this.token=b.token,this.render(),this},loggedOutCallback:function(a,b){return this.token=null,this.render(),this}})});