!function(a){function b(a){this._wrapper=a,this._drawNow=!1,this._title={value:"",offset:25,settings:{textAnchor:"middle"}},this._area=[.1,.1,.8,.9],this._areaFormat={fill:"none",stroke:"black"},this._gridlines=[],this._equalXY=!0,this._functions=[],this._onstatus=null,this._uuid=(new Date).getTime(),this._plotCont=this._wrapper.svg(0,0,0,0,{class_:"svg-plot"}),this.xAxis=new e(this),this.xAxis.title("X",20),this.yAxis=new e(this),this.yAxis.title("Y",20),this.legend=new f(this),this._drawNow=!0}function c(a,b,c,e,f,h,i,j){"string"!=typeof b&&(j=i,i=h,h=f,f=e,e=c,c=b,b=null),g(e)||(j=i,i=h,h=f,f=e,e=null),"number"!=typeof f&&(j=i,i=h,h=f,f=null),"string"!=typeof h&&(j=i,i=h,h=null),"number"!=typeof i&&(j=i,i=null),this._plot=a,this._name=b||"",this._fn=c||d,this._range=e,this._points=f||100,this._stroke=h||"black",this._strokeWidth=i||1,this._settings=j||{}}function d(a){return a}function e(a,b,c,d,e,f){this._plot=a,this._title=b||"",this._titleFormat={},this._titleOffset=0,this._labelFormat={},this._lineFormat={stroke:"black",strokeWidth:1},this._ticks={major:e||10,minor:f||0,size:10,position:"both"},this._scale={min:c||0,max:d||100},this._crossAt=0}function f(a,b,c){this._plot=a,this._show=!0,this._area=[.9,.1,1,.9],this._sampleSize=15,this._bgSettings=b||{stroke:"gray"},this._textSettings=c||{}}function g(a){return a&&a.constructor==Array}a.svg.addExtension("plot",b),a.extend(b.prototype,{X:0,Y:1,W:2,H:3,L:0,T:1,R:2,B:3,container:function(a){return 0==arguments.length?this._plotCont:(this._plotCont=a,this)},area:function(a,b,c,d){return 0==arguments.length?this._area:(this._area=g(a)?a:[a,b,c,d],this._drawPlot(),this)},format:function(b,c,d){return 0==arguments.length?this._areaFormat:("object"==typeof c&&(d=c,c=null),this._areaFormat=a.extend({fill:b},c?{stroke:c}:{},d||{}),this._drawPlot(),this)},gridlines:function(a,b){return 0==arguments.length?this._gridlines:(this._gridlines=["string"==typeof a?{stroke:a}:a,"string"==typeof b?{stroke:b}:b],null==this._gridlines[0]&&null==this._gridlines[1]&&(this._gridlines=[]),this._drawPlot(),this)},equalXY:function(a){return 0==arguments.length?this._equalXY:(this._equalXY=a,this)},title:function(b,c,d,e){return 0==arguments.length?this._title:("number"!=typeof c&&(e=d,d=c,c=null),"string"!=typeof d&&(e=d,d=null),this._title={value:b,offset:c||this._title.offset,settings:a.extend({textAnchor:"middle"},d?{fill:d}:{},e||{})},this._drawPlot(),this)},addFunction:function(a,b,d,e,f,g,h){return this._functions.push(new c(this,a,b,d,e,f,g,h)),this._drawPlot(),this},functions:function(a){return(arguments.length>0?this._functions[a]:null)||this._functions},noDraw:function(){return this._drawNow=!1,this},redraw:function(){return this._drawNow=!0,this._drawPlot(),this},status:function(a){return this._onstatus=a,this},_drawPlot:function(){if(this._drawNow){for(;this._plotCont.firstChild;)this._plotCont.removeChild(this._plotCont.firstChild);this._plotCont.parent||this._wrapper._svg.appendChild(this._plotCont),this._plotCont.width?this._plotCont.width.baseVal?this._plotCont.width.baseVal.value=this._plotCont.width.baseVal.value||this._wrapper._width():this._plotCont.width=this._plotCont.width||this._wrapper._width():this._plotCont.setAttribute("width",parseInt(this._plotCont.getAttribute("width"),10)||this._wrapper._width()),this._plotCont.height?this._plotCont.height.baseVal?this._plotCont.height.baseVal.value=this._plotCont.height.baseVal.value||this._wrapper._height():this._plotCont.height=this._plotCont.height||this._wrapper._height():this._plotCont.setAttribute("height",parseInt(this._plotCont.getAttribute("height"),10)||this._wrapper._height()),this._drawChartBackground();var a=this._getDims(),b=this._wrapper.other(this._plotCont,"clipPath",{id:"clip"+this._uuid});this._wrapper.rect(b,a[this.X],a[this.Y],a[this.W],a[this.H]),this._plot=this._wrapper.group(this._plotCont,{class_:"foreground",clipPath:"url(#clip"+this._uuid+")"}),this._drawAxis(!0),this._drawAxis(!1);for(var c=0;c<this._functions.length;c++)this._plotFunction(this._functions[c],c);this._drawTitle(),this._drawLegend()}},_getValue:function(a,b){return a[b]?a[b].baseVal?a[b].baseVal.value:a[b]:parseInt(a.getAttribute(b),10)},_getDims:function(a){var b=null!=a;a=a||this._area;var c=this._getValue(this._plotCont,"width"),d=this._getValue(this._plotCont,"height"),e=a[this.L]>1?a[this.L]:c*a[this.L],f=a[this.T]>1?a[this.T]:d*a[this.T],g=(a[this.R]>1?a[this.R]:c*a[this.R])-e,h=(a[this.B]>1?a[this.B]:d*a[this.B])-f;if(this._equalXY&&!b){var i=Math.min(g/(this.xAxis._scale.max-this.xAxis._scale.min),h/(this.yAxis._scale.max-this.yAxis._scale.min));g=i*(this.xAxis._scale.max-this.xAxis._scale.min),h=i*(this.yAxis._scale.max-this.yAxis._scale.min)}return[e,f,g,h]},_getScales:function(){var a=this._getDims();return[a[this.W]/(this.xAxis._scale.max-this.xAxis._scale.min),a[this.H]/(this.yAxis._scale.max-this.yAxis._scale.min)]},_drawChartBackground:function(a,b){var c=this._wrapper.group(this._plotCont,{class_:"background"}),d=this._getDims();return this._wrapper.rect(c,d[this.X],d[this.Y],d[this.W],d[this.H],this._areaFormat),this._gridlines[0]&&this.yAxis._ticks.major&&!b&&this._drawGridlines(c,!0,this._gridlines[0],d),this._gridlines[1]&&this.xAxis._ticks.major&&!a&&this._drawGridlines(c,!1,this._gridlines[1],d),c},_drawGridlines:function(a,b,c,d){var e=this._wrapper.group(a,c),f=b?this.yAxis:this.xAxis,g=this._getScales(),h=Math.floor(f._scale.min/f._ticks.major)*f._ticks.major;for(h+=h<=f._scale.min?f._ticks.major:0;h<f._scale.max;){var i=(b?f._scale.max-h:h-f._scale.min)*g[b?1:0]+(b?d[this.Y]:d[this.X]);this._wrapper.line(e,b?d[this.X]:i,b?i:d[this.Y],b?d[this.X]+d[this.W]:i,b?i:d[this.Y]+d[this.H]),h+=f._ticks.major}},_drawAxis:function(b){var c=(b?"x":"y")+"Axis",d=b?this.xAxis:this.yAxis,e=b?this.yAxis:this.xAxis,f=this._getDims(),g=this._getScales(),h=this._wrapper.group(this._plot,a.extend({class_:c},d._lineFormat)),i=this._wrapper.group(this._plot,a.extend({class_:c+"Labels",textAnchor:b?"middle":"end"},d._labelFormat)),j=(b?e._scale.max:-e._scale.min)*g[b?1:0]+(b?f[this.Y]:f[this.X]);if(this._wrapper.line(h,b?f[this.X]:j,b?j:f[this.Y],b?f[this.X]+f[this.W]:j,b?j:f[this.Y]+f[this.H]),d._ticks.major){var k=d._ticks.size,l=Math.floor(d._scale.min/d._ticks.major)*d._ticks.major;l=l<d._scale.min?l+d._ticks.major:l;var m=d._ticks.minor?Math.floor(d._scale.min/d._ticks.minor)*d._ticks.minor:d._scale.max+1;m=m<d._scale.min?m+d._ticks.minor:m;for(var n=["nw"==d._ticks.position||"both"==d._ticks.position?-1:0,"se"==d._ticks.position||"both"==d._ticks.position?1:0];l<=d._scale.max||m<=d._scale.max;){var o=Math.min(l,m),p=o==l?k:k/2,q=(b?o-d._scale.min:d._scale.max-o)*g[b?0:1]+(b?f[this.X]:f[this.Y]);this._wrapper.line(h,b?q:j+p*n[0],b?j+p*n[0]:q,b?q:j+p*n[1],b?j+p*n[1]:q),o==l&&0!=o&&this._wrapper.text(i,b?q:j-k,b?j-k:q,""+o),l+=o==l?d._ticks.major:0,m+=o==m?d._ticks.minor:0}}d._title&&(b?this._wrapper.text(this._plotCont,f[this.X]-d._titleOffset,j,d._title,a.extend({textAnchor:"end"},d._titleFormat||{})):this._wrapper.text(this._plotCont,j,f[this.Y]+f[this.H]+d._titleOffset,d._title,a.extend({textAnchor:"middle"},d._titleFormat||{})))},_plotFunction:function(b,c){for(var d=this._getDims(),e=this._getScales(),f=this._wrapper.createPath(),g=b._range||[this.xAxis._scale.min,this.xAxis._scale.max],h=(g[1]-g[0])/b._points,i=!0,j=0;j<=b._points;j++){var k=g[0]+j*h;if(k>this.xAxis._scale.max+h)break;if(!(k<this.xAxis._scale.min-h)){var l=(k-this.xAxis._scale.min)*e[0]+d[this.X],m=d[this.H]-(b._fn(k)-this.yAxis._scale.min)*e[1]+d[this.Y];f[(i?"move":"line")+"To"](l,m),i=!1}}var n=this._wrapper.path(this._plot,f,a.extend({class_:"fn"+c,fill:"none",stroke:b._stroke,strokeWidth:b._strokeWidth},b._settings||{}));this._showStatus(n,b._name)},_drawTitle:function(){this._wrapper.text(this._plotCont,this._getValue(this._plotCont,"width")/2,this._title.offset,this._title.value,this._title.settings)},_drawLegend:function(){if(this.legend._show){var a=this._wrapper.group(this._plotCont,{class_:"legend"}),b=this._getDims(this.legend._area);this._wrapper.rect(a,b[this.X],b[this.Y],b[this.W],b[this.H],this.legend._bgSettings);for(var c=b[this.W]>b[this.H],d=this._functions.length,e=(c?b[this.W]:b[this.H])/d,f=b[this.X]+5,g=b[this.Y]+((c?b[this.H]:e)+this.legend._sampleSize)/2,h=0;d>h;h++){var i=this._functions[h];this._wrapper.rect(a,f+(c?h*e:0),g+(c?0:h*e)-this.legend._sampleSize,this.legend._sampleSize,this.legend._sampleSize,{fill:i._stroke}),this._wrapper.text(a,f+(c?h*e:0)+this.legend._sampleSize+5,g+(c?0:h*e),i._name,this.legend._textSettings)}}},_showStatus:function(b,c){var d=this._onstatus;this._onstatus&&a(b).hover(function(a){d.apply(this,[c])},function(){d.apply(this,[""])})}}),a.extend(c.prototype,{name:function(a){return 0==arguments.length?this._name:(this._name=a,this._plot._drawPlot(),this)},fn:function(a,b){return 0==arguments.length?this._fn:("function"==typeof a&&(b=a,a=null),this._name=a||this._name,this._fn=b,this._plot._drawPlot(),this)},range:function(a,b){return 0==arguments.length?this._range:(this._range=null==a?null:[a,b],this._plot._drawPlot(),this)},points:function(a){return 0==arguments.length?this._points:(this._points=a,this._plot._drawPlot(),this)},format:function(b,c,d){return 0==arguments.length?a.extend({stroke:this._stroke,strokeWidth:this._strokeWidth},this._settings):("number"!=typeof c&&(d=c,c=null),this._stroke=b||this._stroke,this._strokeWidth=c||this._strokeWidth,a.extend(this._settings,d||{}),this._plot._drawPlot(),this)},end:function(){return this._plot}}),a.extend(e.prototype,{scale:function(a,b){return 0==arguments.length?this._scale:(this._scale.min=a,this._scale.max=b,this._plot._drawPlot(),this)},ticks:function(a,b,c,d){return 0==arguments.length?this._ticks:("string"==typeof c&&(d=c,c=null),this._ticks.major=a,this._ticks.minor=b,this._ticks.size=c||this._ticks.size,this._ticks.position=d||this._ticks.position,this._plot._drawPlot(),this)},title:function(b,c,d,e){return 0==arguments.length?{title:this._title,offset:this._titleOffset,format:this._titleFormat}:("number"!=typeof c&&(e=d,d=c,c=null),"string"!=typeof d&&(e=d,d=null),this._title=b,this._titleOffset=null!=c?c:this._titleOffset,(d||e)&&(this._titleFormat=a.extend(e||{},d?{fill:d}:{})),this._plot._drawPlot(),this)},format:function(b,c){return 0==arguments.length?this._labelFormat:("string"!=typeof b&&(c=b,b=null),this._labelFormat=a.extend(c||{},b?{fill:b}:{}),this._plot._drawPlot(),this)},line:function(b,c,d){return 0==arguments.length?this._lineFormat:("number"!=typeof c&&(d=c,c=null),a.extend(this._lineFormat,{stroke:b,strokeWidth:c||this._lineFormat.strokeWidth},d||{}),this._plot._drawPlot(),this)},end:function(){return this._plot}}),a.extend(f.prototype,{show:function(a){return 0==arguments.length?this._show:(this._show=a,this._plot._drawPlot(),this)},area:function(a,b,c,d){return 0==arguments.length?this._area:(this._area=g(a)?a:[a,b,c,d],this._plot._drawPlot(),this)},settings:function(a,b,c){return 0==arguments.length?{sampleSize:this._sampleSize,bgSettings:this._bgSettings,textSettings:this._textSettings}:("object"==typeof a&&(c=b,b=a,a=null),this._sampleSize=a||this._sampleSize,this._bgSettings=b,this._textSettings=c||this._textSettings,this._plot._drawPlot(),this)},end:function(){return this._plot}})}(jQuery);