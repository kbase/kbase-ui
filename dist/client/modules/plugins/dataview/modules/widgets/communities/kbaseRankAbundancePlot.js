!function(a,b){a.KBWidget({name:"RankAbundancePlot",version:"1.0.0",options:{id:null,ws:null,auth:null,name:0,top:"10",order:"average"},ws_url:window.kbconfig.urls.workspace,loading_image:"assets/img/ajax-loader.gif",init:function(a){return this._super(a),this.render()},render:function(){var b=this,c=(this.uuidv4(),this.$elem),d=new Workspace(b.ws_url,{token:b.options.auth});return c.empty(),c.append('<div><img src="'+b.loading_image+'">&nbsp;&nbsp;loading data...</div>'),d.get_objects([{ref:b.options.ws+"/"+b.options.id}],function(a){if(c.empty(),0==a.length){var d="[Error] Object "+b.options.id+" does not exist in workspace "+b.options.ws;c.append("<div><p>"+d+">/p></div>")}else{var e=a[0].data,f=[],g=e.columns.length,h=e.rows.length,i=new Array(h);f="sparse"==e.matrix_type?b.sparse2dense(e.data,e.shape[0],e.shape[1]):e.data;for(var j=0;h>j;j++){for(var k=[e.rows[j].id,0,0,0],l=0;g>l;l++)k[1]+=f[j][l],k.push(f[j][l]);k[2]=k[1]/g,k[3]=Math.max.apply(null,f[j]),i[j]=k}for(var m=new Array(10),l=0;10>l;l++)m[l]=i[l];if("sum"==b.options.order)i.sort(function(a,b){return b[1]-a[1]});else if("average"==b.options.order)i.sort(function(a,b){return b[2]-a[2]});else if("max"==b.options.order)i.sort(function(a,b){return b[3]-a[3]});else{var n=4;isPositiveInteger(b.options.order)&&(n=parseInt(b.options.order,10)+3),n-1>i.length&&(n=4),i.sort(function(a,b){return b[n]-a[n]})}for(var o=parseInt(b.options.top,10),p=GooglePalette(g),q=new Array(g),r=new Array(o),s=0;g>s;s++)0==b.options.name?q[s]={name:e.columns[s].id,data:[],fill:p[s]}:q[s]={name:e.columns[s].name,data:[],fill:p[s]};for(var j=0;o>j;j++){r[j]=i[j][0];for(var s=0;g>s;s++)q[s].data.push(i[j][s+4])}var t=0;window.hasOwnProperty("rendererGraph")&&rendererGraph.length&&(t=rendererGraph.length),c.append("<div id='outputGraph"+t+"' style='width: 95%;'></div>");var u=standaloneGraph.create({index:t});u.settings.target=document.getElementById("outputGraph"+t),u.settings.data=q,u.settings.show_legend=!0,u.settings.x_labels=r,u.settings.x_labels_rotation="340",u.settings.height=500,u.settings.type="column",u.render(t)}},function(b){c.empty();var d=a("<div>");d.append(a("<p>").css({padding:"10px 20px"}).text("[Error] "+b.error.message)),c.append(d)}),b},sparse2dense:function(a,b,c){for(var d=new Array(b),e=0;b>e;e++)d[e]=Array.apply(null,new Array(c)).map(Number.prototype.valueOf,0);for(var e=0;e<a.length;e++)d[a[e][0]][a[e][1]]=a[e][2];return d},isPositiveInteger:function(a){return/^[1-9]\d*$/.test(a)},uuidv4:function(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b}})}(jQuery);