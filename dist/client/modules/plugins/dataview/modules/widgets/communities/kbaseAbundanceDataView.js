define(["jquery","kb/service/client/workspace","kb/common/html","kb_dataview_communities_graph","datatables_bootstrap","kb/widget/legacy/authenticatedWidget"],function(a,b,c,d){"use strict";a.KBWidget({name:"AbundanceDataView",parent:"kbaseAuthenticatedWidget",version:"1.0.0",token:null,options:{id:null,ws:null,name:0},init:function(a){return this._super(a),this},render:function(){var e=this,f=(this.uuidv4(),this.$elem);if(f.empty(),null===e.token)return void f.append("<div>[Error] You're not logged in</div>");f.append(c.loading("loading data..."));var g=new b(this.runtime.getConfig("services.workspace.url"),{token:e.token});return g.get_objects([{ref:e.options.ws+"/"+e.options.id}],function(b){if(f.empty(),0===b.length){var g="[Error] Object "+e.options.id+" does not exist in workspace "+e.options.ws;f.append("<div><p>"+g+">/p></div>")}else{var h=b[0].data,i=[],j=h.columns.length,k=h.rows.length,l=[];i="sparse"===h.matrix_type?e.sparse2dense(h.data,h.shape[0],h.shape[1]):h.data;for(var m=new Array(j),n=[],o=0;j>o;o+=1)n[o]="#678C30";var p=j+1,q=new Array(p);q[0]="Annotation";for(var r=0;j>r;r++)0===e.options.name?(q[r+1]=h.columns[r].id,m[r]={name:h.columns[r].id,data:[],fill:n[r]}):(q[r+1]=h.columns[r].name,m[r]={name:h.columns[r].name,data:[],fill:n[r]});for(var s=0,l=new Array(k),t=0;k>t;t++){l[t]=new Array(p),l[t][0]=h.rows[t].id;for(var r=0;j>r;r++){s=Math.max(s,i[t][r]),m[r].data.push(i[t][r]);var u=Math.round(1e3*i[t][r])/1e3;u||(u="0"),l[t][r+1]=u}}var v=c.genId(),w=(c.genId(),a('<a href="#outputGraph'+v+'">BoxPlots</a>').click(function(b){b.preventDefault(),a(this).tab("show")})),x=a('<a href="#outputTable'+v+'">Abundance Table</a>').click(function(b){b.preventDefault(),a(this).tab("show")}),y=a("<ul>").addClass("nav nav-tabs").append(a("<li>").addClass("active").append(w)).append(a("<li>").append(x)),z="<div class='tab-content'><div class='tab-pane active' id='outputGraph"+v+"' style='width: 95%;'></div><div class='tab-pane' id='outputTable"+v+"' style='width: 95%;'></div></div>";f.append(y).append(z);var A=c.makeTable({columns:q,rows:l,classes:["table","table-striped"]});document.getElementById("outputTable"+v).innerHTML=A,a("#outputTable"+v+">table").dataTable();var B="normalized";s>1&&(B="raw");var C=d.create({target:document.getElementById("outputGraph"+v),data:m,y_title:B+" abundance",show_legend:!1,height:400,chartArea:[.1,.1,.95,.8],type:"deviation"});C.render()}},function(b){f.empty();var c=a("<div>");c.append(a("<p>").css({padding:"10px 20px"}).text("[Error] "+b.error.message)),f.append(c)}),e},loggedInCallback:function(a,b){return this.token=b.token,this.render(),this},loggedOutCallback:function(a,b){return this.token=null,this.render(),this},sparse2dense:function(a,b,c){for(var d=new Array(b),e=0;b>e;e++)d[e]=Array.apply(null,new Array(c)).map(Number.prototype.valueOf,0);for(var e=0;e<a.length;e++)d[a[e][0]][a[e][1]]=a[e][2];return d},uuidv4:function(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b}})});