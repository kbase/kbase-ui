define(["kb_dataview_knhx","kb_dataview_canvastext"],function(a,b){"use strict";function c(c,d,e,f,g){function h(c,d,e){a.kn_plot_core(c,d,e);var f="Change layout",g=c.getContext("2d");b.enable(g),g.strokeStyle=e.c_ext,g.fillStyle="rgb(180, 245, 220)";var h=g.measureText(e.font,e.fontsize,f),i=e.width-80,j=1,k=1.5*e.fontsize+1;g.fillRect(i,j,h,k),g.drawText(e.font,e.fontsize,i,j+.8*e.fontsize+e.fontsize/3,f),t=i,u=j,v=h,w=k}function i(b){q.is_circular=b,q.height=q.is_circular?q.width:2*q.ymargin+k.n_tips*q.yskip,r.height=q.height,a.kn_count_tips(k),q.is_real=a.kn_calxy(k,q.is_real),h(r,k,q)}function j(b){if(b.layerX||0===b.layerX?(b._x=b.layerX,b._y=b.layerY):(b.offsetX||0===b.offsetX)&&(b._x=b.offsetX,b._y=b.offsetY),"Microsoft Internet Explorer"===navigator.appName){var c=document.body,d=document.getElementById("canvasContainer");b._x=b.clientX-(d.offsetLeft-c.scrollLeft)-3,b._y=b.clientY-(d.offsetTop-c.scrollTop)-3}if(k){var e=a.kn_get_node(k,q,b._x,b._y);if(e>=0&&e<k.node.length){var g=k,j=q,l=e;if(l<g.node.length&&g.node[l].child.length){if(!g.node[l].parent)return;g.node[l].hidden=!g.node[l].hidden;g.node.length;g.node=kn_expand_node(g.node[g.node.length-1]),kn_count_tips(g),j.is_real=a.kn_calxy(g,j.is_real),k=g,q=j,h(r,g,j)}else f&&f(k.node[e],e)}else{var m=b._x,n=b._y;m>=t&&t+v>m&&n>=u&&u+w>n&&i(!q.is_circular)}}}var k=a.kn_parse(d);if(e){var l,m,n;for(l in k.node)k.node.hasOwnProperty(l)&&(m=k.node[l].name,n=e[m],n&&(k.node[l].id=m,k.node[l].name=n))}if(g){var l;for(l in k.node)if(k.node.hasOwnProperty(l)){var o=k.node[l],p=g(o,l);p&&(o.hl=p)}}var q={},r=document.getElementById(c),s=q;s.c_box=[],s.width=1e3,s.height=600,s.xmargin=20,s.ymargin=20,s.fontsize=8,s.c_ext="rgb(0,0,0)",s.c_int="rgb(255,0,0)",s.c_line="#444",s.c_node="#666",s.c_active_node="rgb(255,128,0)",s.c_hl="rgb(180, 210, 255)",s.c_hidden="rgb(0,200,0)",s.c_regex="rgb(0,128,0)",s.regex=":B=([^:\\]]+)",s.xskip=3,s.yskip=14,s.box_width=6,s.old_nh=null,s.is_real=!0,s.is_circular=!1,s.show_dup=!0,s.runtime=0;var t=0,u=0,v=0,w=0,x=k;if(x.error)1&x.error?window.alert("Parsing ERROR: missing left parenthesis!"):2&x.error?window.alert("Parsing ERROR: missing right parenthesis!"):4&x.error?window.alert("Parsing ERROR: missing brackets!"):window.alert("Unknown parsing ERROR: "+x.error);else{s.is_real=a.kn_calxy(x,s.is_real),s.height=s.is_circular?s.width:2*s.ymargin+x.n_tips*s.yskip,r.width=s.width,r.height=s.height,h(r,x,s);var y=document.createElement("div");y.setAttribute("id","canvasContainer"),y.setAttribute("style","position: relative;");var z=r.parentNode||r.parent;z.removeChild(r),z.appendChild(y),y.appendChild(r),r.addEventListener?r.addEventListener("click",j,!1):r.attachEvent("onclick",j)}}return c});