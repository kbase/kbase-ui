define(["bluebird","kb/common/html","kb/widget/bases/dataWidget","kb/service/client/UserProfile"],function(a,b,c,d){function e(e){return c.make({runtime:e.runtime,title:"User Profile Widget",on:{initialContent:function(){return b.loading("Loading your profile")},fetch:function(){var b=this;return a["try"](function(){var a=new d(e.runtime.getConfig("services.user_profile.url"),{token:e.runtime.service("session").getAuthToken()});return a.get_user_profile([e.runtime.service("session").getUsername()]).then(function(a){var c=a[0].user.realname;return b.setTitle("Profile for "+c),{name:"person",value:{realName:c}}})})},render:function(){return this.hasState("person")?"<p>Hi, I am "+this.getState("person").realName:void 0}}})}return{make:function(a){return e(a)}}});