define(["jquery","bluebird","kb/common/html","kb/service/client/workspace","datatables_bootstrap"],function(a,b,c,d){"use strict";function e(a){console.log("ERROR"),console.log(a);try{return c.makeObjectTable(a,["type","title","reason","message","suggestion"])}catch(b){return console.log(b),"An unknown error was encountered with this widget, please check the console."}}function f(f){function g(){return new b(function(a,e){var f=new d(o.getConfig("services.workspace.url"),{token:o.service("session").getAuthToken()}),g=c.tag("a");f.list_all_types({with_empty_modules:1}).then(function(a){var c={},d=[];return Object.keys(a).forEach(function(e){var g=a[e],h=o.service("type");Object.keys(g).forEach(function(a){var i={module:e,name:a,version:g[a]},j=h.makeType(i),k=h.makeTypeId(j);c[k]={type:j},d.push(b.resolve(f.get_type_info(k)))})}),[c,b.all(d)]}).spread(function(b,d){d.forEach(function(a){var c=a.type_def;b[c].info=a}),n=c.genId();var e=Object.keys(b).map(function(a){var c=b[a];return[c.type.module,c.type.name,o.service("type").getIcon({type:c.type,size:"medium"}).html,function(){var a=o.service("type").getViewer({type:c.type});return a?"Yes":""}(),g({href:"#spec/type/"+a},o.service("type").makeVersion(c.type)),c.info.using_type_defs.map(function(a){return g({href:"#spec/type/"+a},a)}).join("<br>"),c.info.used_type_defs.map(function(a){return g({href:"#spec/type/"+a},a)}).join("<br>"),c.info.using_func_defs.map(function(a){return g({href:"#spec/functions/"+a},a)}).join("<br>"),g({href:"#databrowser?type="+a},"browse")]}),f=["Module","Type","Icon","Viewer?","Version","Using types","Used by types","Used by functions","Objects"],h=c.makeTable({columns:f,rows:e,id:n,"class":"table table-striped"});a({title:"Type Browser",content:h,children:[]})})["catch"](function(a){console.log("ERROR getting type info"),console.log(a),e({type:"UnkownError",reason:"Unknown",message:"Error getting type info"})})})}function h(){a("#"+n).dataTable({initComplete:function(b){var c=this.api(),d=c.data().length,e=c.page.len(),f=c.settings()[0].nTableWrapper;e>=d&&(a(f).find(".dataTables_paginate").closest(".row").hide(),a(f).find(".dataTables_filter").closest(".row").hide()),a(b.nTable).removeClass("hide")}})}function i(a){return b["try"](function(){l=a,m=document.createElement("div"),l.appendChild(m),m.innerHTML="Loading all KBase Types from the Workspace Service ..."+c.loading()})}function j(){return g().then(function(a){m.innerHTML=a.content,o.send("ui","setTitle",a.title),h()})["catch"](function(a){console.log("ERR?"),m.innerHTML=e(a)})}function k(){l.removeChild(m),m.innerHTML="",m=null}var l,m,n,o=f.runtime;return{attach:i,run:j,detach:k}}return{make:function(a){return f(a)}}});