define(["bluebird","kb/widget/adapters/objectWidget","kb/widget/adapters/kbWidget"],function(a,b,c){"use strict";function d(d){function e(a){if(a.id&&(a.name=a.id),l[a.name])throw new Error("Widget "+a.name+" is already registered");l[a.name]=a}function f(a){return l[a]}function g(b,c){return new a(function(a,d){require([b.module],function(e){if("undefined"==typeof e)return void d({message:"Factory widget maker is undefined for "+b.module,data:{widget:b}});if(void 0===e.make)return void d('Factory widget does not have a "make" method: '+b.name+", "+b.module);try{a(e.make(c))}catch(f){d(f)}})})}function h(c,d){return a["try"](function(){return b.make({widgetDef:c,initConfig:d,adapterConfig:{runtime:m}})})}function i(b,d){return a["try"](function(){var a={runtime:m,widget:{module:b.module,jquery_object:d.jqueryName,panel:d.panel,title:b.title}};return c.make(a)})}function j(a,b){var c;if("object"!=typeof a&&(c="Invalid widget after making: "+b),c)throw console.error(c),console.error(a),new Error(c)}function k(a,b){var c,d=l[a];if(!d)throw new Error("Widget "+a+" not found");switch(b=b||{},b.runtime=m,d.type){case"factory":c=g(d,b);break;case"object":c=h(d,b);break;case"kbwidget":c=i(d,b);break;default:throw new Error("Unsupported widget type "+d.type)}return c.then(function(b){return j(b,a),b})}var l={},m=d.runtime;return{addWidget:e,getWidget:f,makeWidget:k}}return{make:function(a){return d(a)}}});