define(["bluebird","jquery","kb/common/utils","kb/common/dom"],function(a,b,c,d){"use strict";function e(e){function f(b){return new a(function(a){require([q],function(d){if(!d)throw new Error("Widget module did not load properly (undefined) for "+e.module);o=c.shallowMerge({},e.initConfig),c.merge(o,b),l=Object.create(d),a()})})}function g(b){return new a(function(a){m=b,n=d.createElement("div"),m.appendChild(n),a()})}function h(d){return new a(function(a){var e=c.shallowMerge(o,{container:b(n),userId:p.getService("session").getUsername(),runtime:p,params:d});l.init(e),l.go(),a()})}function i(){return a["try"](function(){l.stop()})}function j(){return a["try"](function(){m.removeChild(n)})}function k(){}var l,m,n,o,p=e.adapterConfig.runtime,q=e.widgetDef.module;if(!p)throw{type:"ArgumentError",reason:"RuntimeMissing",message:"The runtime factory construction property is required but not provided"};return{init:f,attach:g,start:h,stop:i,detach:j,destroy:k}}return{make:function(a){return e(a)}}});