define(["jquery","bootstrap","kb/widget/legacy/widget"],function(a){a.KBWidget({name:"kbaseButtonControls",version:"1.0.0",options:{controls:[],onMouseover:!0,position:"top",type:"floating",posOffset:"0px"},init:function(b){return this._super(b),this._controls={},this.appendUI(a(this.$elem)),this},bounds:function(a){var b=a.offset();return new Rectangle(new Point(b.left,b.top),new Size(a.width(),a.height()))},visibleBounds:function(a){for(var b=this.bounds(a),c=0;a=a.parent();){var d=this.bounds(a);if(b=b.intersectRect(d),c++>1e3)break;if("body"==a.prop("tagName").toLowerCase())break}return b},appendUI:function(b){"floating"==this.options.type&&(b.css("position","relative"),b.append(a.jqElem("style").text(".tooltip { position : fixed }")));var c=a("<div></div>").addClass("btn-group btn-group-xs").attr("id","control-buttons");if("floating"==this.options.type&&c.css("right","0px").css(this.options.position,this.options.posOffset).css("position","absolute").css("margin-right","3px").attr("z-index",1e4),b.prepend(c),this._rewireIds(b,this),this.options.onMouseover&&"floating"==this.options.type){var d=!1,e=this;b.mouseover(function(b){b.preventDefault(),b.stopPropagation(),void 0!=window._active_kbaseButtonControls&&window._active_kbaseButtonControls.hide(),a(this).children().first().show(),window._active_kbaseButtonControls=c,d=!0}).mouseout(function(a){a.preventDefault(),a.stopPropagation();var f=e.bounds(c),g=e.visibleBounds(c),h=e.bounds(b);h.intersectRect(f);g.containsPoint(new Point(a.pageX,a.pageY))||(window._active_kbaseButtonControls.hide(),window._active_kbaseButtonControls=void 0),d=!1}).children().first().hide()}return this.setControls(this.options.controls),this},controls:function(a){return a?this._controls[a]:this._controls},setControls:function(b){this.data("control-buttons").empty();for(control in this._controls)this._controls[control]=void 0;var c=this;a.each(b,a.proxy(function(b,d){if(!d.condition||0!=d.condition.call(this,d,c.options.context,this.$elem)){var e="btn btn-default";d.type&&(e=e+" btn-"+d.type),tooltip=d.tooltip,"string"==typeof d.tooltip&&(tooltip={title:d.tooltip}),void 0!=tooltip&&void 0==tooltip.container&&(tooltip.container=this.data("control-buttons")),void 0!=tooltip&&void 0==tooltip.placement&&(tooltip.placement="top"),void 0!=tooltip&&(tooltip.delay=1);var f=a("<button></button>").attr("href","#").css("padding-top","1px").css("padding-bottom","1px").attr("class",e).append(a("<i></i>").addClass(d.icon)).tooltip(tooltip).on("click",function(b){b.preventDefault(),b.stopPropagation(),d["icon-alt"]&&(a(this).children().first().toggleClass(d.icon),a(this).children().first().toggleClass(d["icon-alt"])),d.callback.call(this,b,c.options.context)});d.id&&(this._controls[d.id]=f),this.options.id&&f.data("id",this.options.id),this.data("control-buttons").append(f)}},this))}})});