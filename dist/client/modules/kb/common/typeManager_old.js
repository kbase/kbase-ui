define(["underscore","./props"],function(a,b){"use strict";function c(c){function d(a){var b=m.getItem(["types",a.type.module,a.type.name,"icon"])||n,c=b.classes.map(function(a){return a});switch(b.type){case"kbase":if(c.push("icon"),a.size)switch(a.size){case"small":c.push("icon-sm");break;case"medium":c.push("icon-md");break;case"large":c.push("icon-lg")}break;case"fontAwesome":c.push("fa")}return c?{classes:c,type:b.type,html:'<span class="'+c.join(" ")+'"></span>'}:void 0}function e(b){if(!m.hasItem(["types",b.type.module,b.type.name]))throw{type:"ArgumentError",reason:"TypeNotRegistered",message:"The type identified by module "+b.type.module+", name "+b.type.name+" is not registered"};if(!m.hasItem(["types",b.type.module,b.type.name,"viewers"]))throw{type:"ArgumentError",reason:"NoViewersFound",message:"No viewers registered for the type identified by module "+b.type.module+", name "+b.type.name+"."};var c=m.getItem(["types",b.type.module,b.type.name,"viewers"]);if(1===c.length)return c[0];var d=c.filter(function(a){return a["default"]?!0:!1});if(1===d.length){var e=a.extend({},d[0]);return delete e["default"],e}throw 0===d.length?new Error("No viewer defined for this type"):new Error("Multiple default viewers defined for this widget")}function f(a,b){var c=m.getItem(["types",a.module,a.name]);void 0===c&&m.setItem(["types",a.module,a.name],{viewers:[]});var d=m.getItem(["types",a.module,a.name,"viewers"]);d||(d=[],m.setItem(["types",a.module,a.name,"viewers"],d)),b["default"]&&d.forEach(function(a){a["default"]=!1}),d.push(b)}function g(a,b){var c=m.getItem(["types",a.module,a.name]);void 0===c||null===c?m.setItem(["types",a.module,a.name],{icon:b}):m.setItem(["types",a.module,a.name,"icon"],b)}function h(a){return m.getItem(["defaults",a])}function i(a){return a.module+"."+a.name+"-"+a.version.major+"."+a.version.minor}function j(a){var b=a.match(/^(.+?)\.(.+?)-(.+?)\.(.+)$/);if(!b)throw new Error("Invalid data type "+a);if(5!==b.length)throw new Error("Invalid data type "+a);return{module:b[1],name:b[2],version:{major:b[3],minor:b[4]}}}function k(){if(1===arguments.length){var a=arguments[0];if(a.version){var b=a.version.split(".");return{module:a.module,name:a.name,version:{major:b[0],minor:b[1]}}}}}function l(a){return a.version.major+"."+a.version.minor}var m=b.make({data:c.typeDefs}),n={type:"fontAwesome",classes:["fa-file-o"]};return{getIcon:d,setIcon:g,getViewer:e,getDefault:h,makeTypeId:i,parseTypeId:j,makeType:k,makeVersion:l,addViewer:f}}return{make:function(a){return c(a)}}});